{"version":3,"file":"jss-plugin-nested.js","sources":["../../../node_modules/@babel/runtime/helpers/esm/extends.js","../../../node_modules/tiny-warning/dist/tiny-warning.esm.js","../src/index.js"],"sourcesContent":["export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","var isProduction = process.env.NODE_ENV === 'production';\nfunction warning(condition, message) {\n  if (!isProduction) {\n    if (condition) {\n      return;\n    }\n\n    var text = \"Warning: \" + message;\n\n    if (typeof console !== 'undefined') {\n      console.warn(text);\n    }\n\n    try {\n      throw Error(text);\n    } catch (x) {}\n  }\n}\n\nexport default warning;\n","import warning from 'tiny-warning'\n\nconst separatorRegExp = /\\s*,\\s*/g\nconst parentRegExp = /&/g\nconst refRegExp = /\\$([\\w-]+)/g\n\n/**\n * Convert nested rules to separate, remove them from original styles.\n */\nexport default function jssNested() {\n  // Get a function to be used for $ref replacement.\n  function getReplaceRef(container, sheet) {\n    return (match, key) => {\n      const rule = container.getRule(key) || (sheet && sheet.getRule(key))\n      if (rule) {\n        return rule.selector\n      }\n\n      warning(\n        false,\n        `[JSS] Could not find the referenced rule \"${key}\" in \"${\n          container.options.meta || container.toString()\n        }\".`\n      )\n      return key\n    }\n  }\n\n  function replaceParentRefs(nestedProp, parentProp) {\n    const parentSelectors = parentProp.split(separatorRegExp)\n    const nestedSelectors = nestedProp.split(separatorRegExp)\n\n    let result = ''\n\n    for (let i = 0; i < parentSelectors.length; i++) {\n      const parent = parentSelectors[i]\n\n      for (let j = 0; j < nestedSelectors.length; j++) {\n        const nested = nestedSelectors[j]\n        if (result) result += ', '\n        // Replace all & by the parent or prefix & with the parent.\n        result +=\n          nested.indexOf('&') !== -1 ? nested.replace(parentRegExp, parent) : `${parent} ${nested}`\n      }\n    }\n\n    return result\n  }\n\n  function getOptions(rule, container, prevOptions) {\n    // Options has been already created, now we only increase index.\n    if (prevOptions) return {...prevOptions, index: prevOptions.index + 1}\n\n    let {nestingLevel} = rule.options\n    nestingLevel = nestingLevel === undefined ? 1 : nestingLevel + 1\n\n    const options = {\n      ...rule.options,\n      nestingLevel,\n      index: container.indexOf(rule) + 1\n    }\n    // We don't need the parent name to be set options for chlid.\n    delete options.name\n    return options\n  }\n\n  function onProcessStyle(style, rule, sheet) {\n    if (rule.type !== 'style') return style\n\n    const styleRule = rule\n\n    const container = styleRule.options.parent\n    let options\n    let replaceRef\n    for (const prop in style) {\n      const isNested = prop.indexOf('&') !== -1\n      const isNestedConditional = prop[0] === '@'\n\n      if (!isNested && !isNestedConditional) continue\n\n      options = getOptions(styleRule, container, options)\n\n      if (isNested) {\n        let selector = replaceParentRefs(prop, styleRule.selector)\n        // Lazily create the ref replacer function just once for\n        // all nested rules within the sheet.\n        if (!replaceRef) replaceRef = getReplaceRef(container, sheet)\n        // Replace all $refs.\n        selector = selector.replace(refRegExp, replaceRef)\n\n        const name = `${styleRule.key}-${prop}`\n        if ('replaceRule' in container) {\n          // for backward compatibility\n          container.replaceRule(name, style[prop], {...options, selector})\n        } else {\n          container.addRule(name, style[prop], {...options, selector})\n        }\n      } else if (isNestedConditional) {\n        // Place conditional right after the parent rule to ensure right ordering.\n        container\n          .addRule(prop, {}, options)\n          .addRule(styleRule.key, style[prop], {selector: styleRule.selector})\n      }\n\n      delete style[prop]\n    }\n\n    return style\n  }\n\n  return {onProcessStyle}\n}\n"],"names":["separatorRegExp","parentRegExp","refRegExp","jssNested","getReplaceRef","container","sheet","match","key","rule","getRule","selector","warning","options","meta","toString","replaceParentRefs","nestedProp","parentProp","parentSelectors","split","nestedSelectors","result","i","length","parent","j","nested","indexOf","replace","getOptions","prevOptions","index","nestingLevel","undefined","name","onProcessStyle","style","type","styleRule","replaceRef","prop","isNested","isNestedConditional","replaceRule","addRule"],"mappings":"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"}