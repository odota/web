import{createComponent as e,Dynamic as t,template as r,spread as n,mergeProps as o,insert as s,use as i,setStyleProperty as c,effect as l}from"solid-js/web";import{mergeProps as u,createEffect as f,createMemo as a,onCleanup as d,createSignal as g,onMount as h,createComputed as v,on as p,untrack as m,For as S,splitProps as $}from"solid-js";const b=null,{min:w,max:z,abs:x,floor:y}=Math,_=(e,t,r)=>w(r,z(t,e)),I=e=>[...e].sort(((e,t)=>e-t)),k="function"==typeof queueMicrotask?queueMicrotask:e=>{Promise.resolve().then(e)},T=()=>{let e;return[new Promise((t=>{e=t})),e]},M=e=>{let t;return()=>(e&&(t=e(),e=void 0),t)},O=(e,t,r)=>{const n=r?"unshift":"push";for(let r=0;r<t;r++)e[n](-1);return e},R=(e,t)=>{const r=e.o[t];return-1===r?e.i:r},J=(e,t,r)=>{const n=-1===e.o[t];return e.o[t]=r,e.l=w(t,e.l),n},P=(e,t)=>{if(!e.u)return 0;if(e.l>=t)return e.h[t];e.l<0&&(e.h[0]=0,e.l=0);let r=e.l,n=e.h[r];for(;r<t;)n+=R(e,r),e.h[++r]=n;return e.l=t,n},B=(e,t,r=0,n=e.u-1)=>{let o=r;for(;r<=n;){const s=y((r+n)/2);P(e,s)<=t?(o=s,r=s+1):n=s-1}return _(o,0,e.u-1)},E=(e,t,r)=>{const n=t-e.u;return e.l=r?-1:w(t-1,e.l),e.u=t,n>0?(O(e.h,n),O(e.o,n,r),e.i*n):(e.h.splice(n),(r?e.o.splice(0,-n):e.o.splice(n)).reduce(((t,r)=>t-(-1===r?e.i:r)),0))},H="undefined"!=typeof window,L=()=>document.documentElement,W=e=>e.ownerDocument,j=e=>e.defaultView,q=/*#__PURE__*/M((()=>!!H&&"rtl"===getComputedStyle(L()).direction)),C=/*#__PURE__*/M((()=>!!/iP(hone|od|ad)/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>0)),V=/*#__PURE__*/M((()=>"scrollBehavior"in L().style)),X=(e,t=40,r=0,n,o=!1)=>{let s=!!r,i=1,c=0,l=0,u=0,f=0,a=0,d=0,g=0,h=0,v=b,p=[0,s?z(r-1,0):-1],m=0,S=!1;const $=((e,t,r)=>({i:t,o:r?O(r.slice(0,w(e,r.length)),z(0,e-r.length)):O([],e),u:e,l:-1,h:O([],e+1)}))(e,n?n[1]:t,n&&n[0]),y=new Set,_=()=>u-l,k=()=>_()+a+f,T=(e,t)=>((e,t,r,n)=>{if(n=w(n,e.u-1),P(e,n)<=t){const o=B(e,r,n);return[B(e,t,n,o),o]}{const o=B(e,t,void 0,n);return[o,B(e,r,o)]}})($,e,t,p[0]),M=()=>P($,$.u),H=e=>P($,e)-a,L=e=>R($,e),W=(e,t=-1)=>$.o[e]===t,j=e=>{e&&(C()&&0!==g||v&&1===h?a+=e:f+=e)};return{v:()=>{y.clear()},p:()=>i,m:()=>(e=>[e.o.slice(),e.i])($),S:(e=200)=>{if(!S||s)return p;let t,r;if(d)[t,r]=p;else{let n=z(0,k()),s=n+c;o||(e=z(0,e),1!==g&&(n-=e),2!==g&&(s+=e)),[t,r]=p=T(z(0,n),z(0,s)),v&&(t=w(t,v[0]),r=z(r,v[1]))}return[z(t,0),w(r,$.u-1)]},$:e=>B($,e-l),_:W,I:H,k:L,T:()=>$.u,M:()=>u,O:()=>0!==g,R:()=>c,J:()=>l,P:M,B:()=>(d=f,f=0,[d,2===h]),H:(e,t)=>{const r=[e,t];return y.add(r),()=>{y.delete(r)}},L:(e,t)=>{let r,n,p=0;switch(e){case 1:{if(t===u&&0===h)break;const e=d;d=0;const r=t-u,o=x(r);e&&o<x(e)+1||0!==h||(g=r<0?2:1),s&&(s=!1),u=t,p=4;const i=_();i>=-c&&i<=M()&&(p+=1,n=o>c);break}case 2:p=8,0!==g&&(r=!0,p+=1),g=0,h=0,v=b;break;case 3:{const e=t.filter((([e,t])=>!W(e,t)));if(!e.length)break;j(e.reduce(((e,[t,r])=>((2===h||(v&&1===h?t<v[0]:H(t+(0===g&&0===h?1:0))<_()))&&(e+=r-L(t)),e)),0));for(const[t,r]of e){const e=L(t),n=J($,t,r);o&&(m+=n?r:r-e)}o&&c&&m>c&&(j(((e,t)=>{let r=0;const n=[];e.o.forEach(((e,o)=>{-1!==e&&(n.push(e),o<t&&r++)})),e.l=-1;const o=I(n),s=o.length,i=s/2|0,c=s%2==0?(o[i-1]+o[i])/2:o[i],l=e.i;return((e.i=c)-l)*z(t-r,0)})($,B($,k()))),o=!1),p=3,n=!0;break}case 4:c!==t&&(c||(S=n=!0),c=t,p=3);break;case 5:t[1]?(j(E($,t[0],!0)),h=2,p=1):(E($,t[0]),p=1);break;case 6:l=t;break;case 7:h=1;break;case 8:v=T(t,t+c),p=1}p&&(i=1+(2147483647&i),r&&a&&(f+=a,a=0),y.forEach((([e,t])=>{p&e&&t(n)})))}}},Y=setTimeout,D=(e,t)=>t&&q()?-e:e,U=(e,t,r,n,o,s)=>{const i=Date.now;let c=0,l=!1,u=!1,f=!1,a=!1;const d=(()=>{let t;const r=()=>{t!=b&&clearTimeout(t)},n=()=>{r(),t=Y((()=>{t=b,(()=>{if(l||u)return l=!1,void d();f=!1,e.L(2)})()}),150)};return n.W=r,n})(),g=()=>{c=i(),f&&(a=!0),s&&e.L(6,s()),e.L(1,n()),d()},h=t=>{if(l||!e.O()||t.ctrlKey)return;const n=i()-c;150>n&&50<n&&(r?t.deltaX:t.deltaY)&&(l=!0)},v=()=>{u=!0,f=a=!1},p=()=>{u=!1,C()&&(f=!0)};return t.addEventListener("scroll",g),t.addEventListener("wheel",h,{passive:!0}),t.addEventListener("touchstart",v,{passive:!0}),t.addEventListener("touchend",p,{passive:!0}),{j:()=>{t.removeEventListener("scroll",g),t.removeEventListener("wheel",h),t.removeEventListener("touchstart",v),t.removeEventListener("touchend",p),d.W()},q:()=>{const[t,s]=e.B();t&&(o(D(t,r),s,a),a=!1,s&&e.R()>e.P()&&e.L(1,n()))}}},A=(e,t,r)=>{let n;return[async(o,s)=>{if(!await t())return;n&&n();const i=()=>{const[t,r]=T();return n=()=>{r(!1)},e.R()&&Y(n,150),[t,e.H(2,(()=>{r(!0)}))]};if(s&&V())e.L(8,o()),k((async()=>{for(;;){let t=!0;for(let[r,n]=e.S();r<=n;r++)if(e._(r)){t=!1;break}if(t)break;const[r,n]=i();try{if(!await r)return}finally{n()}}e.L(7),r(o(),s)}));else for(;;){const[t,n]=i();try{if(e.L(7),r(o()),!await t)return}finally{n()}}},()=>{n&&n()}]},F=e=>{let t;return{C(r){(t||(t=new(j(W(r)).ResizeObserver)(e))).observe(r)},V(e){t.unobserve(e)},j(){t&&t.disconnect()}}},G=r=>{let n;r=u({X:"div"},r),f((()=>{n&&d(r.Y(n,r.D))}));const o=a((()=>{const e=r.U,t={contain:"layout style",position:"absolute",[e?"height":"width"]:"100%",[e?"top":"left"]:"0px",[e?q()?"right":"left":"top"]:r.A+"px",visibility:r.F?"hidden":void 0};return e&&(t.display="inline-flex"),t}));return e(t,{get component(){return r.X},get index(){return r.D},ref(e){"function"==typeof n?n(e):n=e},get style(){return o()},get children(){return r.G}})},K=(e,t)=>e[0]===t[0]&&e[1]===t[1],N=r=>{let n;const{itemSize:o,horizontal:s=!1,cache:i}=r;r=u({as:"div"},r);const c=X(r.data.length,o,void 0,i,!o),l=((e,t)=>{let r;const n=t?"width":"height",o=new WeakMap,s=F((t=>{const s=[];for(const{target:i,contentRect:c}of t)if(i.offsetParent)if(i===r)e.L(4,c[n]);else{const e=o.get(i);e!=b&&s.push([e,c[n]])}s.length&&e.L(3,s)}));return{K(e){s.C(r=e)},N:(e,t)=>(o.set(e,t),s.C(e),()=>{o.delete(e),s.V(e)}),v:s.j}})(c,s),$=((e,t)=>{let r,n,o=T();const s=t?"scrollLeft":"scrollTop",i=t?"overflowX":"overflowY",[c,l]=A(e,(()=>o[0]),((e,n)=>{e=D(e,t),n?r.scrollTo({[t?"left":"top"]:e,behavior:"smooth"}):r[s]=e}));return{Z(c){r=c,n=U(e,c,t,(()=>D(c[s],t)),((t,r,n)=>{if(n){const e=c.style,t=e[i];e[i]="hidden",Y((()=>{e[i]=t}))}c[s]=e.M()+t,r&&l()})),o[1](!0)},v(){n&&n.j(),o[1](!1),o=T()},ee(e){c((()=>e))},te(t){t+=e.M(),c((()=>t))},re(t,{align:r,smooth:n,offset:o=0}={}){if(t=_(t,0,e.T()-1),"nearest"===r){const n=e.I(t),o=e.M();if(n<o)r="start";else{if(!(n+e.k(t)>o+e.R()))return;r="end"}}c((()=>o+e.J()+e.I(t)+("end"===r?e.k(t)-e.R():"center"===r?(e.k(t)-e.R())/2:0)),n)},ne:()=>{n&&n.q()}}})(c,s),[w,x]=g(c.p());c.H(1,(()=>{x(c.p())})),c.H(4,(()=>{var e;null===(e=r.onScroll)||void 0===e||e.call(r,c.M())})),c.H(8,(()=>{var e;null===(e=r.onScrollEnd)||void 0===e||e.call(r)}));const y=a((e=>{w();const t=c.S(r.bufferSize);return e&&K(e,t)?e:t})),k=a((()=>w()&&c.O())),M=a((()=>w()&&c.P()));h((()=>{r.ref&&r.ref({get cache(){return c.m()},get scrollOffset(){return c.M()},get scrollSize(){return(e=>z(e.P(),e.R()))(c)},get viewportSize(){return c.R()},findItemIndex:c.$,getItemOffset:c.I,getItemSize:c.k,scrollToIndex:$.re,scrollTo:$.ee,scrollBy:$.te});const e=r.scrollRef||n.parentElement;l.K(e),$.Z(e),d((()=>{r.ref&&r.ref(),c.v(),l.v(),$.v()}))})),v(p((()=>r.startMargin||0),(e=>{e!==c.J()&&c.L(6,e)}))),f(p(w,(()=>{$.ne()})));const O=a((()=>{const e=r.data.length;m((()=>{e!==c.T()&&c.L(5,[e,r.shift])}));const t=[],n=[];if(r.keepMounted){const e=new Set(r.keepMounted);for(let[t,r]=y();t<=r;t++)e.add(t);I([...e]).forEach((e=>{t.push(r.data[e]),n.push(e)}))}else for(let[e,o]=y();e<=o;e++)t.push(r.data[e]),n.push(e);return{oe:t,se:n}}));return e(t,{get component(){return r.as},ref(e){"function"==typeof n?n(e):n=e},get style(){return{contain:"size style","overflow-anchor":"none",flex:"none",position:"relative",width:s?M()+"px":"100%",height:s?"100%":M()+"px","pointer-events":k()?"none":void 0}},get children(){return e(S,{get each(){return O().oe},children:(t,n)=>((t,n)=>{const o=a((()=>(w(),c.I(n())))),i=a((()=>(w(),c._(n())))),u=a((()=>m((()=>r.children(t,n)))));return e(G,{get X(){return r.item},get D(){return n()},get Y(){return l.N},get A(){return o()},get F(){return i()},get G(){return u()},U:s})})(t,a((()=>O().se[n()])))})}})};var Q=/*#__PURE__*/r("<div>");const Z=t=>{const[r,i]=$(t,["ref","data","children","bufferSize","itemSize","shift","horizontal","keepMounted","cache","item","onScroll","onScrollEnd","style"]);return c=Q(),n(c,o(i,{get style(){return{display:r.horizontal?"inline-block":"block",[r.horizontal?"overflow-x":"overflow-y"]:"auto",contain:"strict",width:"100%",height:"100%",...r.style}}}),!1,!0),s(c,e(N,{ref(e){var t=r.ref;"function"==typeof t?t(e):r.ref=e},get data(){return r.data},get bufferSize(){return r.bufferSize},get itemSize(){return r.itemSize},get shift(){return r.shift},get horizontal(){return r.horizontal},get keepMounted(){return r.keepMounted},get cache(){return r.cache},get item(){return r.item},get onScroll(){return r.onScroll},get onScrollEnd(){return r.onScrollEnd},get children(){return r.children}})),c;var c};var ee=/*#__PURE__*/r("<div style=overflow-anchor:none>");const te=t=>{let r;const{ref:n,data:o,children:u,itemSize:v,shift:$,horizontal:w=!1,cache:z,onScrollEnd:x}=t,y=X(t.data.length,v,void 0,z,!v),I=((e,t)=>{const r=t?"width":"height",n=t?"innerWidth":"innerHeight",o=new WeakMap,s=F((t=>{const n=[];for(const{target:e,contentRect:s}of t){if(!e.offsetParent)continue;const t=o.get(e);t!=b&&n.push([t,s[r]])}n.length&&e.L(3,n)}));let i;return{K(t){const r=j(W(t)),o=()=>{e.L(4,r[n])};r.addEventListener("resize",o),k(o),i=()=>{r.removeEventListener("resize",o)}},N:(e,t)=>(o.set(e,t),s.C(e),()=>{o.delete(e),s.V(e)}),v(){i&&i(),s.j()}}})(y,w),M=((e,t)=>{let r,n,o=T();const s=t?"left":"top",[i]=A(e,(()=>o[0]),((e,n)=>{e=D(e,t);const o=j(W(r));n?o.scroll({[s]:e,behavior:"smooth"}):o.scroll({[s]:e})})),c=(e,t,r,n,o=0)=>{const s=n?"offsetLeft":"offsetTop",i=o+(n&&q()?r.innerWidth-e[s]-e.offsetWidth:e[s]),l=e.offsetParent;return e!==t&&l?c(l,t,r,n,i):i};return{Z(i){r=i;const l=t?"scrollX":"scrollY",u=W(i),f=j(u);n=U(e,f,t,(()=>D(f[l],t)),((t,r)=>{r?f.scroll({[s]:e.M()+t}):f.scrollBy({[s]:t})}),(()=>c(i,u.body,f,t))),o[1](!0)},v(){n&&n.j(),r=void 0,o[1](!1),o=T()},ne:()=>{n&&n.q()},re(n,{align:o,smooth:s,offset:l=0}={}){if(!r)return;if(n=_(n,0,e.T()-1),"nearest"===o){const t=e.I(n),r=e.M();if(t<r)o="start";else{if(!(t+e.k(n)>r+e.R()))return;o="end"}}const u=W(r),f=j(u),a=u.documentElement,d=()=>e.R()-(t?a.clientWidth:a.clientHeight);i((()=>l+c(r,u.body,f,t)+e.I(n)+("end"===o?e.k(n)-(e.R()-d()):"center"===o?(e.k(n)-(e.R()-d()))/2:0)),s)}}})(y,w),[O,R]=g(y.p());y.H(1,(()=>{R(y.p())})),y.H(4,(()=>{var e;null===(e=t.onScroll)||void 0===e||e.call(t)})),y.H(8,(()=>{var e;null===(e=t.onScrollEnd)||void 0===e||e.call(t)}));const J=a((e=>{O();const r=y.S(t.bufferSize);return e&&K(e,r)?e:r})),P=a((()=>O()&&y.O())),B=a((()=>O()&&y.P()));h((()=>{t.ref&&t.ref({get cache(){return y.m()},get scrollOffset(){return y.M()},get viewportSize(){return y.R()},findItemIndex:y.$,getItemOffset:y.I,getItemSize:y.k,scrollToIndex:M.re}),I.K(r),M.Z(r),d((()=>{t.ref&&t.ref(),y.v(),I.v(),M.v()}))})),f(p(O,(()=>{M.ne()})));const E=a((()=>{const e=t.data.length;m((()=>{e!==y.T()&&y.L(5,[e,t.shift])}));const r=[];for(let[e,n]=J();e<=n;e++)r.push(t.data[e]);return r}));return H=ee(),"function"==typeof r?i(r,H):r=H,c(H,"contain","size style"),c(H,"flex","none"),c(H,"position","relative"),s(H,e(S,{get each(){return E()},children:(r,n)=>{const o=a((()=>J()[0]+n())),s=a((()=>(O(),y.I(o())))),i=a((()=>(O(),y._(o())))),c=a((()=>m((()=>t.children(r,o)))));return e(G,{get D(){return o()},get Y(){return I.N},get A(){return s()},get F(){return i()},get G(){return c()},U:w})}})),l((e=>{var t=w?B()+"px":"100%",r=w?"100%":B()+"px",n=P()?"none":void 0;return t!==e.e&&c(H,"width",e.e=t),r!==e.t&&c(H,"height",e.t=r),n!==e.a&&c(H,"pointer-events",e.a=n),e}),{e:void 0,t:void 0,a:void 0}),H;var H};export{Z as VList,N as Virtualizer,te as WindowVirtualizer};
//# sourceMappingURL=index.js.map
