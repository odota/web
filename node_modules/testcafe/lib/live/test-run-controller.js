"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const events_1 = __importDefault(require("events"));
const lodash_1 = require("lodash");
const test_run_1 = require("./test-run");
const test_run_state_1 = __importDefault(require("./test-run-state"));
class LiveModeTestRunController extends events_1.default {
    constructor() {
        super();
        this.testWrappers = [];
        this.expectedTestCount = 0;
        this._testRunCtor = null;
        this.testRuns = {};
        this.allTestsCompletePromise = Promise.resolve();
        this.completeAllRunningTests = lodash_1.noop;
        this.on('all-tests-complete', () => this.completeAllRunningTests());
    }
    get TestRunCtor() {
        if (!this._testRunCtor) {
            this._testRunCtor = test_run_1.TestRunCtorFactory({
                created: testRun => this._onTestRunCreated(testRun),
                done: (testRun, forced) => this._onTestRunDone(testRun, forced),
                readyToNext: testRun => this._onTestRunReadyToNext(testRun),
            });
        }
        return this._testRunCtor;
    }
    setExpectedTestCount(testCount) {
        this.expectedTestCount = testCount;
    }
    _getTestRuns() {
        return [].concat(...Object.values(this.testRuns));
    }
    run() {
        const readyToNextPromises = [];
        const testRuns = [].concat(...Object.values(this.testRuns));
        testRuns.forEach(testRun => {
            if (testRun.finish) {
                readyToNextPromises.push(testRun.readyToNextPromise);
                testRun.finish();
            }
        });
        this.testRuns = {};
        return Promise.all(readyToNextPromises);
    }
    stop() {
        this._getTestRuns().forEach(testRun => {
            testRun.stop();
        });
    }
    _getTestWrapper(test) {
        return this.testWrappers.find(w => w.test === test);
    }
    _onTestRunCreated(testRun) {
        this.allTestsCompletePromise = new Promise(resolve => {
            this.completeAllRunningTests = resolve;
        });
        const connectionId = testRun.browserConnection.id;
        this.testRuns[connectionId] = this.testRuns[connectionId] || [];
        this.testRuns[connectionId].push(testRun);
    }
    _onTestRunDone(testRun) {
        testRun.state = test_run_state_1.default.done;
        const testWillBeRestarted = !this._isTestFinished(testRun);
        const hasRunningTestsInOtherBrowsers = this._getTestRuns().some(t => t.state !== test_run_state_1.default.done);
        if (!hasRunningTestsInOtherBrowsers && !testWillBeRestarted)
            this.emit('all-tests-complete');
        const browserTestRuns = this.testRuns[testRun.browserConnection.id];
        const tests = lodash_1.uniq(browserTestRuns.map(t => t.test));
        testRun.readyToNextPromise = new Promise(resolve => {
            testRun.setReadyToNext = resolve;
        });
        const isLastTestRun = tests.length >= this.expectedTestCount;
        if (testWillBeRestarted || !isLastTestRun)
            return Promise.resolve();
        return new Promise(resolve => {
            testRun.finish = () => {
                testRun.finish = null;
                resolve();
            };
        });
    }
    _onTestRunReadyToNext(testRun) {
        testRun.setReadyToNext();
    }
    _isTestFinished(testRun) {
        const { quarantine, errs } = testRun;
        if (!quarantine)
            return true;
        return quarantine.isFirstAttemptSuccessful(errs) || quarantine.isThresholdReached(errs);
    }
}
exports.default = LiveModeTestRunController;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC1ydW4tY29udHJvbGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saXZlL3Rlc3QtcnVuLWNvbnRyb2xsZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxvREFBa0M7QUFDbEMsbUNBQW9DO0FBQ3BDLHlDQUFnRDtBQUNoRCxzRUFBOEM7QUFFOUMsTUFBTSx5QkFBMEIsU0FBUSxnQkFBWTtJQUNoRDtRQUNJLEtBQUssRUFBRSxDQUFDO1FBRVIsSUFBSSxDQUFDLFlBQVksR0FBUSxFQUFFLENBQUM7UUFDNUIsSUFBSSxDQUFDLGlCQUFpQixHQUFHLENBQUMsQ0FBQztRQUMzQixJQUFJLENBQUMsWUFBWSxHQUFRLElBQUksQ0FBQztRQUU5QixJQUFJLENBQUMsUUFBUSxHQUFrQixFQUFFLENBQUM7UUFDbEMsSUFBSSxDQUFDLHVCQUF1QixHQUFHLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNqRCxJQUFJLENBQUMsdUJBQXVCLEdBQUcsYUFBSSxDQUFDO1FBRXBDLElBQUksQ0FBQyxFQUFFLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLHVCQUF1QixFQUFFLENBQUMsQ0FBQztJQUN4RSxDQUFDO0lBRUQsSUFBSSxXQUFXO1FBQ1gsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDcEIsSUFBSSxDQUFDLFlBQVksR0FBRyw2QkFBa0IsQ0FBQztnQkFDbkMsT0FBTyxFQUFNLE9BQU8sQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLE9BQU8sQ0FBQztnQkFDdkQsSUFBSSxFQUFTLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDO2dCQUN0RSxXQUFXLEVBQUUsT0FBTyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsT0FBTyxDQUFDO2FB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QixHQUFHLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFO1lBQy9DLE9BQU8sQ0FBQyxjQUFjLEdBQUcsT0FBTyxDQUFDO1FBQ3JDLENBQUMsQ0FBQyxDQUFDO1FBRUgsTUFBTSxhQUFhLEdBQUcsS0FBSyxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsaUJBQWlCLENBQUM7UUFFN0QsSUFBSSxtQkFBbUIsSUFBSSxDQUFDLGFBQWE7WUFDckMsT0FBTyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFN0IsT0FBTyxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUN6QixPQUFPLENBQUMsTUFBTSxHQUFHLEdBQUcsRUFBRTtnQkFDbEIsT0FBTyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7Z0JBRXRCLE9BQU8sRUFBRSxDQUFDO1lBQ2QsQ0FBQyxDQUFDO1FBQ04sQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQscUJBQXFCLENBQUUsT0FBTztRQUMxQixPQUFPLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDN0IsQ0FBQztJQUVELGVBQWUsQ0FBRSxPQUFPO1FBQ3BCLE1BQU0sRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLEdBQUcsT0FBTyxDQUFDO1FBRXJDLElBQUksQ0FBQyxVQUFVO1lBQ1gsT0FBTyxJQUFJLENBQUM7UUFFaEIsT0FBTyxVQUFVLENBQUMsd0JBQXdCLENBQUMsSUFBSSxDQUFDLElBQUksVUFBVSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzVGLENBQUM7Q0FDSjtBQUVELGtCQUFlLHlCQUF5QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEV2ZW50RW1pdHRlciBmcm9tICdldmVudHMnO1xuaW1wb3J0IHsgbm9vcCwgdW5pcSB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBUZXN0UnVuQ3RvckZhY3RvcnkgfSBmcm9tICcuL3Rlc3QtcnVuJztcbmltcG9ydCBURVNUX1JVTl9TVEFURSBmcm9tICcuL3Rlc3QtcnVuLXN0YXRlJztcblxuY2xhc3MgTGl2ZU1vZGVUZXN0UnVuQ29udHJvbGxlciBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG4gICAgY29uc3RydWN0b3IgKCkge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIHRoaXMudGVzdFdyYXBwZXJzICAgICAgPSBbXTtcbiAgICAgICAgdGhpcy5leHBlY3RlZFRlc3RDb3VudCA9IDA7XG4gICAgICAgIHRoaXMuX3Rlc3RSdW5DdG9yICAgICAgPSBudWxsO1xuXG4gICAgICAgIHRoaXMudGVzdFJ1bnMgICAgICAgICAgICAgICAgPSB7fTtcbiAgICAgICAgdGhpcy5hbGxUZXN0c0NvbXBsZXRlUHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICB0aGlzLmNvbXBsZXRlQWxsUnVubmluZ1Rlc3RzID0gbm9vcDtcblxuICAgICAgICB0aGlzLm9uKCdhbGwtdGVzdHMtY29tcGxldGUnLCAoKSA9PiB0aGlzLmNvbXBsZXRlQWxsUnVubmluZ1Rlc3RzKCkpO1xuICAgIH1cblxuICAgIGdldCBUZXN0UnVuQ3RvciAoKSB7XG4gICAgICAgIGlmICghdGhpcy5fdGVzdFJ1bkN0b3IpIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlc3RSdW5DdG9yID0gVGVzdFJ1bkN0b3JGYWN0b3J5KHtcbiAgICAgICAgICAgICAgICBjcmVhdGVkOiAgICAgdGVzdFJ1biA9PiB0aGlzLl9vblRlc3RSdW5DcmVhdGVkKHRlc3RSdW4pLFxuICAgICAgICAgICAgICAgIGRvbmU6ICAgICAgICAodGVzdFJ1biwgZm9yY2VkKSA9PiB0aGlzLl9vblRlc3RSdW5Eb25lKHRlc3RSdW4sIGZvcmNlZCksXG4gICAgICAgICAgICAgICAgcmVhZHlUb05leHQ6IHRlc3RSdW4gPT4gdGhpcy5fb25UZXN0UnVuUmVhZHlUb05leHQodGVzdFJ1biksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLl90ZXN0UnVuQ3RvcjtcbiAgICB9XG5cbiAgICBzZXRFeHBlY3RlZFRlc3RDb3VudCAodGVzdENvdW50KSB7XG4gICAgICAgIHRoaXMuZXhwZWN0ZWRUZXN0Q291bnQgPSB0ZXN0Q291bnQ7XG4gICAgfVxuXG4gICAgX2dldFRlc3RSdW5zICgpIHtcbiAgICAgICAgcmV0dXJuIFtdLmNvbmNhdCguLi5PYmplY3QudmFsdWVzKHRoaXMudGVzdFJ1bnMpKTtcbiAgICB9XG5cbiAgICBydW4gKCkge1xuICAgICAgICBjb25zdCByZWFkeVRvTmV4dFByb21pc2VzID0gW107XG5cbiAgICAgICAgY29uc3QgdGVzdFJ1bnMgPSBbXS5jb25jYXQoLi4uT2JqZWN0LnZhbHVlcyh0aGlzLnRlc3RSdW5zKSk7XG5cbiAgICAgICAgdGVzdFJ1bnMuZm9yRWFjaCh0ZXN0UnVuID0+IHtcbiAgICAgICAgICAgIGlmICh0ZXN0UnVuLmZpbmlzaCkge1xuICAgICAgICAgICAgICAgIHJlYWR5VG9OZXh0UHJvbWlzZXMucHVzaCh0ZXN0UnVuLnJlYWR5VG9OZXh0UHJvbWlzZSk7XG4gICAgICAgICAgICAgICAgdGVzdFJ1bi5maW5pc2goKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy50ZXN0UnVucyA9IHt9O1xuXG4gICAgICAgIHJldHVybiBQcm9taXNlLmFsbChyZWFkeVRvTmV4dFByb21pc2VzKTtcbiAgICB9XG5cbiAgICBzdG9wICgpIHtcbiAgICAgICAgdGhpcy5fZ2V0VGVzdFJ1bnMoKS5mb3JFYWNoKHRlc3RSdW4gPT4ge1xuICAgICAgICAgICAgdGVzdFJ1bi5zdG9wKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIF9nZXRUZXN0V3JhcHBlciAodGVzdCkge1xuICAgICAgICByZXR1cm4gdGhpcy50ZXN0V3JhcHBlcnMuZmluZCh3ID0+IHcudGVzdCA9PT0gdGVzdCk7XG4gICAgfVxuXG4gICAgX29uVGVzdFJ1bkNyZWF0ZWQgKHRlc3RSdW4pIHtcbiAgICAgICAgdGhpcy5hbGxUZXN0c0NvbXBsZXRlUHJvbWlzZSA9IG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZUFsbFJ1bm5pbmdUZXN0cyA9IHJlc29sdmU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGNvbm5lY3Rpb25JZCA9IHRlc3RSdW4uYnJvd3NlckNvbm5lY3Rpb24uaWQ7XG5cbiAgICAgICAgdGhpcy50ZXN0UnVuc1tjb25uZWN0aW9uSWRdID0gdGhpcy50ZXN0UnVuc1tjb25uZWN0aW9uSWRdIHx8IFtdO1xuXG4gICAgICAgIHRoaXMudGVzdFJ1bnNbY29ubmVjdGlvbklkXS5wdXNoKHRlc3RSdW4pO1xuICAgIH1cblxuICAgIF9vblRlc3RSdW5Eb25lICh0ZXN0UnVuKSB7XG4gICAgICAgIHRlc3RSdW4uc3RhdGUgPSBURVNUX1JVTl9TVEFURS5kb25lO1xuXG4gICAgICAgIGNvbnN0IHRlc3RXaWxsQmVSZXN0YXJ0ZWQgICAgICAgICAgICA9ICF0aGlzLl9pc1Rlc3RGaW5pc2hlZCh0ZXN0UnVuKTtcbiAgICAgICAgY29uc3QgaGFzUnVubmluZ1Rlc3RzSW5PdGhlckJyb3dzZXJzID0gdGhpcy5fZ2V0VGVzdFJ1bnMoKS5zb21lKHQgPT4gdC5zdGF0ZSAhPT0gVEVTVF9SVU5fU1RBVEUuZG9uZSk7XG5cbiAgICAgICAgaWYgKCFoYXNSdW5uaW5nVGVzdHNJbk90aGVyQnJvd3NlcnMgJiYgIXRlc3RXaWxsQmVSZXN0YXJ0ZWQpXG4gICAgICAgICAgICB0aGlzLmVtaXQoJ2FsbC10ZXN0cy1jb21wbGV0ZScpO1xuXG4gICAgICAgIGNvbnN0IGJyb3dzZXJUZXN0UnVucyA9IHRoaXMudGVzdFJ1bnNbdGVzdFJ1bi5icm93c2VyQ29ubmVjdGlvbi5pZF07XG4gICAgICAgIGNvbnN0IHRlc3RzICAgICAgICAgICA9IHVuaXEoYnJvd3NlclRlc3RSdW5zLm1hcCh0ID0+IHQudGVzdCkpO1xuXG4gICAgICAgIHRlc3RSdW4ucmVhZHlUb05leHRQcm9taXNlID0gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICAgICAgICB0ZXN0UnVuLnNldFJlYWR5VG9OZXh0ID0gcmVzb2x2ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgaXNMYXN0VGVzdFJ1biA9IHRlc3RzLmxlbmd0aCA+PSB0aGlzLmV4cGVjdGVkVGVzdENvdW50O1xuXG4gICAgICAgIGlmICh0ZXN0V2lsbEJlUmVzdGFydGVkIHx8ICFpc0xhc3RUZXN0UnVuKVxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgICAgICAgIHRlc3RSdW4uZmluaXNoID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRlc3RSdW4uZmluaXNoID0gbnVsbDtcblxuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIF9vblRlc3RSdW5SZWFkeVRvTmV4dCAodGVzdFJ1bikge1xuICAgICAgICB0ZXN0UnVuLnNldFJlYWR5VG9OZXh0KCk7XG4gICAgfVxuXG4gICAgX2lzVGVzdEZpbmlzaGVkICh0ZXN0UnVuKSB7XG4gICAgICAgIGNvbnN0IHsgcXVhcmFudGluZSwgZXJycyB9ID0gdGVzdFJ1bjtcblxuICAgICAgICBpZiAoIXF1YXJhbnRpbmUpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcblxuICAgICAgICByZXR1cm4gcXVhcmFudGluZS5pc0ZpcnN0QXR0ZW1wdFN1Y2Nlc3NmdWwoZXJycykgfHwgcXVhcmFudGluZS5pc1RocmVzaG9sZFJlYWNoZWQoZXJycyk7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBMaXZlTW9kZVRlc3RSdW5Db250cm9sbGVyO1xuIl19