"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const endpoint_utils_1 = require("endpoint-utils");
const create_temp_profile_1 = __importDefault(require("./create-temp-profile"));
const is_docker_1 = __importDefault(require("is-docker"));
class ChromeRuntimeInfo {
    constructor(config) {
        this.config = config;
        this.tempProfileDir = null;
        this.cdpPort = this.config.cdpPort;
        this.inDocker = is_docker_1.default();
    }
    async createTempProfile(proxyHostName, disableMultipleWindows) {
        return await create_temp_profile_1.default(proxyHostName, disableMultipleWindows);
    }
    static async create(proxyHostName, config, disableMultipleWindows) {
        const runtimeInfo = new this(config);
        if (!runtimeInfo.config.userProfile)
            runtimeInfo.tempProfileDir = await runtimeInfo.createTempProfile(proxyHostName, disableMultipleWindows);
        if (!runtimeInfo.cdpPort && !runtimeInfo.config.userProfile)
            runtimeInfo.cdpPort = await endpoint_utils_1.getFreePort();
        return runtimeInfo;
    }
}
exports.default = ChromeRuntimeInfo;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicnVudGltZS1pbmZvLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2Jyb3dzZXIvcHJvdmlkZXIvYnVpbHQtaW4vZGVkaWNhdGVkL2Nocm9tZS9ydW50aW1lLWluZm8udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxtREFBNkM7QUFDN0MsZ0ZBQXNEO0FBQ3RELDBEQUFpQztBQUlqQyxNQUFxQixpQkFBaUI7SUFPbEMsWUFBdUIsTUFBYztRQUNqQyxJQUFJLENBQUMsTUFBTSxHQUFXLE1BQU0sQ0FBQztRQUM3QixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQztRQUMzQixJQUFJLENBQUMsT0FBTyxHQUFVLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDO1FBQzFDLElBQUksQ0FBQyxRQUFRLEdBQVMsbUJBQVEsRUFBRSxDQUFDO0lBQ3JDLENBQUM7SUFFUyxLQUFLLENBQUMsaUJBQWlCLENBQUUsYUFBcUIsRUFBRSxzQkFBK0I7UUFDckYsT0FBTyxNQUFNLDZCQUFpQixDQUFDLGFBQWEsRUFBRSxzQkFBc0IsQ0FBQyxDQUFDO0lBQzFFLENBQUM7SUFFTSxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBRSxhQUFxQixFQUFFLE1BQWMsRUFBRSxzQkFBK0I7UUFDOUYsTUFBTSxXQUFXLEdBQUcsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFckMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsV0FBVztZQUMvQixXQUFXLENBQUMsY0FBYyxHQUFHLE1BQU0sV0FBVyxDQUFDLGlCQUFpQixDQUFDLGFBQWEsRUFBRSxzQkFBc0IsQ0FBQyxDQUFDO1FBRTVHLElBQUksQ0FBQyxXQUFXLENBQUMsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxXQUFXO1lBQ3ZELFdBQVcsQ0FBQyxPQUFPLEdBQUcsTUFBTSw0QkFBVyxFQUFFLENBQUM7UUFFOUMsT0FBTyxXQUFXLENBQUM7SUFDdkIsQ0FBQztDQUNKO0FBN0JELG9DQTZCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdldEZyZWVQb3J0IH0gZnJvbSAnZW5kcG9pbnQtdXRpbHMnO1xuaW1wb3J0IGNyZWF0ZVRlbXBQcm9maWxlIGZyb20gJy4vY3JlYXRlLXRlbXAtcHJvZmlsZSc7XG5pbXBvcnQgaXNEb2NrZXIgZnJvbSAnaXMtZG9ja2VyJztcbmltcG9ydCBUZW1wRGlyZWN0b3J5IGZyb20gJy4uLy4uLy4uLy4uLy4uL3V0aWxzL3RlbXAtZGlyZWN0b3J5JztcbmltcG9ydCB7IENvbmZpZyB9IGZyb20gJy4vaW50ZXJmYWNlcyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENocm9tZVJ1bnRpbWVJbmZvIHtcbiAgICBwdWJsaWMgY29uZmlnOiBDb25maWc7XG4gICAgcHVibGljIHRlbXBQcm9maWxlRGlyOiBudWxsIHwgVGVtcERpcmVjdG9yeTtcbiAgICBwdWJsaWMgY2RwUG9ydDogbnVtYmVyO1xuICAgIHB1YmxpYyBpbkRvY2tlcjogYm9vbGVhbjtcbiAgICBwdWJsaWMgYnJvd3Nlck5hbWU/OiBzdHJpbmc7XG5cbiAgICBwcm90ZWN0ZWQgY29uc3RydWN0b3IgKGNvbmZpZzogQ29uZmlnKSB7XG4gICAgICAgIHRoaXMuY29uZmlnICAgICAgICAgPSBjb25maWc7XG4gICAgICAgIHRoaXMudGVtcFByb2ZpbGVEaXIgPSBudWxsO1xuICAgICAgICB0aGlzLmNkcFBvcnQgICAgICAgID0gdGhpcy5jb25maWcuY2RwUG9ydDtcbiAgICAgICAgdGhpcy5pbkRvY2tlciAgICAgICA9IGlzRG9ja2VyKCk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGFzeW5jIGNyZWF0ZVRlbXBQcm9maWxlIChwcm94eUhvc3ROYW1lOiBzdHJpbmcsIGRpc2FibGVNdWx0aXBsZVdpbmRvd3M6IGJvb2xlYW4pOiBQcm9taXNlPFRlbXBEaXJlY3Rvcnk+IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IGNyZWF0ZVRlbXBQcm9maWxlKHByb3h5SG9zdE5hbWUsIGRpc2FibGVNdWx0aXBsZVdpbmRvd3MpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgYXN5bmMgY3JlYXRlIChwcm94eUhvc3ROYW1lOiBzdHJpbmcsIGNvbmZpZzogQ29uZmlnLCBkaXNhYmxlTXVsdGlwbGVXaW5kb3dzOiBib29sZWFuKTogUHJvbWlzZTxDaHJvbWVSdW50aW1lSW5mbz4ge1xuICAgICAgICBjb25zdCBydW50aW1lSW5mbyA9IG5ldyB0aGlzKGNvbmZpZyk7XG5cbiAgICAgICAgaWYgKCFydW50aW1lSW5mby5jb25maWcudXNlclByb2ZpbGUpXG4gICAgICAgICAgICBydW50aW1lSW5mby50ZW1wUHJvZmlsZURpciA9IGF3YWl0IHJ1bnRpbWVJbmZvLmNyZWF0ZVRlbXBQcm9maWxlKHByb3h5SG9zdE5hbWUsIGRpc2FibGVNdWx0aXBsZVdpbmRvd3MpO1xuXG4gICAgICAgIGlmICghcnVudGltZUluZm8uY2RwUG9ydCAmJiAhcnVudGltZUluZm8uY29uZmlnLnVzZXJQcm9maWxlKVxuICAgICAgICAgICAgcnVudGltZUluZm8uY2RwUG9ydCA9IGF3YWl0IGdldEZyZWVQb3J0KCk7XG5cbiAgICAgICAgcmV0dXJuIHJ1bnRpbWVJbmZvO1xuICAgIH1cbn1cbiJdfQ==