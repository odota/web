"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const runtime_1 = require("../errors/runtime");
const types_1 = require("../errors/types");
class ReporterStreamController {
    constructor(messageBus, reporters) {
        this._pluginInfos = [];
        this._messageBus = messageBus;
        this.multipleStreamError = null;
        reporters.forEach(({ plugin }) => {
            plugin.streamController = this;
        });
    }
    ensureUniqueStream(stream, plugin) {
        const pluginInfo = this._pluginInfos.find(info => info.stream === stream);
        if (!pluginInfo)
            this._pluginInfos.push({ stream: stream, plugin: plugin });
        else if (pluginInfo.plugin !== plugin) {
            const message = [pluginInfo.plugin.name, plugin.name].join(', ');
            this.multipleStreamError = new runtime_1.GeneralError(types_1.RUNTIME_ERRORS.multipleSameStreamReporters, message);
            this._messageBus.emit('done');
            return false;
        }
        return true;
    }
}
exports.default = ReporterStreamController;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVwb3J0ZXItc3RyZWFtLWNvbnRyb2xsZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvcnVubmVyL3JlcG9ydGVyLXN0cmVhbS1jb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBRUEsK0NBQWlEO0FBQ2pELDJDQUFpRDtBQVNqRCxNQUFNLHdCQUF3QjtJQUsxQixZQUFvQixVQUF3QixFQUFFLFNBQXFCO1FBQy9ELElBQUksQ0FBQyxZQUFZLEdBQUcsRUFBRSxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxXQUFXLEdBQUcsVUFBVSxDQUFDO1FBQzlCLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUM7UUFFaEMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRTtZQUM3QixNQUFNLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDO1FBQ25DLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVNLGtCQUFrQixDQUFFLE1BQWdCLEVBQUUsTUFBMEI7UUFDbkUsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxLQUFLLE1BQU0sQ0FBQyxDQUFDO1FBRTFFLElBQUksQ0FBQyxVQUFVO1lBQ1gsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO2FBQzFELElBQUksVUFBVSxDQUFDLE1BQU0sS0FBSyxNQUFNLEVBQUU7WUFDbkMsTUFBTSxPQUFPLEdBQUcsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRWpFLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLHNCQUFZLENBQUMsc0JBQWMsQ0FBQywyQkFBMkIsRUFBRSxPQUFPLENBQUMsQ0FBQztZQUVqRyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUU5QixPQUFPLEtBQUssQ0FBQztTQUNoQjtRQUVELE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7Q0FDSjtBQUVELGtCQUFlLHdCQUF3QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRzJztcbmltcG9ydCB7IFdyaXRhYmxlIH0gZnJvbSAnc3RyZWFtJztcbmltcG9ydCB7IEdlbmVyYWxFcnJvciB9IGZyb20gJy4uL2Vycm9ycy9ydW50aW1lJztcbmltcG9ydCB7IFJVTlRJTUVfRVJST1JTIH0gZnJvbSAnLi4vZXJyb3JzL3R5cGVzJztcbmltcG9ydCBSZXBvcnRlciBmcm9tICcuLi9yZXBvcnRlcic7XG5pbXBvcnQgUmVwb3J0ZXJQbHVnaW5Ib3N0IGZyb20gJy4uL3JlcG9ydGVyL3BsdWdpbi1ob3N0JztcblxuaW50ZXJmYWNlIFBsdWdpbkluZm8ge1xuICAgIHN0cmVhbTogV3JpdGFibGU7XG4gICAgcGx1Z2luOiBSZXBvcnRlclBsdWdpbkhvc3Q7XG59XG5cbmNsYXNzIFJlcG9ydGVyU3RyZWFtQ29udHJvbGxlciB7XG4gICAgcHVibGljIG11bHRpcGxlU3RyZWFtRXJyb3I6IEdlbmVyYWxFcnJvciB8IG51bGw7XG4gICAgcHJpdmF0ZSBfcGx1Z2luSW5mb3M6IFBsdWdpbkluZm9bXTtcbiAgICBwcml2YXRlIF9tZXNzYWdlQnVzOiBFdmVudEVtaXR0ZXI7XG5cbiAgICBwdWJsaWMgY29uc3RydWN0b3IgKG1lc3NhZ2VCdXM6IEV2ZW50RW1pdHRlciwgcmVwb3J0ZXJzOiBSZXBvcnRlcltdKSB7XG4gICAgICAgIHRoaXMuX3BsdWdpbkluZm9zID0gW107XG4gICAgICAgIHRoaXMuX21lc3NhZ2VCdXMgPSBtZXNzYWdlQnVzO1xuICAgICAgICB0aGlzLm11bHRpcGxlU3RyZWFtRXJyb3IgPSBudWxsO1xuXG4gICAgICAgIHJlcG9ydGVycy5mb3JFYWNoKCh7IHBsdWdpbiB9KSA9PiB7XG4gICAgICAgICAgICBwbHVnaW4uc3RyZWFtQ29udHJvbGxlciA9IHRoaXM7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBlbnN1cmVVbmlxdWVTdHJlYW0gKHN0cmVhbTogV3JpdGFibGUsIHBsdWdpbjogUmVwb3J0ZXJQbHVnaW5Ib3N0KTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IHBsdWdpbkluZm8gPSB0aGlzLl9wbHVnaW5JbmZvcy5maW5kKGluZm8gPT4gaW5mby5zdHJlYW0gPT09IHN0cmVhbSk7XG5cbiAgICAgICAgaWYgKCFwbHVnaW5JbmZvKVxuICAgICAgICAgICAgdGhpcy5fcGx1Z2luSW5mb3MucHVzaCh7IHN0cmVhbTogc3RyZWFtLCBwbHVnaW46IHBsdWdpbiB9KTtcbiAgICAgICAgZWxzZSBpZiAocGx1Z2luSW5mby5wbHVnaW4gIT09IHBsdWdpbikge1xuICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IFtwbHVnaW5JbmZvLnBsdWdpbi5uYW1lLCBwbHVnaW4ubmFtZV0uam9pbignLCAnKTtcblxuICAgICAgICAgICAgdGhpcy5tdWx0aXBsZVN0cmVhbUVycm9yID0gbmV3IEdlbmVyYWxFcnJvcihSVU5USU1FX0VSUk9SUy5tdWx0aXBsZVNhbWVTdHJlYW1SZXBvcnRlcnMsIG1lc3NhZ2UpO1xuXG4gICAgICAgICAgICB0aGlzLl9tZXNzYWdlQnVzLmVtaXQoJ2RvbmUnKTtcblxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBSZXBvcnRlclN0cmVhbUNvbnRyb2xsZXI7XG4iXX0=