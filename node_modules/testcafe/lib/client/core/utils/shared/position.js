"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.calcRelativePosition = exports.getElementFromPoint = exports.getClientDimensions = void 0;
const index_1 = __importDefault(require("./adapter/index"));
const boundary_values_1 = __importDefault(require("../../../../shared/utils/values/boundary-values"));
const dimensions_1 = __importDefault(require("../../../../shared/utils/values/dimensions"));
const axis_values_1 = __importDefault(require("../../../../shared/utils/values/axis-values"));
function getClientDimensions(target) {
    const isHtmlElement = index_1.default.dom.isHtmlElement(target);
    const body = isHtmlElement ? target.getElementsByTagName('body')[0] : null;
    const elementRect = target.getBoundingClientRect();
    const elBorders = boundary_values_1.default.create(index_1.default.style.getBordersWidth(target));
    const elScroll = index_1.default.style.getElementScroll(target);
    const isElementInIframe = index_1.default.dom.isElementInIframe(target);
    const isCompatMode = target.ownerDocument.compatMode === 'BackCompat';
    const elPosition = isHtmlElement ? new axis_values_1.default(0, 0) : axis_values_1.default.create(elementRect);
    let elHeight = elementRect.height;
    let elWidth = elementRect.width;
    if (isHtmlElement) {
        if (body && isCompatMode) {
            elHeight = body.clientHeight;
            elWidth = body.clientWidth;
        }
        else {
            elHeight = target.clientHeight;
            elWidth = target.clientWidth;
        }
    }
    if (isElementInIframe) {
        const iframeElement = index_1.default.dom.getIframeByElement(target);
        if (iframeElement) {
            const iframeOffset = index_1.default.position.getOffsetPosition(iframeElement);
            const clientOffset = index_1.default.position.offsetToClientCoords(axis_values_1.default.create(iframeOffset));
            const iframeBorders = index_1.default.style.getBordersWidth(iframeElement);
            elPosition.add(clientOffset).add(axis_values_1.default.create(iframeBorders));
            if (isHtmlElement)
                elBorders.add(iframeBorders);
        }
    }
    const hasRightScrollbar = !isHtmlElement && index_1.default.style.getInnerWidth(target) !== target.clientWidth;
    const hasBottomScrollbar = !isHtmlElement && index_1.default.style.getInnerHeight(target) !== target.clientHeight;
    const scrollbar = {
        right: hasRightScrollbar ? index_1.default.dom.getScrollbarSize() : 0,
        bottom: hasBottomScrollbar ? index_1.default.dom.getScrollbarSize() : 0,
    };
    return new dimensions_1.default(elWidth, elHeight, elPosition, elBorders, elScroll, scrollbar);
}
exports.getClientDimensions = getClientDimensions;
function getElementFromPoint({ x, y }) {
    // @ts-ignore
    const ieFn = document.getElementFromPoint;
    const func = ieFn || document.elementFromPoint;
    let el = null;
    try {
        // Permission denied to access property 'getElementFromPoint' error in iframe
        el = func.call(document, x, y);
    }
    catch (_a) {
        return null;
    }
    //NOTE: elementFromPoint returns null when is's a border of an iframe
    if (el === null)
        el = func.call(document, x - 1, y - 1);
    while (el && el.shadowRoot && el.shadowRoot.elementFromPoint) {
        const shadowEl = el.shadowRoot.elementFromPoint(x, y);
        if (!shadowEl || el === shadowEl)
            break;
        el = shadowEl;
    }
    return el;
}
exports.getElementFromPoint = getElementFromPoint;
function calcRelativePosition(dimensions, toDimensions) {
    const pos = boundary_values_1.default.create({
        top: dimensions.top - toDimensions.top,
        left: dimensions.left - toDimensions.left,
        right: toDimensions.right - dimensions.right,
        bottom: toDimensions.bottom - dimensions.bottom,
    });
    return pos.sub(toDimensions.border).sub(toDimensions.scrollbar).round(Math.ceil, Math.floor);
}
exports.calcRelativePosition = calcRelativePosition;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9zaXRpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvY2xpZW50L2NvcmUvdXRpbHMvc2hhcmVkL3Bvc2l0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLDREQUFzQztBQUN0QyxzR0FBcUc7QUFDckcsNEZBQW9FO0FBQ3BFLDhGQUF5RjtBQUV6RixTQUFnQixtQkFBbUIsQ0FBRSxNQUFlO0lBQ2hELE1BQU0sYUFBYSxHQUFPLGVBQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzVELE1BQU0sSUFBSSxHQUFnQixhQUFhLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQ3hGLE1BQU0sV0FBVyxHQUFTLE1BQU0sQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO0lBQ3pELE1BQU0sU0FBUyxHQUFXLHlCQUFjLENBQUMsTUFBTSxDQUFDLGVBQU8sQ0FBQyxLQUFLLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDdkYsTUFBTSxRQUFRLEdBQVksZUFBTyxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNqRSxNQUFNLGlCQUFpQixHQUFHLGVBQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDaEUsTUFBTSxZQUFZLEdBQVEsTUFBTSxDQUFDLGFBQWEsQ0FBQyxVQUFVLEtBQUssWUFBWSxDQUFDO0lBQzNFLE1BQU0sVUFBVSxHQUFVLGFBQWEsQ0FBQyxDQUFDLENBQUMsSUFBSSxxQkFBVSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMscUJBQVUsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUM7SUFFaEcsSUFBSSxRQUFRLEdBQUssV0FB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QUFDLFVBQVUsQ0FBQyxnQkFBZ0IsRUFBRTtRQUMxRCxNQUFNLFFBQVEsR0FBRyxFQUFFLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUV0RCxJQUFJLENBQUMsUUFBUSxJQUFJLEVBQUUsS0FBSyxRQUFRO1lBQzVCLE1BQU07UUFFVixFQUFFLEdBQUcsUUFBUSxDQUFDO0tBQ2pCO0lBRUQsT0FBTyxFQUFFLENBQUM7QUFDZCxDQUFDO0FBN0JELGtEQTZCQztBQUVELFNBQWdCLG9CQUFvQixDQUFFLFVBQXNCLEVBQUUsWUFBd0I7SUFDbEYsTUFBTSxHQUFHLEdBQUcseUJBQWMsQ0FBQyxNQUFNLENBQUM7UUFDOUIsR0FBRyxFQUFLLFVBQVUsQ0FBQyxHQUFHLEdBQUcsWUFBWSxDQUFDLEdBQUc7UUFDekMsSUFBSSxFQUFJLFVBQVUsQ0FBQyxJQUFJLEdBQUcsWUFBWSxDQUFDLElBQUk7UUFDM0MsS0FBSyxFQUFHLFlBQVksQ0FBQyxLQUFLLEdBQUcsVUFBVSxDQUFDLEtBQUs7UUFDN0MsTUFBTSxFQUFFLFlBQVksQ0FBQyxNQUFNLEdBQUcsVUFBVSxDQUFDLE1BQU07S0FDbEQsQ0FBQyxDQUFDO0lBRUgsT0FBTyxHQUFHLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNqRyxDQUFDO0FBVEQsb0RBU0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYWRhcHRlciBmcm9tICcuL2FkYXB0ZXIvaW5kZXgnO1xuaW1wb3J0IEJvdW5kYXJ5VmFsdWVzLCB7IEJvdW5kYXJ5VmFsdWVzRGF0YSB9IGZyb20gJy4uLy4uLy4uLy4uL3NoYXJlZC91dGlscy92YWx1ZXMvYm91bmRhcnktdmFsdWVzJztcbmltcG9ydCBEaW1lbnNpb25zIGZyb20gJy4uLy4uLy4uLy4uL3NoYXJlZC91dGlscy92YWx1ZXMvZGltZW5zaW9ucyc7XG5pbXBvcnQgQXhpc1ZhbHVlcywgeyBBeGlzVmFsdWVzRGF0YSB9IGZyb20gJy4uLy4uLy4uLy4uL3NoYXJlZC91dGlscy92YWx1ZXMvYXhpcy12YWx1ZXMnO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2xpZW50RGltZW5zaW9ucyAodGFyZ2V0OiBFbGVtZW50KTogRGltZW5zaW9ucyB7XG4gICAgY29uc3QgaXNIdG1sRWxlbWVudCAgICAgPSBhZGFwdGVyLmRvbS5pc0h0bWxFbGVtZW50KHRhcmdldCk7XG4gICAgY29uc3QgYm9keSAgICAgICAgICAgICAgPSBpc0h0bWxFbGVtZW50ID8gdGFyZ2V0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdib2R5JylbMF0gOiBudWxsO1xuICAgIGNvbnN0IGVsZW1lbnRSZWN0ICAgICAgID0gdGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIGNvbnN0IGVsQm9yZGVycyAgICAgICAgID0gQm91bmRhcnlWYWx1ZXMuY3JlYXRlKGFkYXB0ZXIuc3R5bGUuZ2V0Qm9yZGVyc1dpZHRoKHRhcmdldCkpO1xuICAgIGNvbnN0IGVsU2Nyb2xsICAgICAgICAgID0gYWRhcHRlci5zdHlsZS5nZXRFbGVtZW50U2Nyb2xsKHRhcmdldCk7XG4gICAgY29uc3QgaXNFbGVtZW50SW5JZnJhbWUgPSBhZGFwdGVyLmRvbS5pc0VsZW1lbnRJbklmcmFtZSh0YXJnZXQpO1xuICAgIGNvbnN0IGlzQ29tcGF0TW9kZSAgICAgID0gdGFyZ2V0Lm93bmVyRG9jdW1lbnQuY29tcGF0TW9kZSA9PT0gJ0JhY2tDb21wYXQnO1xuICAgIGNvbnN0IGVsUG9zaXRpb24gICAgICAgID0gaXNIdG1sRWxlbWVudCA/IG5ldyBBeGlzVmFsdWVzKDAsIDApIDogQXhpc1ZhbHVlcy5jcmVhdGUoZWxlbWVudFJlY3QpO1xuXG4gICAgbGV0IGVsSGVpZ2h0ICAgPSBlbGVtZW50UmVjdC5oZWlnaHQ7XG4gICAgbGV0IGVsV2lkdGggICAgPSBlbGVtZW50UmVjdC53aWR0aDtcblxuICAgIGlmIChpc0h0bWxFbGVtZW50KSB7XG4gICAgICAgIGlmIChib2R5ICYmIGlzQ29tcGF0TW9kZSkge1xuICAgICAgICAgICAgZWxIZWlnaHQgPSBib2R5LmNsaWVudEhlaWdodDtcbiAgICAgICAgICAgIGVsV2lkdGggID0gYm9keS5jbGllbnRXaWR0aDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGVsSGVpZ2h0ID0gdGFyZ2V0LmNsaWVudEhlaWdodDtcbiAgICAgICAgICAgIGVsV2lkdGggID0gdGFyZ2V0LmNsaWVudFdpZHRoO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGlzRWxlbWVudEluSWZyYW1lKSB7XG4gICAgICAgIGNvbnN0IGlmcmFtZUVsZW1lbnQgPSBhZGFwdGVyLmRvbS5nZXRJZnJhbWVCeUVsZW1lbnQodGFyZ2V0KTtcblxuICAgICAgICBpZiAoaWZyYW1lRWxlbWVudCkge1xuICAgICAgICAgICAgY29uc3QgaWZyYW1lT2Zmc2V0ICA9IGFkYXB0ZXIucG9zaXRpb24uZ2V0T2Zmc2V0UG9zaXRpb24oaWZyYW1lRWxlbWVudCk7XG4gICAgICAgICAgICBjb25zdCBjbGllbnRPZmZzZXQgID0gYWRhcHRlci5wb3NpdGlvbi5vZmZzZXRUb0NsaWVudENvb3JkcyhBeGlzVmFsdWVzLmNyZWF0ZShpZnJhbWVPZmZzZXQpKTtcbiAgICAgICAgICAgIGNvbnN0IGlmcmFtZUJvcmRlcnMgPSBhZGFwdGVyLnN0eWxlLmdldEJvcmRlcnNXaWR0aChpZnJhbWVFbGVtZW50KTtcblxuICAgICAgICAgICAgZWxQb3NpdGlvbi5hZGQoY2xpZW50T2Zmc2V0KS5hZGQoQXhpc1ZhbHVlcy5jcmVhdGUoaWZyYW1lQm9yZGVycykpO1xuXG4gICAgICAgICAgICBpZiAoaXNIdG1sRWxlbWVudClcbiAgICAgICAgICAgICAgICBlbEJvcmRlcnMuYWRkKGlmcmFtZUJvcmRlcnMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgaGFzUmlnaHRTY3JvbGxiYXIgID0gIWlzSHRtbEVsZW1lbnQgJiYgYWRhcHRlci5zdHlsZS5nZXRJbm5lcldpZHRoKHRhcmdldCkgIT09IHRhcmdldC5jbGllbnRXaWR0aDtcbiAgICBjb25zdCBoYXNCb3R0b21TY3JvbGxiYXIgPSAhaXNIdG1sRWxlbWVudCAmJiBhZGFwdGVyLnN0eWxlLmdldElubmVySGVpZ2h0KHRhcmdldCkgIT09IHRhcmdldC5jbGllbnRIZWlnaHQ7XG5cbiAgICBjb25zdCBzY3JvbGxiYXIgPSB7XG4gICAgICAgIHJpZ2h0OiAgaGFzUmlnaHRTY3JvbGxiYXIgPyBhZGFwdGVyLmRvbS5nZXRTY3JvbGxiYXJTaXplKCkgOiAwLFxuICAgICAgICBib3R0b206IGhhc0JvdHRvbVNjcm9sbGJhciA/IGFkYXB0ZXIuZG9tLmdldFNjcm9sbGJhclNpemUoKSA6IDAsXG4gICAgfTtcblxuICAgIHJldHVybiBuZXcgRGltZW5zaW9ucyhlbFdpZHRoLCBlbEhlaWdodCwgZWxQb3NpdGlvbiwgZWxCb3JkZXJzLCBlbFNjcm9sbCwgc2Nyb2xsYmFyKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldEVsZW1lbnRGcm9tUG9pbnQgKHsgeCwgeSB9OiBBeGlzVmFsdWVzRGF0YTxudW1iZXI+KTogRWxlbWVudCB8IG51bGwge1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBjb25zdCBpZUZuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEZyb21Qb2ludDtcbiAgICBjb25zdCBmdW5jID0gaWVGbiB8fCBkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50O1xuXG4gICAgbGV0IGVsOiBFbGVtZW50IHwgbnVsbCA9IG51bGw7XG5cbiAgICB0cnkge1xuICAgICAgICAvLyBQZXJtaXNzaW9uIGRlbmllZCB0byBhY2Nlc3MgcHJvcGVydHkgJ2dldEVsZW1lbnRGcm9tUG9pbnQnIGVycm9yIGluIGlmcmFtZVxuICAgICAgICBlbCA9IGZ1bmMuY2FsbChkb2N1bWVudCwgeCwgeSk7XG4gICAgfVxuICAgIGNhdGNoIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgLy9OT1RFOiBlbGVtZW50RnJvbVBvaW50IHJldHVybnMgbnVsbCB3aGVuIGlzJ3MgYSBib3JkZXIgb2YgYW4gaWZyYW1lXG4gICAgaWYgKGVsID09PSBudWxsKVxuICAgICAgICBlbCA9IGZ1bmMuY2FsbChkb2N1bWVudCwgeCAtIDEsIHkgLSAxKTtcblxuICAgIHdoaWxlIChlbCAmJiBlbC5zaGFkb3dSb290ICYmIGVsLnNoYWRvd1Jvb3QuZWxlbWVudEZyb21Qb2ludCkge1xuICAgICAgICBjb25zdCBzaGFkb3dFbCA9IGVsLnNoYWRvd1Jvb3QuZWxlbWVudEZyb21Qb2ludCh4LCB5KTtcblxuICAgICAgICBpZiAoIXNoYWRvd0VsIHx8IGVsID09PSBzaGFkb3dFbClcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGVsID0gc2hhZG93RWw7XG4gICAgfVxuXG4gICAgcmV0dXJuIGVsO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2FsY1JlbGF0aXZlUG9zaXRpb24gKGRpbWVuc2lvbnM6IERpbWVuc2lvbnMsIHRvRGltZW5zaW9uczogRGltZW5zaW9ucyk6IEJvdW5kYXJ5VmFsdWVzRGF0YSB7XG4gICAgY29uc3QgcG9zID0gQm91bmRhcnlWYWx1ZXMuY3JlYXRlKHtcbiAgICAgICAgdG9wOiAgICBkaW1lbnNpb25zLnRvcCAtIHRvRGltZW5zaW9ucy50b3AsXG4gICAgICAgIGxlZnQ6ICAgZGltZW5zaW9ucy5sZWZ0IC0gdG9EaW1lbnNpb25zLmxlZnQsXG4gICAgICAgIHJpZ2h0OiAgdG9EaW1lbnNpb25zLnJpZ2h0IC0gZGltZW5zaW9ucy5yaWdodCxcbiAgICAgICAgYm90dG9tOiB0b0RpbWVuc2lvbnMuYm90dG9tIC0gZGltZW5zaW9ucy5ib3R0b20sXG4gICAgfSk7XG5cbiAgICByZXR1cm4gcG9zLnN1Yih0b0RpbWVuc2lvbnMuYm9yZGVyKS5zdWIodG9EaW1lbnNpb25zLnNjcm9sbGJhcikucm91bmQoTWF0aC5jZWlsLCBNYXRoLmZsb29yKTtcbn1cbiJdfQ==