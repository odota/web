"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getScrollableParents = exports.hasScroll = void 0;
const index_1 = __importDefault(require("./adapter/index"));
const axis_values_1 = __importDefault(require("../../../../shared/utils/values/axis-values"));
const SCROLLABLE_OVERFLOW_STYLE_RE = /auto|scroll|hidden/i;
const DEFAULT_IE_SCROLLABLE_OVERFLOW_STYLE_VALUE = 'visible';
function getScrollable(el) {
    const overflowX = index_1.default.style.get(el, 'overflowX');
    const overflowY = index_1.default.style.get(el, 'overflowY');
    let scrollableHorizontally = SCROLLABLE_OVERFLOW_STYLE_RE.test(overflowX);
    let scrollableVertically = SCROLLABLE_OVERFLOW_STYLE_RE.test(overflowY);
    // IE11 and MS Edge bug: There are two properties: overflow-x and overflow-y.
    // If one property is set so that the browser may show scrollbars (`auto` or `scroll`) and the second one is set to 'visible',
    // then the second one will work as if it had the 'auto' value.
    if (index_1.default.browser.isIE) {
        scrollableHorizontally = scrollableHorizontally || scrollableVertically && overflowX === DEFAULT_IE_SCROLLABLE_OVERFLOW_STYLE_VALUE;
        scrollableVertically = scrollableVertically || scrollableHorizontally && overflowY === DEFAULT_IE_SCROLLABLE_OVERFLOW_STYLE_VALUE;
    }
    return new axis_values_1.default(scrollableHorizontally, scrollableVertically);
}
function hasBodyScroll(el) {
    const overflowX = index_1.default.style.get(el, 'overflowX');
    const overflowY = index_1.default.style.get(el, 'overflowY');
    const scrollableHorizontally = SCROLLABLE_OVERFLOW_STYLE_RE.test(overflowX);
    const scrollableVertically = SCROLLABLE_OVERFLOW_STYLE_RE.test(overflowY);
    const documentElement = index_1.default.dom.findDocument(el).documentElement;
    let bodyScrollHeight = el.scrollHeight;
    if (index_1.default.browser.isChrome || index_1.default.browser.isFirefox || index_1.default.browser.isSafari) {
        const { top: bodyTop } = el.getBoundingClientRect();
        const { top: documentTop } = documentElement.getBoundingClientRect();
        bodyScrollHeight = bodyScrollHeight - documentTop + bodyTop;
    }
    return (scrollableHorizontally || scrollableVertically) &&
        bodyScrollHeight > documentElement.scrollHeight;
}
function hasHTMLElementScroll(el) {
    const overflowX = index_1.default.style.get(el, 'overflowX');
    const overflowY = index_1.default.style.get(el, 'overflowY');
    //T303226
    if (overflowX === 'hidden' && overflowY === 'hidden')
        return false;
    const hasHorizontalScroll = el.scrollHeight > el.clientHeight;
    const hasVerticalScroll = el.scrollWidth > el.clientWidth;
    if (hasHorizontalScroll || hasVerticalScroll)
        return true;
    //T174562 - wrong scrolling in iframes without src and others iframes
    const body = el.getElementsByTagName('body')[0];
    if (!body)
        return false;
    if (hasBodyScroll(body))
        return false;
    const clientWidth = Math.min(el.clientWidth, body.clientWidth);
    const clientHeight = Math.min(el.clientHeight, body.clientHeight);
    return body.scrollHeight > clientHeight || body.scrollWidth > clientWidth;
}
function hasScroll(el) {
    if (index_1.default.dom.isBodyElement(el))
        return hasBodyScroll(el);
    if (index_1.default.dom.isHtmlElement(el))
        return hasHTMLElementScroll(el);
    const scrollable = getScrollable(el);
    if (!scrollable.x && !scrollable.y)
        return false;
    const hasVerticalScroll = scrollable.y && el.scrollHeight > el.clientHeight;
    const hasHorizontalScroll = scrollable.x && el.scrollWidth > el.clientWidth;
    return hasHorizontalScroll || hasVerticalScroll;
}
exports.hasScroll = hasScroll;
function getScrollableParents(element) {
    const parentsArray = index_1.default.dom.getParents(element);
    if (index_1.default.dom.isElementInIframe(element)) {
        const iframe = index_1.default.dom.getIframeByElement(element);
        if (iframe) {
            const iFrameParents = index_1.default.dom.getParents(iframe);
            parentsArray.concat(iFrameParents);
        }
    }
    return index_1.default.nativeMethods.arrayFilter.call(parentsArray, hasScroll);
}
exports.getScrollableParents = getScrollableParents;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Nyb2xsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2NsaWVudC9jb3JlL3V0aWxzL3NoYXJlZC9zY3JvbGwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsNERBQXNDO0FBQ3RDLDhGQUFxRTtBQUdyRSxNQUFNLDRCQUE0QixHQUFpQixxQkFBcUIsQ0FBQztBQUN6RSxNQUFNLDBDQUEwQyxHQUFHLFNBQVMsQ0FBQztBQUU3RCxTQUFTLGFBQWEsQ0FBRSxFQUFXO0lBQy9CLE1BQU0sU0FBUyxHQUFjLGVBQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxXQUFXLENBQVcsQ0FBQztJQUMxRSxNQUFNLFNBQVMsR0FBYyxlQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsV0FBVyxDQUFXLENBQUM7SUFDMUUsSUFBSSxzQkFBc0IsR0FBRyw0QkFBNEIsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDMUUsSUFBSSxvQkFBb0IsR0FBSyw0QkFBNEIsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7SUFFMUUsNkVBQTZFO0lBQzdFLDhIQUE4SDtJQUM5SCwrREFBK0Q7SUFDL0QsSUFBSSxlQUFPLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRTtRQUN0QixzQkFBc0IsR0FBRyxzQkFBc0IsSUFBSSxvQkFBb0IsSUFBSSxTQUFTLEtBQUssMENBQTBDLENBQUM7UUFDcEksb0JBQW9CLEdBQUssb0JBQW9CLElBQUksc0JBQXNCLElBQUksU0FBUyxLQUFLLDBDQUEwQyxDQUFDO0tBQ3ZJO0lBRUQsT0FBTyxJQUFJLHFCQUFVLENBQUMsc0JBQXNCLEVBQUUsb0JBQW9CLENBQUMsQ0FBQztBQUN4RSxDQUFDO0FBRUQsU0FBUyxhQUFhLENBQUUsRUFBbUI7SUFDdkMsTUFBTSxTQUFTLEdBQWdCLGVBQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUUs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VSxHQUFHLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUVyQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQzlCLE9BQU8sS0FBSyxDQUFDO0lBRWpCLE1BQU0saUJBQWlCLEdBQUssVUFBVSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsWUFBWSxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUM7SUFDOUUsTUFBTSxtQkFBbUIsR0FBRyxVQUFVLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxXQUFXLEdBQUcsRUFBRSxDQUFDLFdBQVcsQ0FBQztJQUU1RSxPQUFPLG1CQUFtQixJQUFJLGlCQUFpQixDQUFDO0FBQ3BELENBQUM7QUFoQkQsOEJBZ0JDO0FBRUQsU0FBZ0Isb0JBQW9CLENBQUUsT0FBZ0I7SUFDbEQsTUFBTSxZQUFZLEdBQUcsZUFBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUM7SUFFckQsSUFBSSxlQUFPLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxFQUFFO1FBQ3hDLE1BQU0sTUFBTSxHQUFHLGVBQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFdkQsSUFBSSxNQUFNLEVBQUU7WUFDUixNQUFNLGFBQWEsR0FBRyxlQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUVyRCxZQUFZLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1NBQ3RDO0tBQ0o7SUFFRCxPQUFPLGVBQU8sQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsU0FBUyxDQUFDLENBQUM7QUFDM0UsQ0FBQztBQWRELG9EQWNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGFkYXB0ZXIgZnJvbSAnLi9hZGFwdGVyL2luZGV4JztcbmltcG9ydCBBeGlzVmFsdWVzIGZyb20gJy4uLy4uLy4uLy4uL3NoYXJlZC91dGlscy92YWx1ZXMvYXhpcy12YWx1ZXMnO1xuXG5cbmNvbnN0IFNDUk9MTEFCTEVfT1ZFUkZMT1dfU1RZTEVfUkUgICAgICAgICAgICAgICA9IC9hdXRvfHNjcm9sbHxoaWRkZW4vaTtcbmNvbnN0IERFRkFVTFRfSUVfU0NST0xMQUJMRV9PVkVSRkxPV19TVFlMRV9WQUxVRSA9ICd2aXNpYmxlJztcblxuZnVuY3Rpb24gZ2V0U2Nyb2xsYWJsZSAoZWw6IEVsZW1lbnQpOiBBeGlzVmFsdWVzPGJvb2xlYW4+IHtcbiAgICBjb25zdCBvdmVyZmxvd1ggICAgICAgICAgICA9IGFkYXB0ZXIuc3R5bGUuZ2V0KGVsLCAnb3ZlcmZsb3dYJykgYXMgc3RyaW5nO1xuICAgIGNvbnN0IG92ZXJmbG93WSAgICAgICAgICAgID0gYWRhcHRlci5zdHlsZS5nZXQoZWwsICdvdmVyZmxvd1knKSBhcyBzdHJpbmc7XG4gICAgbGV0IHNjcm9sbGFibGVIb3Jpem9udGFsbHkgPSBTQ1JPTExBQkxFX09WRVJGTE9XX1NUWUxFX1JFLnRlc3Qob3ZlcmZsb3dYKTtcbiAgICBsZXQgc2Nyb2xsYWJsZVZlcnRpY2FsbHkgICA9IFNDUk9MTEFCTEVfT1ZFUkZMT1dfU1RZTEVfUkUudGVzdChvdmVyZmxvd1kpO1xuXG4gICAgLy8gSUUxMSBhbmQgTVMgRWRnZSBidWc6IFRoZXJlIGFyZSB0d28gcHJvcGVydGllczogb3ZlcmZsb3cteCBhbmQgb3ZlcmZsb3cteS5cbiAgICAvLyBJZiBvbmUgcHJvcGVydHkgaXMgc2V0IHNvIHRoYXQgdGhlIGJyb3dzZXIgbWF5IHNob3cgc2Nyb2xsYmFycyAoYGF1dG9gIG9yIGBzY3JvbGxgKSBhbmQgdGhlIHNlY29uZCBvbmUgaXMgc2V0IHRvICd2aXNpYmxlJyxcbiAgICAvLyB0aGVuIHRoZSBzZWNvbmQgb25lIHdpbGwgd29yayBhcyBpZiBpdCBoYWQgdGhlICdhdXRvJyB2YWx1ZS5cbiAgICBpZiAoYWRhcHRlci5icm93c2VyLmlzSUUpIHtcbiAgICAgICAgc2Nyb2xsYWJsZUhvcml6b250YWxseSA9IHNjcm9sbGFibGVIb3Jpem9udGFsbHkgfHwgc2Nyb2xsYWJsZVZlcnRpY2FsbHkgJiYgb3ZlcmZsb3dYID09PSBERUZBVUxUX0lFX1NDUk9MTEFCTEVfT1ZFUkZMT1dfU1RZTEVfVkFMVUU7XG4gICAgICAgIHNjcm9sbGFibGVWZXJ0aWNhbGx5ICAgPSBzY3JvbGxhYmxlVmVydGljYWxseSB8fCBzY3JvbGxhYmxlSG9yaXpvbnRhbGx5ICYmIG92ZXJmbG93WSA9PT0gREVGQVVMVF9JRV9TQ1JPTExBQkxFX09WRVJGTE9XX1NUWUxFX1ZBTFVFO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgQXhpc1ZhbHVlcyhzY3JvbGxhYmxlSG9yaXpvbnRhbGx5LCBzY3JvbGxhYmxlVmVydGljYWxseSk7XG59XG5cbmZ1bmN0aW9uIGhhc0JvZHlTY3JvbGwgKGVsOiBIVE1MQm9keUVsZW1lbnQpOiBib29sZWFuIHtcbiAgICBjb25zdCBvdmVyZmxvd1ggICAgICAgICAgICAgID0gYWRhcHRlci5zdHlsZS5nZXQoZWwsICdvdmVyZmxvd1gnKSBhcyBzdHJpbmc7XG4gICAgY29uc3Qgb3ZlcmZsb3dZICAgICAgICAgICAgICA9IGFkYXB0ZXIuc3R5bGUuZ2V0KGVsLCAnb3ZlcmZsb3dZJykgYXMgc3RyaW5nO1xuICAgIGNvbnN0IHNjcm9sbGFibGVIb3Jpem9udGFsbHkgPSBTQ1JPTExBQkxFX09WRVJGTE9XX1NUWUxFX1JFLnRlc3Qob3ZlcmZsb3dYKTtcbiAgICBjb25zdCBzY3JvbGxhYmxlVmVydGljYWxseSAgID0gU0NST0xMQUJMRV9PVkVSRkxPV19TVFlMRV9SRS50ZXN0KG92ZXJmbG93WSk7XG5cbiAgICBjb25zdCBkb2N1bWVudEVsZW1lbnQgPSBhZGFwdGVyLmRvbS5maW5kRG9jdW1lbnQoZWwpLmRvY3VtZW50RWxlbWVudDtcblxuICAgIGxldCBib2R5U2Nyb2xsSGVpZ2h0ID0gZWwuc2Nyb2xsSGVpZ2h0O1xuXG4gICAgaWYgKGFkYXB0ZXIuYnJvd3Nlci5pc0Nocm9tZSB8fCBhZGFwdGVyLmJyb3dzZXIuaXNGaXJlZm94IHx8IGFkYXB0ZXIuYnJvd3Nlci5pc1NhZmFyaSkge1xuICAgICAgICBjb25zdCB7IHRvcDogYm9keVRvcCB9ICAgICA9IGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICBjb25zdCB7IHRvcDogZG9jdW1lbnRUb3AgfSA9IGRvY3VtZW50RWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgICAgICBib2R5U2Nyb2xsSGVpZ2h0ID0gYm9keVNjcm9sbEhlaWdodCAtIGRvY3VtZW50VG9wICsgYm9keVRvcDtcbiAgICB9XG5cbiAgICByZXR1cm4gKHNjcm9sbGFibGVIb3Jpem9udGFsbHkgfHwgc2Nyb2xsYWJsZVZlcnRpY2FsbHkpICYmXG4gICAgICAgICAgIGJvZHlTY3JvbGxIZWlnaHQgPiBkb2N1bWVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0O1xufVxuXG5mdW5jdGlvbiBoYXNIVE1MRWxlbWVudFNjcm9sbCAoZWw6IEhUTUxIdG1sRWxlbWVudCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IG92ZXJmbG93WCA9IGFkYXB0ZXIuc3R5bGUuZ2V0KGVsLCAnb3ZlcmZsb3dYJykgYXMgc3RyaW5nO1xuICAgIGNvbnN0IG92ZXJmbG93WSA9IGFkYXB0ZXIuc3R5bGUuZ2V0KGVsLCAnb3ZlcmZsb3dZJykgYXMgc3RyaW5nO1xuXG4gICAgLy9UMzAzMjI2XG4gICAgaWYgKG92ZXJmbG93WCA9PT0gJ2hpZGRlbicgJiYgb3ZlcmZsb3dZID09PSAnaGlkZGVuJylcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgY29uc3QgaGFzSG9yaXpvbnRhbFNjcm9sbCA9IGVsLnNjcm9sbEhlaWdodCA+IGVsLmNsaWVudEhlaWdodDtcbiAgICBjb25zdCBoYXNWZXJ0aWNhbFNjcm9sbCAgID0gZWwuc2Nyb2xsV2lkdGggPiBlbC5jbGllbnRXaWR0aDtcblxuICAgIGlmIChoYXNIb3Jpem9udGFsU2Nyb2xsIHx8IGhhc1ZlcnRpY2FsU2Nyb2xsKVxuICAgICAgICByZXR1cm4gdHJ1ZTtcblxuICAgIC8vVDE3NDU2MiAtIHdyb25nIHNjcm9sbGluZyBpbiBpZnJhbWVzIHdpdGhvdXQgc3JjIGFuZCBvdGhlcnMgaWZyYW1lc1xuICAgIGNvbnN0IGJvZHkgPSBlbC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYm9keScpWzBdO1xuXG4gICAgaWYgKCFib2R5KVxuICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICBpZiAoaGFzQm9keVNjcm9sbChib2R5KSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgY29uc3QgY2xpZW50V2lkdGggID0gTWF0aC5taW4oZWwuY2xpZW50V2lkdGgsIGJvZHkuY2xpZW50V2lkdGgpO1xuICAgIGNvbnN0IGNsaWVudEhlaWdodCA9IE1hdGgubWluKGVsLmNsaWVudEhlaWdodCwgYm9keS5jbGllbnRIZWlnaHQpO1xuXG4gICAgcmV0dXJuIGJvZHkuc2Nyb2xsSGVpZ2h0ID4gY2xpZW50SGVpZ2h0IHx8IGJvZHkuc2Nyb2xsV2lkdGggPiBjbGllbnRXaWR0aDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhhc1Njcm9sbCAoZWw6IEVsZW1lbnQpOiBib29sZWFuIHtcbiAgICBpZiAoYWRhcHRlci5kb20uaXNCb2R5RWxlbWVudChlbCkpXG4gICAgICAgIHJldHVybiBoYXNCb2R5U2Nyb2xsKGVsKTtcblxuICAgIGlmIChhZGFwdGVyLmRvbS5pc0h0bWxFbGVtZW50KGVsKSlcbiAgICAgICAgcmV0dXJuIGhhc0hUTUxFbGVtZW50U2Nyb2xsKGVsKTtcblxuICAgIGNvbnN0IHNjcm9sbGFibGUgPSBnZXRTY3JvbGxhYmxlKGVsKTtcblxuICAgIGlmICghc2Nyb2xsYWJsZS54ICYmICFzY3JvbGxhYmxlLnkpXG4gICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgIGNvbnN0IGhhc1ZlcnRpY2FsU2Nyb2xsICAgPSBzY3JvbGxhYmxlLnkgJiYgZWwuc2Nyb2xsSGVpZ2h0ID4gZWwuY2xpZW50SGVpZ2h0O1xuICAgIGNvbnN0IGhhc0hvcml6b250YWxTY3JvbGwgPSBzY3JvbGxhYmxlLnggJiYgZWwuc2Nyb2xsV2lkdGggPiBlbC5jbGllbnRXaWR0aDtcblxuICAgIHJldHVybiBoYXNIb3Jpem9udGFsU2Nyb2xsIHx8IGhhc1ZlcnRpY2FsU2Nyb2xsO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0U2Nyb2xsYWJsZVBhcmVudHMgKGVsZW1lbnQ6IEVsZW1lbnQpOiBFbGVtZW50W10ge1xuICAgIGNvbnN0IHBhcmVudHNBcnJheSA9IGFkYXB0ZXIuZG9tLmdldFBhcmVudHMoZWxlbWVudCk7XG5cbiAgICBpZiAoYWRhcHRlci5kb20uaXNFbGVtZW50SW5JZnJhbWUoZWxlbWVudCkpIHtcbiAgICAgICAgY29uc3QgaWZyYW1lID0gYWRhcHRlci5kb20uZ2V0SWZyYW1lQnlFbGVtZW50KGVsZW1lbnQpO1xuXG4gICAgICAgIGlmIChpZnJhbWUpIHtcbiAgICAgICAgICAgIGNvbnN0IGlGcmFtZVBhcmVudHMgPSBhZGFwdGVyLmRvbS5nZXRQYXJlbnRzKGlmcmFtZSk7XG5cbiAgICAgICAgICAgIHBhcmVudHNBcnJheS5jb25jYXQoaUZyYW1lUGFyZW50cyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gYWRhcHRlci5uYXRpdmVNZXRob2RzLmFycmF5RmlsdGVyLmNhbGwocGFyZW50c0FycmF5LCBoYXNTY3JvbGwpO1xufVxuIl19