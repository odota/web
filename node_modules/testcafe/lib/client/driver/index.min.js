window["%hammerhead%"].utils.removeInjectedScript(),function Bl(Gl){var Vl=Gl.document;!function(u,y,E,n,t){var s="default"in u?u.default:u,e="default"in y?y.default:y,r="default"in E?E.default:E;n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;var o={},i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function a(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function l(e,s,a,l){return new(a=a||n)(function(n,t){function r(e){try{o(l.next(e))}catch(e){t(e)}}function i(e){try{o(l.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,i)}o((l=l.apply(e,s||[])).next())})}function C(n,r){var i,o,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&t[0]?o.return:t[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,t[1])).done)return s;switch(o=0,s&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,o=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){a.label=t[1];break}if(6===t[0]&&a.label<s[1]){a.label=s[1],s=t;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(t);break}s[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(n,a)}catch(e){t=[6,e],o=0}finally{i=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}var c,d=(a(h,c=function(){}),h.prototype.mousedown=function(){throw new Error("not implemented")},h.prototype.mouseup=function(){throw new Error("not implemented")},h);function h(){return c.call(this)||this}var f=s.nativeMethods,p=s.Promise,m=s.utils,g=m.browser,w=m.featureDetection,v=m.extend,_=r.domUtils,I=r.positionUtils,S=r.styleUtils,W=r.eventUtils,b=e.getOffsetOptions;!function(e){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];o[r]=e[r]}}({PromiseCtor:p,nativeMethods:f,getOffsetOptions:b,dom:_,position:I,style:S,event:W,browser:g,featureDetection:w,utils:{extend:v},getElementExceptUI:function(){return p.resolve()},scroll:function(){return p.resolve()},createEventSequence:function(){},sendRequestToFrame:function(){return p.resolve()},ensureMouseEventAfterScroll:function(){return p.resolve()},automations:{click:{createMouseClickStrategy:function(){return new d}},_ensureWindowAndCursorForLegacyTests:function(){}}});var T,A,N=Math.floor(399);(A=T=T||{}).ready="ready",A.readyForBrowserManipulation="ready-for-browser-manipulation",A.waitForFileDownload="wait-for-file-download";var x=T,R={dispatchEvent:"dispatch-event",click:"click",rightClick:"right-click",doubleClick:"double-click",drag:"drag",dragToElement:"drag-to-element",hover:"hover",scroll:"scroll",scrollBy:"scroll-by",scrollIntoView:"scroll-into-view",typeText:"type-text",selectText:"select-text",selectTextAreaContent:"select-text-area-content",selectEditableContent:"select-editable-content",pressKey:"press-key",wait:"wait",navigateTo:"navigate-to",setFilesToUpload:"set-files-to-upload",clearUpload:"clear-upload",executeClientFunction:"execute-client-function",executeSelector:"execute-selector",takeScreenshot:"take-screenshot",takeElementScreenshot:"take-element-screenshot",takeScreenshotOnFail:"take-screenshot-on-fail",prepareBrowserManipulation:"prepare-browser-manipulation",showAssertionRetriesStatus:"show-assertion-retries-status",hideAssertionRetriesStatus:"hide-assertion-retries-status",setBreakpoint:"set-breakpoint",resizeWindow:"resize-window",resizeWindowToFitDevice:"resize-window-to-fit-device",maximizeWindow:"maximize-window",switchToIframe:"switch-to-iframe",switchToMainWindow:"switch-to-main-window",openWindow:"open-window",closeWindow:"close-window",getCurrentWindow:"get-current-window",getCurrentWindows:"get-current-windows",switchToWindow:"switch-to-window",switchToWindowByPredicate:"switch-to-window-by-predicate",switchToParentWindow:"switch-to-parent-window",switchToPreviousWindow:"switch-to-previous-window",setNativeDialogHandler:"set-native-dialog-handler",getNativeDialogHistory:"get-native-dialog-history",getBrowserConsoleMessages:"get-browser-console-messages",getActiveElement:"get-active-element",setTestSpeed:"set-test-speed",setPageLoadTimeout:"set-page-load-timeout",debug:"debug",disableDebug:"disable-debug",assertion:"assertion",useRole:"useRole",testDone:"test-done",backupStorages:"backup-storages",executeExpression:"execute-expression",executeAsyncExpression:"execute-async-expression",unlockPage:"unlock-page",closeChildWindowOnFileDownloading:"close-child-window-on-file-downloading",recorder:"recorder",prepareClientEnvironmentInDebugMode:"prepare-client-environment-in-debug-mode",getCookies:"get-cookies",setCookies:"set-cookies",deleteCookies:"delete-cookies"},D="E1",M="E4",P="E5",F="E9",k="E10",L="E11",O="E12",U="E24",H="E26",B="E27",G="E28",V="E29",q="E30",z="E31",j="E32",X="E33",Y="E34",K="E35",J="E36",$="E37",Q="E39",Z="E40",ee="E41",te="E42",ne="E43",re="E44",ie="E45",oe="E46",se="E49",ae="E50",le="E51",ce="E52",ue="E57",de="E64",he="E65",fe="E68",pe="E69",me="E70",ge="E71",we="E72",ve="E73",_e="E74",ye="E76",Ee="E77",Ce="E78",Ie="E82",Se="E83",We="E90",be="E91",Te="E92";function Ae(e){return!(function(e){return e.type===R.executeClientFunction||e.type===R.executeSelector}(r=e)||r.type===R.wait||r.type===R.assertion||r.type===R.executeExpression||xe(e)||(n=e).type===R.testDone||n.type===R.showAssertionRetriesStatus||n.type===R.hideAssertionRetriesStatus||n.type===R.setBreakpoint||n.type===R.takeScreenshotOnFail||n.type===R.recorder)||Ne(e)&&!((t=e).type===R.switchToIframe||t.type===R.switchToMainWindow);var t,n,r}function Ne(e){return e.type===R.resizeWindow||e.type===R.resizeWindowToFitDevice||e.type===R.maximizeWindow}function xe(e){return(t=e).type===R.takeScreenshot||t.type===R.takeElementScreenshot||t.type===R.takeScreenshotOnFail||Ne(e);var t}function Re(e,t){this.code=e,this.isTestCafeError=!0,this.callsite=t||null}var De,Me="step",Pe=(a(Fe,De=Re),Fe);function Fe(e,t,n){var r=De.call(this,e)||this;return r.optionName=t,r.actualValue=n,r}var ke,Le=(a(Oe,ke=Re),Oe);function Oe(e,t){var n=ke.call(this,se,t)||this;return n.instantiationCallsiteName=e,n}var Ue,He=(a(Be,Ue=Re),Be);function Be(e,t){var n=Ue.call(this,ae,t)||this;return n.instantiationCallsiteName=e,n}var Ge,Ve=(a(qe,Ge=Re),qe);function qe(e,t,n){var r=t.apiFnChain,i=t.apiFnIndex,o=Ge.call(this,e,n)||this;return o.apiFnChain=r,o.apiFnIndex=i,o}var ze,je=(a(Xe,ze=Re),Xe);function Xe(e){return ze.call(this,le,e)||this}var Ye,Ke=(a(Je,Ye=Ve),Je);function Je(e,t){return Ye.call(this,ce,t,e)||this}var $e,Qe=(a(Ze,$e=Re),Ze);function Ze(e,t){var n=$e.call(this,D)||this;return n.errStack=e,n.pageDestUrl=t,n}var et,tt=(a(nt,et=Re),nt);function nt(e,t,n){var r=et.call(this,M,n)||this;return r.errMsg=String(t),r.instantiationCallsiteName=e,r}var rt,it=(a(ot,rt=Re),ot);function ot(e,t,n,r){var i=rt.call(this,P,r)||this;return i.errMsg=String(t),i.property=n,i.instantiationCallsiteName=e,i}var st,at=(a(lt,st=Re),lt);function lt(e){var t=st.call(this,de)||this;return t.errMsg=String(e),t}var ct,ut=(a(dt,ct=Re),dt);function dt(e,t){var n=ct.call(this,he)||this;return n.errMsg=String(e),n.moduleName=t,n}var ht,ft=(a(pt,ht=Pe),pt);function pt(e,t){return ht.call(this,F,e,t)||this}var mt,gt=(a(wt,mt=Pe),wt);function wt(e,t){return mt.call(this,k,e,t)||this}var vt,_t=(a(yt,vt=Pe),yt);function yt(e,t){return vt.call(this,L,e,t)||this}var Et,Ct=(a(It,Et=Pe),It);function It(e,t){return Et.call(this,O,e,t)||this}var St,Wt=(a(bt,St=Pe),bt);function bt(e,t){return St.call(this,We,e,t)||this}var Tt,At=(a(Nt,Tt=Pe),Nt);function Nt(e,t){return Tt.call(this,be,e,t)||this}var xt,Rt=(a(Dt,xt=Pe),Dt);function Dt(e,t){return xt.call(this,Te,e,t)||this}var Mt,Pt=(a(Ft,Mt=Ve),Ft);function Ft(e,t){return Mt.call(this,U,t,e)||this}var kt,Lt=(a(Ot,kt=Re),Ot);function Ot(e){return kt.call(this,H,e)||this}var Ut,Ht=(a(Bt,Ut=Re),Bt);function Bt(e){var t=Ut.call(this,B)||this;return t.nodeDescription=e,t}var Gt,Vt=(a(qt,Gt=Ve),qt);function qt(e,t){var n=Gt.call(this,G,t)||this;return n.argumentName=e,n}var zt,jt=(a(Xt,zt=Re),Xt);function Xt(e){var t=zt.call(this,V)||this;return t.argumentName=e,t}var Yt,Kt=(a(Jt,Yt=Re),Jt);function Jt(e,t){var n=Yt.call(this,q)||this;return n.argumentName=e,n.nodeDescription=t,n}var $t,Qt=(a(Zt,$t=Re),Zt);function Zt(){return $t.call(this,z)||this}var en,tn=(a(nn,en=Re),nn);function nn(){return en.call(this,j)||this}var rn,on=(a(sn,rn=Re),sn);function sn(e){var t=rn.call(this,X)||this;return t.argumentName=e,t}var an,ln=(a(cn,an=Re),cn);function cn(){return an.call(this,K)||this}var un,dn=(a(hn,un=Re),hn);function hn(e){var t=un.call(this,J)||this;return t.argumentName=e,t}var fn,pn=(a(mn,fn=Re),mn);function mn(e,t){var n=fn.call(this,$)||this;return n.filePaths=e,n.scannedFilePaths=t,n}var gn,wn=(a(vn,gn=Re),vn);function vn(){return gn.call(this,Y)||this}var _n,yn=(a(En,_n=Re),En);function En(e,t){var n=_n.call(this,ee)||this;return n.properties=e?"scrollTargetY property":t?"scrollTargetX property":"scrollTargetX and scrollTargetY properties",n}var Cn,In=(a(Sn,Cn=Re),Sn);function Sn(e,t){var n=Cn.call(this,ue)||this;return e<=0?t<=0?(n.verb="are",n.dimensions="width and height"):(n.verb="is",n.dimensions="width"):(n.verb="is",n.dimensions="height"),n}var Wn,bn=(a(Tn,Wn=Re),Tn);function Tn(e){return Wn.call(this,Z,e)||this}var An,Nn=(a(xn,An=Re),xn);function xn(){return An.call(this,Q)||this}var Rn,Dn=(a(Mn,Rn=Re),Mn);function Mn(){return Rn.call(this,te)||this}var Pn,Fn=(a(kn,Pn=Re),kn);function kn(){return Pn.call(this,pe)||this}var Ln,On=(a(Un,Ln=Re),Un);function Un(){return Ln.call(this,fe)||this}var Hn,Bn=(a(Gn,Hn=Re),Gn);function Gn(){return Hn.call(this,me)||this}var Vn,qn=(a(zn,Vn=Re),zn);function zn(){return Vn.call(this,ge)||this}var jn,Xn=(a(Yn,jn=Re),Yn);function Yn(){return jn.call(this,ve)||this}var Kn,Jn=(a($n,Kn=Re),$n);function $n(){return Kn.call(this,Ie)||this}var Qn,Zn=(a(er,Qn=Re),er);function er(e){var t=Qn.call(this,Ce)||this;return t.errMsg=e,t}var tr,nr=(a(rr,tr=Re),rr);function rr(){return tr.call(this,_e)||this}var ir,or=(a(sr,ir=Re),sr);function sr(){return ir.call(this,ye)||this}var ar,lr=(a(cr,ar=Re),cr);function cr(){return ar.call(this,Ee)||this}var ur,dr=(a(hr,ur=Re),hr);function hr(){return ur.call(this,we)||this}var fr,pr=(a(mr,fr=Re),mr);function mr(){return fr.call(this,Se)||this}var gr,wr=(a(vr,gr=Re),vr);function vr(){return gr.call(this,ne)||this}var _r,yr=(a(Er,_r=Re),Er);function Er(){return _r.call(this,re)||this}var Cr,Ir=(a(Sr,Cr=Re),Sr);function Sr(e,t){var n=Cr.call(this,ie)||this;return n.dialogType=e,n.pageUrl=t,n}var Wr,br=(a(Tr,Wr=Re),Tr);function Tr(e,t,n){var r=Wr.call(this,oe)||this;return r.dialogType=e,r.errMsg=t,r.pageUrl=n,r}var Ar=Object.freeze({__proto__:null,TestRunErrorBase:Re,ClientFunctionExecutionInterruptionError:Le,DomNodeClientFunctionResultError:He,SelectorErrorBase:Ve,InvalidSelectorResultError:je,CannotObtainInfoForElementSpecifiedBySelectorError:Ke,UncaughtErrorOnPage:Qe,UncaughtErrorInClientFunctionCode:tt,UncaughtErrorInCustomDOMPropertyCode:it,UncaughtErrorInCustomClientScriptCode:at,UncaughtErrorInCustomClientScriptLoadedFromModule:ut,ActionIntegerOptionError:ft,ActionPositiveIntegerOptionError:gt,ActionBooleanOptionError:_t,ActionSpeedOptionError:Ct,ActionStringOptionError:Wt,ActionDateOptionError:At,ActionNumberOptionError:Rt,ActionElementNotFoundError:Pt,ActionElementIsInvisibleError:Lt,ActionSelectorMatchesWrongNodeTypeError:Ht,ActionAdditionalElementNotFoundError:Vt,ActionAdditionalElementIsInvisibleError:jt,ActionAdditionalSelectorMatchesWrongNodeTypeError:Kt,ActionElementNonEditableError:Qt,ActionElementNotTextAreaError:tn,ActionElementNonContentEditableError:on,ActionRootContainerNotFoundError:ln,ActionIncorrectKeysError:dn,ActionCannotFindFileToUploadError:pn,ActionElementIsNotFileInputError:wn,ActionInvalidScrollTargetError:yn,InvalidElementScreenshotDimensionsError:In,ActionElementNotIframeError:bn,ActionIframeIsNotLoadedError:Nn,CurrentIframeIsNotLoadedError:Dn,ChildWindowNotFoundError:Fn,ChildWindowIsNotLoadedError:On,CannotSwitchToWindowError:Bn,CloseChildWindowError:qn,CannotCloseWindowWithChildrenError:Xn,CannotCloseWindowWithoutParentError:Jn,SwitchToWindowPredicateError:Zn,WindowNotFoundError:nr,ParentWindowNotFoundError:or,PreviousWindowNotFoundError:lr,ChildWindowClosedBeforeSwitchingError:dr,CannotRestoreChildWindowError:pr,CurrentIframeNotFoundError:wr,CurrentIframeIsInvisibleError:yr,NativeDialogNotHandledError:Ir,UncaughtErrorInNativeDialogHandler:br}),Nr="_nativeMethods",xr=(Rr.prototype._ensureNativeMethods=function(e){return e||{objectKeys:Object.keys,arrayForEach:Array.prototype.forEach,arrayConcat:Array.prototype.concat,arraySlice:Array.prototype.slice,objectDefineProperty:Object.defineProperty}},Rr.prototype._getWindowIds=function(e){return this[Nr].objectKeys(e)},Rr.prototype._copyArray=function(e){return this[Nr].arraySlice.call(e)},Rr.prototype._concatArrays=function(e,t){return this[Nr].arrayConcat.call(e,t)},Rr.prototype.ensureMessageContainer=function(e){this[e]||(this[e]={log:[],info:[],warn:[],error:[]})},Rr.prototype.concat=function(t){var n=this;if(!t)return this;var e=this._getWindowIds(t);return this[Nr].arrayForEach.call(e,function(e){n.ensureMessageContainer(e),n[e].log=n._concatArrays(n[e].log,t[e].log),n[e].info=n._concatArrays(n[e].info,t[e].info),n[e].warn=n._concatArrays(n[e].warn,t[e].warn),n[e].error=n._concatArrays(n[e].error,t[e].error)}),this},Rr.prototype.addMessage=function(e,t,n){this.ensureMessageContainer(n),this[n][e].push(t)},Rr.prototype.getCopy=function(){var t=this,n={},e=this._getWindowIds(this);return this[Nr].arrayForEach.call(e,function(e){n[e]={log:t._copyArray(t[e].log),info:t._copyArray(t[e].info),warn:t._copyArray(t[e].warn),error:t._copyArray(t[e].error)}}),n},Rr);function Rr(e,t){var n=this._ensureNativeMethods(t);n.objectDefineProperty(this,Nr,{value:n}),this.concat(e)}var Dr,Mr=(a(Pr,Dr=xr),Pr);function Pr(e){return Dr.call(this,e,u.nativeMethods)||this}var Fr,kr=(function(e){function n(e){return!!s[e]}function r(e,t){this.references=e,this.transforms=t,this.circularCandidates=[],this.circularCandidatesDescrs=[],this.circularRefCount=0}var o=/^#*@(t|r)$/,i=(0,eval)("this"),s={Int8Array:"function"==typeof Int8Array?Int8Array:void 0,Uint8Array:"function"==typeof Uint8Array?Uint8Array:void 0,Uint8ClampedArray:"function"==typeof Uint8ClampedArray?Uint8ClampedArray:void 0,Int16Array:"function"==typeof Int16Array?Int16Array:void 0,Uint16Array:"function"==typeof Uint16Array?Uint16Array:void 0,Int32Array:"function"==typeof Int32Array?Int32Array:void 0,Uint32Array:"function"==typeof Uint32Array?Uint32Array:void 0,Float32Array:"function"==typeof Float32Array?Float32Array:void 0,Float64Array:"function"==typeof Float64Array?Float64Array:void 0},a="function"==typeof ArrayBuffer,l="function"==typeof Map,c="function"==typeof Set,u="function"==typeof Buffer,d=Array.prototype.slice,t={serialize:function(e){return JSON.stringify(e)},deserialize:function(e){return JSON.parse(e)}};function h(e,t){this.references=e,this.transformMap=t,this.activeTransformsStack=[],this.visitedRefs=Object.create(null)}r._createRefMark=function(e){var t=Object.create(null);return t["@r"]=e,t},r.prototype._createCircularCandidate=function(e,t,n){this.circularCandidates.push(e),this.circularCandidatesDescrs.push({parent:t,key:n,refIdx:-1})},r.prototype._applyTransform=function(e,t,n,r){var i=Object.create(null),o=r.toSerializable(e);return"object"==typeof o&&this._createCircularCandidate(e,t,n),i["@t"]=r.type,i.data=this._handleValue(o,t,n),i},r.prototype._handleArray=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=this._handleValue(e[n],t,n);return t},r.prototype._handlePlainObject=function(n){var r=this,i=Object.create(null);return Object.getOwnPropertyNames(n).forEach(function(e){var t=o.test(e)?"#"+e:e;i[t]=r._handleValue(n[e],i,t)}),i},r.prototype._handleObject=function(e,t,n){return this._createCircularCandidate(e,t,n),Array.isArray(e)?this._handleArray(e):this._handlePlainObject(e)},r.prototype._ensureCircularReference=function(e){var t=this.circularCandidates.indexOf(e);if(-1<t){var n=this.circularCandidatesDescrs[t];return-1===n.refIdx&&(n.refIdx=n.parent?++this.circularRefCount:0),r._createRefMark(n.refIdx)}return null},r.prototype._handleValue=function(e,t,n){var r=typeof e,i="object"==r&&null!==e;if(i){var o=this._ensureCircularReference(e);if(o)return o}for(var s=0;s<this.transforms.length;s++){var a=this.transforms[s];if(a.shouldTransform(r,e))return this._applyTransform(e,t,n,a)}return i?this._handleObject(e,t,n):e},r.prototype.transform=function(){for(var e=[this._handleValue(this.references,null,null)],t=0;t<this.circularCandidatesDescrs.length;t++){var n=this.circularCandidatesDescrs[t];0<n.refIdx&&(e[n.refIdx]=n.parent[n.key],n.parent[n.key]=r._createRefMark(n.refIdx))}return e},h.prototype._handlePlainObject=function(t){var e,n=this,r=Object.create(null),i=Object.getOwnPropertyNames(t);for(e in i.forEach(function(e){n._handleValue(t[e],t,e),o.test(e)&&(r[e.substring(1)]=t[e],delete t[e])}),r)t[e]=r[e]},h.prototype._handleTransformedObject=function(e,t,n){var r=e["@t"],i=this.transformMap[r];if(!i)throw new Error("Can't find transform for \""+r+'" type.');this.activeTransformsStack.push(e),this._handleValue(e.data,e,"data"),this.activeTransformsStack.pop(),t[n]=i.fromSerializable(e.data)},h.prototype._handleCircularSelfRefDuringTransform=function(e,t,n){var r=this.references,i=void 0;Object.defineProperty(t,n,{configurable:!0,enumerable:!0,get:function(){return void 0===i&&(i=r[e]),i},set:function(e){return i=e}})},h.prototype._handleCircularRef=function(e,t,n){-1<this.activeTransformsStack.indexOf(this.references[e])?this._handleCircularSelfRefDuringTransform(e,t,n):(this.visitedRefs[e]||(this.visitedRefs[e]=!0,this._handleValue(this.references[e],this.references,e)),t[n]=this.references[e])},h.prototype._handleValue=function(e,t,n){if("object"==typeof e&&null!==e){var r=e["@r"];if(void 0!==r)this._handleCircularRef(r,t,n);else if(e["@t"])this._handleTransformedObject(e,t,n);else if(Array.isArray(e))for(var i=0;i<e.length;i++)this._handleValue(e[i],e,i);else this._handlePlainObject(e)}},h.prototype.transform=function(){return this.visitedRefs[0]=!0,this._handleValue(this.references[0],this.references,0),this.references[0]};var f=[{type:"[[NaN]]",shouldTransform:function(e,t){return"number"===e&&isNaN(t)},toSerializable:function(){return""},fromSerializable:function(){return NaN}},{type:"[[undefined]]",shouldTransform:function(e){return"undefined"===e},toSerializable:function(){return""},fromSerializable:function(){}},{type:"[[Date]]",shouldTransform:function(e,t){return t instanceof Date},toSerializable:function(e){return e.getTime()},fromSerializable:function(e){var t=new Date;return t.setTime(e),t}},{type:"[[RegExp]]",shouldTransform:function(e,t){return t instanceof RegExp},toSerializable:function(e){var t={src:e.source,flags:""};return e.global&&(t.flags+="g"),e.ignoreCase&&(t.flags+="i"),e.multiline&&(t.flags+="m"),t},fromSerializable:function(e){return new RegExp(e.src,e.flags)}},{type:"[[Error]]",shouldTransform:function(e,t){return t instanceof Error},toSerializable:function(e){return{name:e.name,message:e.message,stack:e.stack}},fromSerializable:function(e){var t=new(i[e.name]||Error)(e.message);return t.stack=e.stack,t}},{type:"[[ArrayBuffer]]",shouldTransform:function(e,t){return a&&t instanceof ArrayBuffer},toSerializable:function(e){var t=new Int8Array(e);return d.call(t)},fromSerializable:function(e){if(a){var t=new ArrayBuffer(e.length);return new Int8Array(t).set(e),t}return e}},{type:"[[Buffer]]",shouldTransform:function(e,t){return u&&t instanceof Buffer},toSerializable:function(e){return d.call(e)},fromSerializable:function(e){return u?Buffer.from(e):e}},{type:"[[TypedArray]]",shouldTransform:function(e,t){return Object.keys(s).some(function(e){return n(e)&&t instanceof s[e]})},toSerializable:function(e){return{ctorName:e.constructor.name,arr:d.call(e)}},fromSerializable:function(e){return n(e.ctorName)?new s[e.ctorName](e.arr):e.arr}},{type:"[[Map]]",shouldTransform:function(e,t){return l&&t instanceof Map},toSerializable:function(e){var n=[];return e.forEach(function(e,t){n.push(t),n.push(e)}),n},fromSerializable:function(e){if(l){for(var t=new Map,n=0;n<e.length;n+=2)t.set(e[n],e[n+1]);return t}for(var r=[],i=0;i<e.length;i+=2)r.push([e[n],e[n+1]]);return r}},{type:"[[Set]]",shouldTransform:function(e,t){return c&&t instanceof Set},toSerializable:function(e){var t=[];return e.forEach(function(e){t.push(e)}),t},fromSerializable:function(e){if(c){for(var t=new Set,n=0;n<e.length;n++)t.add(e[n]);return t}return e}}],p=e.exports=function(e){this.transforms=[],this.transformsMap=Object.create(null),this.serializer=e||t,this.addTransforms(f)};p.prototype.addTransforms=function(e){e=Array.isArray(e)?e:[e];for(var t=0;t<e.length;t++){var n=e[t];if(this.transformsMap[n.type])throw new Error('Transform with type "'+n.type+'" was already added.');this.transforms.push(n),this.transformsMap[n.type]=n}return this},p.prototype.removeTransforms=function(e){e=Array.isArray(e)?e:[e];for(var t=0;t<e.length;t++){var n=e[t],r=this.transforms.indexOf(n);-1<r&&this.transforms.splice(r,1),delete this.transformsMap[n.type]}return this},p.prototype.encode=function(e){var t=new r(e,this.transforms).transform();return this.serializer.serialize(t)},p.prototype.decode=function(e){var t=this.serializer.deserialize(e);return new h(t,this.transformsMap).transform()}}(Fr={exports:{}}),Fr.exports),Lr=function(e){return e};function Or(e){return new kr({serialize:Lr,deserialize:Lr}).addTransforms(e)}var Ur,Hr={};function Br(e){return!(!Hr.isDomElement(e)&&!Hr.isTextNode(e))&&(Hr.isOptionElement(e)||"optgroup"===Hr.getTagName(e)?Hr.isOptionElementVisible(e):Hr.isElementVisible(e))}var Gr=1,Vr=2,qr=3,zr=((Ur={})[Gr]=/^\.filterVisible\(\)$/,Ur[Vr]=/^\.filterHidden\(\)$/,Ur[qr]=/^\.nth\(\d+\)$/,Ur);function jr(){this._err=null}var Xr=(Object.defineProperty(jr.prototype,"error",{get:function(){return this._err},set:function(e){null===this._err&&(this._err=e)},enumerable:!1,configurable:!0}),jr.prototype.filter=function(e,t,n){if(t.filterVisible&&(e=e.filter(Br),this._assertFilterError(e,n,Gr)),t.filterHidden&&(e=e.filter(function(e){return!Br(e)}),this._assertFilterError(e,n,Vr)),t.counterMode)return null===t.index?e.length:jr._getNodeByIndex(e,t.index)?1:0;var r;if(t.collectionMode)return null!==t.index&&(e=(r=jr._getNodeByIndex(e,t.index))?[r]:[],this._assertFilterError(e,n,qr)),e;var i=jr._getNodeByIndex(e,t.index||0);return i||(this.error=jr._getErrorItem(n,qr)),i},jr.prototype.cast=function(e){if(null==e)return[];if(e instanceof Hr.nativeMethods.Node)return[e];if(function(e){if(Hr.nativeMethods.isArray(e)){for(var t=0;t<e.length;t++)if(!(e[t]instanceof Hr.nativeMethods.Node))return;return 1}}(e))return e;if((t=e)instanceof Hr.nativeMethods.HTMLCollection||t instanceof Hr.nativeMethods.NodeList)return function(e){for(var t=e.length,n=[],r=0;r<t;r++)n.push(e[r]);return n}(e);var t;throw new je},jr.prototype._assertFilterError=function(e,t,n){0===e.length&&(this.error=jr._getErrorItem(t,n))},jr._getErrorItem=function(e,t){var n=e.apiFnChain,r=e.apiFnID;if(t)for(var i=r;i<n.length;i++)if(zr[t].test(n[i]))return i;return null},jr._getNodeByIndex=function(e,t){return t<0?e[e.length+t]:e[t]},new jr);function Yr(e,t){var n=Hr.nativeMethods.Function;return Hr.isProxyless?new n("fnCode","__dependencies$",'"use strict"; return eval(fnCode)')(e,t):new n("fnCode","__dependencies$","Promise","RegExp",'"use strict"; return eval(fnCode)')(e,t,Hr.PromiseCtor,RegExp)}var Kr=(Jr.prototype.shouldTransform=function(e){return"function"===e},Jr.prototype.toSerializable=function(){return""},Jr.prototype.fromSerializable=function(e){var t=e.fnCode,n=e.dependencies;return"filterOptions"in n&&(n.selectorFilter=Xr),Yr(t,n)},Jr);function Jr(){this.type="Function"}var $r=(Qr.prototype.shouldTransform=function(e,t){if(t instanceof Hr.nativeMethods.Node)throw new He(this._instantiationCallsiteName);return!1},Qr.prototype.toSerializable=function(){},Qr.prototype.fromSerializable=function(){},Qr);function Qr(e){this.type="Node",this._instantiationCallsiteName=e}var Zr=(ei.prototype.getResult=function(){var t=this;return Hr.PromiseCtor.resolve().then(function(){var e=t.replicator.decode(t.command.args);return t._executeFn(e)}).catch(function(e){throw e.isTestCafeError||Hr.isProxyless||(e=new tt(t.command.instantiationCallsiteName,e)),e})},ei.prototype.encodeResult=function(e){return this.replicator.encode(e)},ei.prototype._createReplicator=function(){return Or([new $r(this.command.instantiationCallsiteName),new Kr])},ei.prototype._executeFn=function(e){return this.fn.apply(Gl,e)},ei);function ei(e){this.command=e,this.replicator=this._createReplicator(),this.dependencies=this.replicator.decode(e.dependencies),this.fn=Yr(e.fnCode,this.dependencies)}var ti="appeared-dialog",ni="unexpected-dialog",ri="handler-error",ii=s.eventSandbox.message,oi=s.processScript,si=s.nativeMethods,ai="testcafe|native-dialog-tracker|appeared-dialogs",li="testcafe|native-dialog-tracker|unexpected-dialog",ci="testcafe|native-dialog-tracker|error-in-handler",ui=oi("window.location.href"),di=(Object.defineProperty(hi.prototype,"appearedDialogs",{get:function(){var e=this.contextStorage.getItem(ai);return e||(e=[],this.appearedDialogs=e),e},set:function(e){this.contextStorage.setItem(ai,e)},enumerable:!1,configurable:!0}),Object.defineProperty(hi.prototype,"unexpectedDialog",{get:function(){return this.contextStorage.getItem(li)},set:function(e){this.contextStorage.setItem(li,e)},enumerable:!1,configurable:!0}),Object.defineProperty(hi.prototype,"handlerError",{get:function(){return this.contextStorage.getItem(ci)},set:function(e){this.contextStorage.setItem(ci,e)},enumerable:!1,configurable:!0}),hi._getPageUrl=function(){return si.eval(ui)},hi.prototype._initListening=function(){var n=this;ii.on(ii.SERVICE_MSG_RECEIVED_EVENT,function(e){var t=e.message;t.type===ti?n._addAppearedDialogs(t.dialogType,t.text,t.url):t.type!==ni||n.unexpectedDialog?t.type!==ri||n.handlerError||n._onHandlerError(t.dialogType,t.message,t.url):n.unexpectedDialog={type:t.dialogType,url:t.url}})},hi.prototype._init=function(){var t=this;s.on(s.EVENTS.beforeUnload,function(e){e.prevented&&!e.isFakeIEEvent&&(t.dialogHandler?t._createDialogHandler("beforeunload")(e.returnValue||""):t._defaultDialogHandler("beforeunload")),t.contextStorage&&t.contextStorage.save()}),Gl.alert=function(){return t._defaultDialogHandler("alert")},Gl.confirm=function(){return t._defaultDialogHandler("confirm")},Gl.prompt=function(){return t._defaultDialogHandler("prompt")}},hi.prototype._createDialogHandler=function(i){var o=this;return function(e){var t=hi._getPageUrl();o._addAppearedDialogs(i,e,t);var n=new Zr(o.dialogHandler),r=null;try{r=n.fn.apply(Gl,[i,e,t])}catch(e){o._onHandlerError(i,e.message||String(e),t)}return r}},hi.prototype._defaultDialogHandler=function(e){var t=hi._getPageUrl();this.unexpectedDialog=this.unexpectedDialog||{type:e,url:t}},hi.prototype._addAppearedDialogs=function(e,t,n){this.appearedDialogs.splice(0,0,{type:e,text:t,url:n})},hi.prototype._onHandlerError=function(e,t,n){this.handlerError=this.handlerError||{type:e,message:t,url:n}},hi.prototype.setHandler=function(e){var t=this;this.dialogHandler=e,["alert","confirm","prompt"].forEach(function(e){Gl[e]=t.dialogHandler?t._createDialogHandler(e):function(){return t._defaultDialogHandler(e)}})},hi.prototype.getUnexpectedDialogError=function(){var e=this.unexpectedDialog,t=this.handlerError;return this.unexpectedDialog=null,this.handlerError=null,e?new Ir(e.type,e.url):t?new br(t.type,t.message,t.url):null},hi);function hi(e,t){this.contextStorage=e,this.dialogHandler=t,this._init(),this._initListening(),this.dialogHandler&&this.setHandler(t)}function fi(){return u.nativeMethods.performanceNow().toString()}function pi(e){this.type=e,this.id=fi()}var mi,gi="driver|establish-connection",wi="driver|switch-to-window",vi="driver|close-window",_i="driver|close-window-validation",yi="driver|switch-to-window-validation",Ei="driver|get-windows",Ci="driver|command-executed",Ii="driver|execute-command",Si="driver|confirmation",Wi="driver|set-native-dialog-handler",bi="driver|set-as-master",Ti="driver|close-all-child-windows",Ai="driver|start-to-restore-child-link",Ni="driver|restore-child-link",xi="driver|child-window-is-loaded-in-iframe",Ri="driver|child-window-is-opened-in-iframe",Di="driver|stop-internal-from-iframe",Mi="driver|has-pending-action-flags",Pi=(a(Fi,mi=pi),Fi);function Fi(){return mi.call(this,gi)||this}var ki,Li=(a(Oi,ki=pi),Oi);function Oi(e){var t=e.windowId,n=ki.call(this,_i)||this;return n.windowId=t,n}var Ui,Hi=(a(Bi,Ui=pi),Bi);function Bi(e){var t=e.windowId,n=e.fn,r=Ui.call(this,yi)||this;return r.windowId=t,r.fn=n,r}var Gi,Vi=(a(qi,Gi=pi),qi);function qi(){return Gi.call(this,Ei)||this}var zi,ji=(a(Xi,zi=pi),Xi);function Xi(e){var t=e.windowId,n=e.isCurrentWindow,r=zi.call(this,vi)||this;return r.windowId=t,r.isCurrentWindow=n,r}var Yi,Ki=(a(Ji,Yi=pi),Ji);function Ji(e){var t=e.windowId,n=e.fn,r=Yi.call(this,wi)||this;return r.windowId=t,r.fn=n,r}var $i,Qi=(a(Zi,$i=pi),Zi);function Zi(e){var t=$i.call(this,Ci)||this;return t.driverStatus=e,t}var eo,to=(a(no,eo=pi),no);function no(e,t){var n=eo.call(this,Ii)||this;return n.command=e,n.testSpeed=t,n}var ro,io=(a(oo,ro=pi),oo);function oo(e,t){var n=ro.call(this,Si)||this;return n.requestMessageId=e,n.result=t,n}var so,ao=(a(lo,so=pi),lo);function lo(e){var t=so.call(this,Wi)||this;return t.dialogHandler=e,t}var co,uo=(a(ho,co=pi),ho);function ho(e){var t=co.call(this,bi)||this;return t.finalizePendingCommand=e,t}var fo,po=(a(mo,fo=pi),mo);function mo(){return fo.call(this,Ti)||this}var go,wo=(a(vo,go=pi),vo);function vo(){return go.call(this,Ai)||this}var _o,yo=(a(Eo,_o=pi),Eo);function Eo(e){var t=_o.call(this,Ni)||this;return t.windowId=e,t}var Co,Io=(a(So,Co=pi),So);function So(e){var t=Co.call(this,xi)||this;return t.windowId=e,t}var Wo,bo=(a(To,Wo=pi),To);function To(){return Wo.call(this,Ri)||this}var Ao,No=(a(xo,Ao=pi),xo);function xo(){return Ao.call(this,Di)||this}var Ro,Do=(a(Mo,Ro=pi),Mo);function Mo(){return Ro.call(this,Mi)||this}var Po=s.json,Fo=s.nativeMethods,ko=(Lo.prototype._createStorageKey=function(e,t){var n="testcafe|driver|"+e;return t?n+"|"+t:n},Lo.prototype._loadFromStorage=function(){var e=Fo.storageGetItem.call(this.storage,this.storageKey);e&&(this.data=Po.parse(e),Fo.storageRemoveItem.call(this.storage,this.storageKey))},Lo.prototype.save=function(){Fo.storageSetItem.call(this.storage,this.storageKey,Po.stringify(this.data))},Lo.prototype.setItem=function(e,t){this.data[e]=t,this.save()},Lo.prototype.getItem=function(e){return this.data[e]},Lo.prototype.dispose=function(){Fo.storageRemoveItem.call(this.storage,this.storageKey)},Lo);function Lo(e,t,n){this.storage=Fo.winSessionStorageGetter.call(e),this.storageKey=this._createStorageKey(t,n),this.data={},this._loadFromStorage()}var Oo=(Uo.prototype._getAssignableProperties=function(){throw new Error("Not implemented")},Uo.prototype._assignFrom=function(e,t,n){if(void 0===n&&(n={}),e)for(var r=this._getAssignableProperties(),i=0;i<r.length;i++){for(var o,s=r[i],a=s.name,l=s.type,c=s.required,u=s.init,d=s.defaultValue,h=a.split("."),f=h.length-1,p=h[f],m=e,g=this,w=0;w<f&&m&&g;w++)m=m[h[w]],g=g[h[w]];g&&"defaultValue"in r[i]&&(g[a]=d),m&&g&&(void 0===(o=m[p])&&!c||(t&&l&&l(a,o),g[p]=u?u(a,o,n,t):o))}},Uo);function Uo(){}var Ho,Bo=(a(Go,Ho=Oo),Go.prototype._getAssignableProperties=function(){return[{name:"isCommandResult"},{name:"executionError"},{name:"pageError"},{name:"result"},{name:"consoleMessages"},{name:"isPendingWindowSwitching"},{name:"isObservingFileDownloadingInNewWindow"},{name:"isFirstRequestAfterWindowSwitching"}]},Go);function Go(e){var t=Ho.call(this,e)||this;return t.id=fi(),t.isCommandResult=!1,t.executionError=null,t.pageError=null,t.resent=!1,t.result=null,t.consoleMessages=null,t.isPendingWindowSwitching=!1,t.isObservingFileDownloadingInNewWindow=!1,t.isFirstRequestAfterWindowSwitching=!1,t.debug="",t._assignFrom(e,!0),t}function Vo(n,e,t,r){var i=null,o=null,s=null;return t=Math.max(t||0,2500),u.Promise.race([E.delay(t),new u.Promise(function(t){s=function(e){e.message.type===Si&&e.message.requestMessageId===n.id&&t(e.message)},u.eventSandbox.message.on(u.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,s),i=u.nativeMethods.setInterval.call(Gl,function(){return u.eventSandbox.message.sendServiceMsg(n,e)},1e3),u.eventSandbox.message.sendServiceMsg(n,e)})]).then(function(e){if(u.nativeMethods.clearInterval.call(Gl,i),u.nativeMethods.clearTimeout.call(Gl,o),u.eventSandbox.message.off(u.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,s),!e)throw new r;return e})}var qo=2e4;function zo(e){var t=e.requestMsgId,n=e.result,r=e.window,i=new io(t,n);u.eventSandbox.message.sendServiceMsg(i,r)}var jo=(Object.defineProperty(Xo.prototype,"availabilityTimeout",{set:function(e){this.iframeAvailabilityTimeout=e},enumerable:!1,configurable:!0}),Xo.prototype._ensureIframe=function(){var e=this;return E.domUtils.isElementInDocument(this.driverIframe)?E.waitFor(function(){return E.positionUtils.isElementVisible(e.driverIframe)?e.driverIframe:null},200,this.iframeAvailabilityTimeout).catch(function(){throw new yr}):u.Promise.reject(new wr)},Xo.prototype._waitForIframeRemovedOrHidden=function(){var t=this;return new u.Promise(function(e){t.checkIframeInterval=u.nativeMethods.setInterval.call(Gl,function(){t._ensureIframe().catch(function(){return E.delay(500).then(function(){return e(new Bo({isCommandResult:!0}))})})},1e3)})},Xo.prototype._waitForCommandResult=function(){var t=this,n=null;return u.Promise.race([this._waitForIframeRemovedOrHidden(),new u.Promise(function(t){n=function(e){e.message.type===Ci&&t(e.message.driverStatus)},u.eventSandbox.message.on(u.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,n)})]).then(function(e){return u.eventSandbox.message.off(u.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,n),u.nativeMethods.clearInterval.call(Gl,t.checkIframeInterval),e})},Xo.prototype.sendConfirmationMessage=function(e){zo({requestMsgId:e,result:{id:this.driverId},window:this.driverWindow})},Xo.prototype.executeCommand=function(t,n){var r=this;return this._ensureIframe().then(function(){var e=new to(t,n);return u.Promise.all([Vo(e,r.driverWindow,r.iframeAvailabilityTimeout,Dn),r._waitForCommandResult()])}).then(function(e){return e[1]})},Xo);function Xo(e,t){this.driverWindow=e,this.driverIframe=E.domUtils.findIframeByWindow(e),this.driverId=t,this.iframeAvailabilityTimeout=0}var Yo=["nodeType","textContent","childNodeCount","hasChildNodes","childElementCount","hasChildElements"],Ko=["tagName","attributes"],Jo=["tagName","visible","focused","attributes","boundingClientRect","classNames","style","innerText","namespaceURI","id","value","checked","selected","selectedIndex","scrollWidth","scrollHeight","scrollLeft","scrollTop","offsetWidth","offsetHeight","offsetLeft","offsetTop","clientWidth","clientHeight","clientLeft","clientTop"],$o={childNodeCount:function(e){return e.childNodes.length},hasChildNodes:function(e){return!!$o.childNodeCount(e)},childElementCount:function(e){var t=e.children;if(t)return t.length;for(var n=0,r=e.childNodes.length,i=0;i<r;i++)1===e.childNodes[i].nodeType&&n++;return n},hasChildElements:function(e){return!!$o.childElementCount(e)}},Qo=(Zo.prototype._initializeProperties=function(e,t,n){for(var r=0,i=t;r<i.length;r++){var o=i[r],s=n[o];this[o]=s?s(e):e[o]}},Zo);function Zo(){}var es,ts=(a(ns,es=Qo),ns);function ns(e){var t=es.call(this)||this;return t._initializeProperties(e,Yo,$o),t}var rs,is={tagName:function(e){return e.tagName.toLowerCase()},visible:function(e){return Hr.isElementVisible(e)},focused:function(e){return Hr.getActiveElement()===e},attributes:function(e){for(var t=e.attributes,n={},r=t.length-1;0<=r;r--)n[t[r].name]=t[r].value;return n},boundingClientRect:function(e){var t=e.getBoundingClientRect();return{left:t.left,right:t.right,top:t.top,bottom:t.bottom,width:t.width,height:t.height}},classNames:function(e){var t=e.className;return"string"==typeof t.animVal&&(t=t.animVal),t.replace(/^\s+|\s+$/g,"").split(/\s+/g)},style:function(e){for(var t={},n=Gl.getComputedStyle(e),r=0;r<n.length;r++){var i=n[r];t[i]=n[i]}return t},innerText:function(e){return e.innerText}},os=(a(ss,rs=Qo),ss);function ss(e){var t=rs.call(this)||this;return t._initializeProperties(e,Ko,is),t}var as,ls=(a(cs,as=ts),cs);function cs(e){var t=as.call(this,e)||this;return t._initializeProperties(e,Jo,is),t}var us=(ds.prototype._extend=function(e,t){for(var n=0,r=Hr.nativeMethods.objectKeys(this._customDOMProperties);n<r.length;n++){var i=r[n];try{e[i]=this._customDOMProperties[i](t)}catch(e){throw new it(this._instantiationCallsiteName,e,i)}}},ds.prototype.shouldTransform=function(e,t){return t instanceof Hr.nativeMethods.Node},ds.prototype.toSerializable=function(e){var t=new(1===e.nodeType?ls:ts)(e);return this._extend(t,e),t},ds.prototype.fromSerializable=function(){},ds);function ds(e,t){void 0===e&&(e={}),this.type="Node",this._customDOMProperties=e,this._instantiationCallsiteName=t}var hs=(fs.prototype.on=function(e,t){this._eventsListeners[e]||(this._eventsListeners[e]=[]),this._eventsListeners[e].push(t)},fs.prototype.once=function(n,r){var i=this;this.on(n,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i.off(n,r),r.apply(void 0,e)})},fs.prototype.off=function(e,t){var n=this._eventsListeners[e];n&&(this._eventsListeners[e]=o.nativeMethods.arrayFilter.call(n,function(e){return e!==t}))},fs.prototype.offAll=function(e){e?this._eventsListeners[e]=[]:this._eventsListeners={}},fs.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=this._eventsListeners[t];if(r)for(var i=0;i<r.length;i++)try{r[i].apply(this,e)}catch(e){if(!(e.message&&-1<e.message.indexOf("freed script")))throw e;this.off(t,r[i])}},fs);function fs(){this._eventsListeners={}}function ps(t){var n=o.nativeMethods.setTimeout;return new o.PromiseCtor(function(e){return n(e,t)})}var ms="elementIsInvisibleError",gs="foundElementIsNotTarget",ws={1:"element",2:"attribute",3:"text",4:"cdata section",5:"entity reference",6:"entity node",7:"processing instruction",8:"comment",9:"document",10:"document type",11:"document fragment",12:"notation"},vs=(_s.prototype.push=function(e,r){var i=this;this._ensureElementsPromise=this._ensureElementsPromise.then(function(){return i._executeSelectorFn(e,{invisible:r?{name:"ActionAdditionalElementIsInvisibleError",firstArg:r}:"ActionElementIsInvisibleError",notFound:r?{name:"ActionAdditionalElementNotFoundError",firstArg:r}:"ActionElementNotFoundError"},i._ensureElementsStartTime)}).then(function(e){if(!o.dom.isDomElement(e)){var t=e.nodeType,n=ws[t];throw r?new Kt(r,n):new Ht(n)}i._elements.push(e)})},_s.prototype.getElements=function(){var e=this;return this._ensureElementsPromise.then(function(){return e._elements})},_s);function _s(e,t){this._globalSelectorTimeout=e,this._ensureElementsStartTime=o.nativeMethods.dateNow(),this._ensureElementsPromise=o.PromiseCtor.resolve(),this._executeSelectorFn=t,this._elements=[]}var ys,Es=(a(Cs,ys=hs),Cs.prototype._delayAfterExecution=function(){return this._command.options&&1!==this._command.options.speed?ps(2e3*(1-this._command.options.speed)):o.PromiseCtor.resolve()},Cs.prototype._isExecutionTimeoutExpired=function(){return o.nativeMethods.dateNow()-this._executionStartTime>=this._commandSelectorTimeout},Cs.prototype._ensureCommandArguments=function(){var e=Cs.ACTIONS_HANDLERS[this._command.type];null!=e&&e.ensureCmdArgs&&e.ensureCmdArgs(this._command)},Cs.prototype._ensureCommandElements=function(){var e,t=this,n=new vs(this._globalSelectorTimeout,this._executeSelectorFn);this._command.selector&&n.push(this._command.selector);var r=null===(e=Cs.ACTIONS_HANDLERS[this._command.type])||void 0===e?void 0:e.additionalSelectorProps;if(r)for(var i=0,o=r;i<o.length;i++){var s=o[i];this._command[s]&&n.push(this._command[s],s)}return n.getElements().then(function(e){t._elements=e})},Cs.prototype._ensureCommandElementsProperties=function(){var e=Cs.ACTIONS_HANDLERS[this._command.type];null!=e&&e.ensureElsProps&&e.ensureElsProps(this._elements)},Cs.prototype._ensureCommandOptions=function(){return l(this,void 0,void 0,function(){var t,n,r,i;return C(this,function(e){switch(e.label){case 0:return t=this._command.options,this._elements.length&&t&&"offsetX"in t&&"offsetY"in t?[4,o.getOffsetOptions(this._elements[0],t.offsetX,t.offsetY)]:[3,2];case 1:n=e.sent(),r=n.offsetX,i=n.offsetY,t.offsetX=r,t.offsetY=i,e.label=2;case 2:return[2]}})})},Cs.prototype._createAutomation=function(){var e=Cs.ACTIONS_HANDLERS[this._command.type];if(!e)throw new Error('There is no handler for the "'+this._command.type+'" command.');return e.create(this._command,this._elements)},Cs.prototype._runAction=function(t){var n=this;return this._ensureCommandElements().then(function(){return n._ensureCommandElementsProperties()}).then(function(){return n._ensureCommandOptions()}).then(function(){var e=n._createAutomation();return e.TARGET_ELEMENT_FOUND_EVENT?e.on(e.TARGET_ELEMENT_FOUND_EVENT,function(e){n._targetElement=e.element,n.emit(Cs.EXECUTION_STARTED_EVENT)}):n.emit(Cs.EXECUTION_STARTED_EVENT),e.run(t)})},Cs.prototype._runRecursively=function(){var t=this,e=!1,n=!0;return function(t,n){return l(this,void 0,void 0,function(){return C(this,function(e){switch(e.label){case 0:return t()?[4,n()]:[3,2];case 1:return e.sent(),[3,0];case 2:return[2]}})})}(function(){return!e},function(){return t._runAction(n).then(function(){e=!0}).catch(function(e){if(!t._isExecutionTimeoutExpired())return ps(250);if(e.message===gs)return n=!1,o.PromiseCtor.resolve();throw e.message===ms?new Lt:e})})},Cs.prototype.execute=function(e){var t=this;this._executionStartTime=o.nativeMethods.dateNow();try{this._ensureCommandArguments()}catch(e){return o.PromiseCtor.reject(e)}return this.emit(Cs.WAITING_FOR_ELEMENT_EVENT,this._commandSelectorTimeout),this._runRecursively().then(function(){return n.all([t._delayAfterExecution(),e.wait()])}).then(function(){var e=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}(t._elements);return t._targetElement&&(e[0]=t._targetElement),e})},Cs.EXECUTION_STARTED_EVENT="execution-started",Cs.WAITING_FOR_ELEMENT_EVENT="waiting-for-elements",Cs.ACTIONS_HANDLERS={},Cs);function Cs(e,t,n,r){var i,o=ys.call(this)||this;return o._command=e,o._targetElement=null,o._elements=[],o._globalSelectorTimeout=t,o._executionStartTime=0,o._executeSelectorFn=r,e.options&&!e.options.speed&&(e.options.speed=n),o._commandSelectorTimeout="number"==typeof(null===(i=e.selector)||void 0===i?void 0:i.timeout)?e.selector.timeout:t,o}function Is(e,t,n){return Math.min(Math.max(t,e),n)}function Ss(e,t){var n="number"==typeof e.min,r="number"==typeof e.max,i="number"==typeof e.length;return i&&(e.length=Is(e.length,0,t)),n&&e.min<0&&(e.min+=t),r&&e.max<0&&(e.max+=t),n||(e.min=r&&i?e.max-e.length:0),r||(e.max=i?e.min+e.length:t),e.min=Is(e.min,0,t),e.max=Is(e.max,0,t),e.length=e.max-e.min,e}function Ws(e,t,n){return Math.round(e+Is(t-e,0,n)/2)}var bs,Ts=(a(As,bs=Zr),As.prototype._createReplicator=function(){return Or([new Kr])},As.prototype._getTimeoutErrorParams=function(){return{apiFnIndex:Xr.error,apiFnChain:this.command.apiFnChain}},As.prototype._getTimeoutError=function(e){return e?this.createIsInvisibleError:this.createNotFoundError},As.prototype._validateElement=function(s,a){var l=this;return Hr.PromiseCtor.resolve().then(function(){return bs.prototype._executeFn.call(l,s)}).then(function(e){var t=e,n=!!t,r=!l.command.visibilityCheck||t&&Br(t),i=Hr.nativeMethods.dateNow()-a>=l.timeout;if(n&&(r||Hr.isShadowRoot(t)))return t;if(!i)return Hr.delay(200).then(function(){return l._validateElement(s,a)});var o=l.getVisibleValueMode?null:l._getTimeoutError(n);if(o)throw o(l._getTimeoutErrorParams());return null})},As.prototype._executeFn=function(e){return this.counterMode?bs.prototype._executeFn.call(this,e):this._validateElement(e,Hr.nativeMethods.dateNow())},As);function As(e,t,n,r,i){var o,s=bs.call(this,e)||this;s.createNotFoundError=r,s.createIsInvisibleError=i,s.timeout="number"==typeof e.timeout?e.timeout:t,s.counterMode=s.dependencies.filterOptions.counterMode,s.getVisibleValueMode=s.dependencies.filterOptions.getVisibleValueMode,s.dependencies.selectorFilter=Xr,n&&(o=Hr.nativeMethods.dateNow()-n,s.timeout=Math.max(s.timeout-o,0));var a=s.dependencies.customDOMProperties;return s.replicator.addTransforms([new us(a,e.instantiationCallsiteName)]),s}var Ns=u.nativeMethods.date,xs=(Rs.prototype._ensureElement=function(e){var t=this,n=e.selector,r=e.createNotFoundError,i=e.createIsInvisibleError,o=e.createHasWrongNodeTypeError;this.ensureElementsPromise=this.ensureElementsPromise.then(function(){return new Ts(n,t.globalSelectorTimeout,t.ensureElementsStartTime,r,i).getResult()}).then(function(e){if(!E.domUtils.isDomElement(e))throw o(ws[e.nodeType]);t.elements.push(e)})},Rs.prototype.getElements=function(){var e=this;return this.ensureElementsPromise.then(function(){return e.elements})},Rs);function Rs(e,t){var n=this;this.elements=[],this.globalSelectorTimeout=t,this.ensureElementsPromise=u.Promise.resolve(),this.ensureElementsStartTime=new Ns,e.forEach(function(e){return n._ensureElement(e)})}function Ds(r){return function(e,t){var n=typeof t;if("number"!=n)throw new r(e,n);if(isNaN(t)||!isFinite(t)||t!==Math.floor(t))throw new r(e,t)}}var Ms,Ps,Fs,ks,Ls,Os,Us,Hs,Bs=Ds(ft),Gs=(Ps=Ds(Ms=gt),function(e,t){if(Ps(e,t),t<0)throw new Ms(e,t)}),Vs=(Fs=_t,function(e,t){var n=typeof t;if("boolean"!=n)throw new Fs(e,n)}),qs=(ks=Ct,function(e,t){var n=typeof t;if("number"!=n)throw new ks(e,n);if(isNaN(t)||t<.01||1<t)throw new ks(e,t)}),zs=(Ls=Wt,function(e,t){var n=typeof t;if("string"!=n)throw new Ls(e,n)}),js=(Os=At,function(e,t){if(!(t instanceof Date))throw new Os(e,t)}),Xs=(Us=Rt,function(e,t){if(isNaN(Number(t)))throw new Us(e,typeof t)}),Ys=(a(Ks,Hs=Oo),Ks.prototype._getAssignableProperties=function(){return[{name:"speed",type:qs}]},Ks);function Ks(e,t){var n=Hs.call(this)||this;return n.speed=null,n._assignFrom(e,t),n}var Js,$s=(a(Qs,Js=Ys),Qs.prototype._getAssignableProperties=function(){return Js.prototype._getAssignableProperties.call(this).concat([{name:"offsetX",type:Bs},{name:"offsetY",type:Bs}])},Qs);function Qs(e,t){var n=Js.call(this)||this;return n.offsetX=null,n.offsetY=null,n._assignFrom(e,t),n}var Zs,ea=(a(ta,Zs=$s),ta.prototype._getAssignableProperties=function(){return Zs.prototype._getAssignableProperties.call(this).concat([{name:"scrollToCenter",type:Vs},{name:"skipParentFrames",type:Vs}])},ta);function ta(e,t){var n=Zs.call(this)||this;return n.scrollToCenter=!1,n.skipParentFrames=!1,n._assignFrom(e,t),n}var na,ra=(a(ia,na=Ys),ia.prototype._getAssignableProperties=function(){return na.prototype._getAssignableProperties.call(this).concat([{name:"scrollTargetX",type:Bs},{name:"scrollTargetY",type:Bs},{name:"crop.left",type:Bs},{name:"crop.right",type:Bs},{name:"crop.top",type:Bs},{name:"crop.bottom",type:Bs},{name:"includeMargins",type:Vs},{name:"includeBorders",type:Vs},{name:"includePaddings",type:Vs}])},ia);function ia(e,t){var n=na.call(this)||this;return n.scrollTargetX=null,n.scrollTargetY=null,n.includeMargins=!1,n.includeBorders=!0,n.includePaddings=!0,n.crop={left:null,right:null,top:null,bottom:null},n._assignFrom(e,t),n}var oa,sa=(a(aa,oa=$s),aa.prototype._getAssignableProperties=function(){return oa.prototype._getAssignableProperties.call(this).concat([{name:"modifiers.ctrl",type:Vs},{name:"modifiers.alt",type:Vs},{name:"modifiers.shift",type:Vs},{name:"modifiers.meta",type:Vs}])},aa);function aa(e,t){var n=oa.call(this)||this;return n.modifiers={ctrl:!1,alt:!1,shift:!1,meta:!1},n._assignFrom(e,t),n}var la,ca,ua,da,ha,fa,pa,ma,ga=(a(wa,la=sa),wa.prototype._getAssignableProperties=function(){return la.prototype._getAssignableProperties.call(this).concat([{name:"caretPos",type:Gs}])},wa);function wa(e,t){var n=la.call(this)||this;return n.caretPos=null,n._assignFrom(e,t),n}function va(e,t){var n=ca.call(this)||this;return n.speed=null,n.minMovingTime=null,n.holdLeftButton=!1,n.skipScrolling=!1,n.skipDefaultDragBehavior=!1,n._assignFrom(e,t),n}function _a(e,t){var n=ua.call(this)||this;return n.replace=!1,n.paste=!1,n.confidential=void 0,n._assignFrom(e,t),n}function ya(e,t){var n=da.call(this,e,t)||this;return n.destinationOffsetX=null,n.destinationOffsetY=null,n._assignFrom(e,t),n}function Ea(e,t){var n=ha.call(this)||this;return n.portraitOrientation=!1,n._assignFrom(e,t),n}function Ca(e,t){var n=fa.call(this)||this;return n.timeout=void 0,n.allowUnawaitedPromise=!1,n._assignFrom(e,t),n}function Ia(e,t){var n=pa.call(this)||this;return n.confidential=void 0,n._assignFrom(e,t),n}function Sa(e,t){var n=ma.call(this)||this;return n._assignFrom(e,t),n}function Wa(e){return e.top!==e}a(va,ca=sa),va.prototype._getAssignableProperties=function(){return ca.prototype._getAssignableProperties.call(this).concat([{name:"speed"},{name:"minMovingTime"},{name:"holdLeftButton"},{name:"skipScrolling",type:Vs},{name:"skipDefaultDragBehavior",type:Vs}])},a(_a,ua=ga),_a.prototype._getAssignableProperties=function(){return ua.prototype._getAssignableProperties.call(this).concat([{name:"replace",type:Vs},{name:"paste",type:Vs},{name:"confidential",type:Vs}])},a(ya,da=sa),ya.prototype._getAssignableProperties=function(){return da.prototype._getAssignableProperties.call(this).concat([{name:"destinationOffsetX",type:Bs},{name:"destinationOffsetY",type:Bs}])},a(Ea,ha=Oo),Ea.prototype._getAssignableProperties=function(){return[{name:"portraitOrientation",type:Vs}]},a(Ca,fa=Oo),Ca.prototype._getAssignableProperties=function(){return[{name:"timeout",type:Gs},{name:"allowUnawaitedPromise",type:Vs}]},a(Ia,pa=Ys),Ia.prototype._getAssignableProperties=function(){return pa.prototype._getAssignableProperties.call(this).concat([{name:"confidential",type:Vs}])},a(Sa,ma=Oo),Sa.prototype._getAssignableProperties=function(){return[{name:"name",type:zs},{name:"value",type:zs},{name:"domain",type:zs},{name:"path",type:zs},{name:"expires",type:js},{name:"maxAge",type:Xs},{name:"secure",type:Vs},{name:"httpOnly",type:Vs},{name:"sameSite",type:zs}]};var ba=u.eventSandbox.message,Ta="driver|browser-manipulation|request",Aa="driver|browser-manipulation|response";ba.on(ba.SERVICE_MSG_RECEIVED_EVENT,function(t){var e,n,r,i,o;t.message.cmd===Ta&&(e=E.domUtils.findIframeByWindow(t.source),r=(n=t.message).command,(i=n.cropDimensions)&&(r.options=new ra({crop:i,includePaddings:!1})),(o=new Na(r)).element=e,o.execute().then(function(e){return ba.sendServiceMsg({cmd:Aa,result:e},t.source)}))});var Na=(xa.prototype._getAbsoluteCropValues=function(){var e=this.element.getBoundingClientRect(),t=e.top,n=e.left;n+=this.command.options.originOffset.x,t+=this.command.options.originOffset.y;var r=n+this.command.options.crop.right,i=t+this.command.options.crop.bottom;return{top:t+=this.command.options.crop.top,left:n+=this.command.options.crop.left,bottom:i,right:r}},xa.prototype._createManipulationReadyMessage=function(){var e=Gl.devicePixelRatio||1,t={cmd:x.readyForBrowserManipulation,pageDimensions:{dpr:e,innerWidth:Gl.innerWidth,innerHeight:Gl.innerHeight,documentWidth:Vl.documentElement.clientWidth,documentHeight:Vl.documentElement.clientHeight,bodyWidth:Vl.body.clientWidth,bodyHeight:Vl.body.clientHeight},disableResending:!0};return this.command.type===R.takeElementScreenshot&&(t.cropDimensions=this._getAbsoluteCropValues()),t},xa.prototype._runScrollBeforeScreenshot=function(){var i=this;return u.Promise.resolve().then(function(){if(i.element||!i.command.selector)return u.Promise.resolve();var e,t,n=i.command.selector.timeout,r="number"==typeof n?n:i.globalSelectorTimeout;return i.statusBar.showWaitingElementStatus(r),e=[{selector:i.command.selector,createNotFoundError:function(e){return new Pt(null,e)},createIsInvisibleError:function(){return new Lt},createHasWrongNodeTypeError:function(e){return new Ht(e)}}],t=i.globalSelectorTimeout,new xs(e,t).getElements().then(function(e){i.statusBar.hideWaitingElementStatus(),i.element=e[0]}).catch(function(e){throw i.statusBar.hideWaitingElementStatus(),e})}).then(function(){return function(v,_){return l(this,void 0,void 0,function(){var t,n,r,i,o,s,a,l,c,u,d,h,f,p,m,g,w;return C(this,function(e){switch(e.label){case 0:if(t=v.getBoundingClientRect(),n={left:t.left,right:t.right,top:t.top,bottom:t.bottom},r=E.styleUtils.getElementMargin(v),i=E.styleUtils.getElementPadding(v),o=E.styleUtils.getBordersWidth(v),_.originOffset={x:0,y:0},s=n.left+v.scrollWidth+o.left+o.right,a=n.top+v.scrollHeight+o.top+o.bottom,n.right=Math.max(n.right,s),n.bottom=Math.max(n.bottom,a),_.includeBorders&&_.includePaddings?_.includeMargins&&(_.originOffset.x-=r.left,_.originOffset.y-=r.top,n.left-=r.left,n.top-=r.top,n.right+=r.right,n.bottom+=r.bottom):(_.originOffset.x+=o.left,_.originOffset.y+=o.top,n.left+=o.left,n.top+=o.top,n.right-=o.right,n.bottom-=o.bottom,_.includePaddings||(_.originOffset.x+=i.left,_.originOffset.y+=i.top,n.left+=i.left,n.top+=i.top,n.right-=i.right,n.bottom-=i.bottom)),n.width=n.right-n.left,n.height=n.bottom-n.top,l=Ss({min:_.crop.left,max:_.crop.right,length:_.crop.width},n.width),c=Ss({min:_.crop.top,max:_.crop.bottom,length:_.crop.height},n.height),_.crop.left=l.min,_.crop.right=l.max,_.crop.width=l.length,_.crop.top=c.min,_.crop.bottom=c.max,_.crop.height=c.length,_.crop.width<=0||_.crop.height<=0)throw new In(_.crop.width,_.crop.height);return u=E.styleUtils.getViewportDimensions(),(n.width>u.width||n.height>u.height)&&(_.scrollToCenter=!0),d="number"==typeof _.scrollTargetX,h="number"==typeof _.scrollTargetY,d||(_.scrollTargetX=Ws(_.crop.left,_.crop.right,u.width)),h||(_.scrollTargetY=Ws(_.crop.top,_.crop.bottom,u.height)),[4,y.getOffsetOptions(v,_.scrollTargetX,_.scrollTargetY)];case 1:if(f=e.sent(),p=f.offsetX,m=f.offsetY,_.scrollTargetX=p,_.scrollTargetY=m,g=!d||_.scrollTargetX>=_.crop.left&&_.scrollTargetX<=_.crop.right,w=!h||_.scrollTargetY>=_.crop.top&&_.scrollTargetY<=_.crop.bottom,!g||!w)throw new yn(g,w);return[2]}})})}(i.element,i.command.options)}).then(function(){var e=i.command.options,t=e.scrollTargetX,n=e.scrollTargetY,r=e.scrollToCenter;return new E.ScrollAutomation(i.element,new ea({offsetX:t,offsetY:n,scrollToCenter:r,skipParentFrames:!0})).run()})},xa.prototype._hideUI=function(){return t.hide(),this.command.markData&&t.showScreenshotMark(this.command.markData),E.delay(500)},xa.prototype._showUI=function(){this.command.markData&&t.hideScreenshotMark(),t.show()},xa.prototype._requestManipulation=function(){if(!Wa(Gl))return u.transport.queuedAsyncServiceMsg(this._createManipulationReadyMessage());var e=this._getAbsoluteCropValues();return E.sendRequestToFrame({cmd:Ta,command:this.command,cropDimensions:e},Aa,Gl.parent).then(function(e){if(!e.result)return{result:null};var t=e.result,n=t.result,r=t.executionError;if(r)throw r;return{result:n}})},xa.prototype._runManipulation=function(){var r=this,i=null;return u.Promise.resolve().then(function(){return r.command.type!==R.takeElementScreenshot?u.Promise.resolve():(E.scrollController.stopPropagation(),r._runScrollBeforeScreenshot())}).then(function(){return Wa(Gl)?u.Promise.resolve():r._hideUI()}).then(function(){return r._requestManipulation()}).then(function(e){var t=e.result,n=e.error;if(n)throw n;return E.scrollController.enablePropagation(),i=t,Wa(Gl)||r._showUI(),E.delay(200)}).then(function(){return new Bo({isCommandResult:!0,result:i})}).catch(function(e){return E.scrollController.enablePropagation(),new Bo({isCommandResult:!0,executionError:e})})},xa.prototype.execute=function(){var e=this;return function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=new E.ClientRequestEmitter,i=new E.RequestBarrier(r),o=new E.ScriptExecutionEmitter,s=new E.ScriptExecutionBarrier(o);E.pageUnloadBarrier.watchForPageNavigationTriggers();var a=null,l=e.apply(void 0,t),c=l.then(function(e){return a=e,u.Promise.all([i.wait().then(function(){return s.wait()}),E.pageUnloadBarrier.wait()])}).then(function(){return a});return{actionPromise:l,barriersPromise:c}}(function(){return e._runManipulation()}).barriersPromise},xa);function xa(e,t,n){this.command=e,this.globalSelectorTimeout=t,this.statusBar=n,this.element=null}function Ra(t){return t.getResult().then(function(e){return new Bo({isCommandResult:!0,result:t.encodeResult(e)})}).catch(function(e){return new Bo({isCommandResult:!0,executionError:e})})}var Da=s.Promise,Ma=(Pa.prototype.setAsMaster=function(e){var t=this;return Vo(new uo(e),this.driverWindow,qo,Bn).catch(function(e){if(!t._isNonPageWindow)throw e})},Pa.prototype.closeAllChildWindows=function(){return Vo(new po,this.driverWindow,qo,qn)},Pa.prototype.findChildWindows=function(e,t){return Vo(new t(e),this.driverWindow,qo,Bn)},Pa.prototype.startToRestore=function(){return Vo(new wo,this.driverWindow,qo,Bn)},Pa.prototype.closeFileDownloadingWindow=function(){this._isNonPageWindow=!0,this.driverWindow.close()},Pa);function Pa(e,t){this._isNonPageWindow=!1,this.driverWindow=e,this.windowId=t}var Fa=(ka.prototype._getTopOpenedWindow=function(e){for(var t=e;t.opener;)t=t.opener;return t.top},ka.prototype._setAsMaster=function(e,t){return Vo(new uo(t),e,qo,Bn)},ka.prototype.getTopOpenedWindow=function(){return this._getTopOpenedWindow(this.currentDriverWindow)},ka.prototype.setTopOpenedWindowAsMaster=function(){var e=this._getTopOpenedWindow(this.currentDriverWindow);return this._setAsMaster(e)},ka.prototype.setParentWindowAsMaster=function(e){void 0===e&&(e={});var t=this.currentDriverWindow.opener;return this._setAsMaster(t,e.finalizePendingCommand)},ka.prototype.restoreChild=function(r){return l(this,void 0,void 0,function(){var t,n;return C(this,function(e){return t=new yo(r),n=this.currentDriverWindow.opener,Vo(t,n,qo,Bn),[2]})})},ka);function ka(e){this.currentDriverWindow=e}var La="master",Oa="replica",Ua=(Ha.prototype.shouldTransform=function(e,t){return t instanceof Hr.nativeMethods.Node},Ha.prototype.toSerializable=function(e){return new os(e)},Ha.prototype.fromSerializable=function(){},Ha);function Ha(){this.type="Node"}function Ba(t){return new n(function(e){return setTimeout(e,t)})}var Ga=(Va.prototype._startListening=function(){var t=this;this._emitter.onRequestSend(function(e){return t._onRequestSend(e)}),this._emitter.onRequestCompleted(function(e){return t._onRequestCompleted(e)}),this._emitter.onRequestError(function(e){return t._onRequestError(e)})},Va.prototype._offListening=function(){this._emitter.offAll()},Va.prototype._onRequestSend=function(e){this._collectingReqs&&this._requests.add(e)},Va.prototype._onRequestCompleted=function(e){var t=this;Ba(this._delays.additionalRequestsCollection).then(function(){return t._onRequestFinished(e)})},Va.prototype._onRequestFinished=function(e){this._requests.has(e)&&(this._requests.delete(e),this._collectingReqs||this._requests.size||!this._watchdog||this._finishWaiting())},Va.prototype._onRequestError=function(e){this._onRequestFinished(e)},Va.prototype._finishWaiting=function(){this._watchdog&&((0,o.nativeMethods.clearTimeout)(this._watchdog),this._watchdog=null),this._requests.clear(),this._offListening(),this._waitResolve()},Va.prototype.wait=function(e){var n=this;return Ba(e?this._delays.pageInitialRequestsCollection:this._delays.requestsCollection).then(function(){return new o.PromiseCtor(function(e){var t;n._collectingReqs=!1,n._waitResolve=e,n._requests.size?(t=o.nativeMethods.setTimeout,n._watchdog=t(function(){return n._finishWaiting()},Va.TIMEOUT)):n._finishWaiting()})})},Va.TIMEOUT=3e3,Va);function Va(e,t){var n,r,i;void 0===t&&(t={}),this._delays={requestsCollection:null!==(n=t.requestsCollection)&&void 0!==n?n:50,additionalRequestsCollection:null!==(r=t.additionalRequestsCollection)&&void 0!==r?r:50,pageInitialRequestsCollection:null!==(i=t.pageInitialRequestsCollection)&&void 0!==i?i:50},this._emitter=e,this._waitResolve=null,this._watchdog=null,this._requests=new Set,this._collectingReqs=!0,this._startListening()}var qa=(za.prototype._startListening=function(){var t=this;this._emitter.onScriptAdded(function(e){return t._onScriptElementAdded(e)}),this._emitter.onScriptLoadedOrFailed(function(e){return t._onScriptLoadedOrFailed(e)})},za.prototype._offListening=function(){this._emitter.offAll()},za.prototype._onScriptElementAdded=function(e){var t=this,n=(0,o.nativeMethods.setTimeout)(function(){return t._onScriptLoadedOrFailed(e,!0)},za.LOADING_TIMEOUT);this._scripts.set(e,n)},za.prototype._onScriptLoadedOrFailed=function(e,t){var n=this;void 0===t&&(t=!1),this._scripts.has(e)&&(t||(0,o.nativeMethods.clearTimeout)(this._scripts.get(e)),this._scripts.delete(e),this._scripts.size||ps(25).then(function(){n._waitResolve&&!n._scripts.size&&n._finishWaiting()}))},za.prototype._finishWaiting=function(){this._watchdog&&((0,o.nativeMethods.clearTimeout)(this._watchdog),this._watchdog=null),this._scripts.clear(),this._offListening(),this._waitResolve(),this._waitResolve=null},za.prototype.wait=function(){var n=this;return new o.PromiseCtor(function(e){var t;n._waitResolve=e,n._scripts.size?(t=o.nativeMethods.setTimeout,n._watchdog=t(function(){return n._finishWaiting()},za.TIMEOUT)):n._finishWaiting()})},za.TIMEOUT=3e3,za.LOADING_TIMEOUT=2e3,za);function za(e){this._emitter=e,this._watchdog=null,this._waitResolve=null,this._scripts=new Map,this._startListening()}var ja=(Xa.prototype.wait=function(){var e=this;return o.PromiseCtor.all([this._requestBarrier.wait().then(function(){return e._scriptExecutionBarrier.wait()}),this._unloadBarrier.wait()]).then()},Xa);function Xa(e,t,n){this._requestBarrier=new Ga(e),this._scriptExecutionBarrier=new qa(t),(this._unloadBarrier=n).watchForPageNavigationTriggers&&n.watchForPageNavigationTriggers()}function Ya(e){var t="string"==typeof e?Ar[e]:Ar[e.name],n="string"==typeof e?null:e.firstArg;return function(e){return new t(n,e)}}function Ka(e,t){var n=y.calculateSelectTextArguments(t[0],e);return new y.SelectText(t[0],n.startPos,n.endPos,e.options)}function Ja(e){if(!E.domUtils.isFileInput(e))throw new wn}Es.ACTIONS_HANDLERS[R.dispatchEvent]={additionalSelectorProps:["relatedTarget"],create:function(e,t){return t[1]&&(e.options.relatedTarget=t[1]),new y.DispatchEvent(t[0],e.eventName,e.options)}},Es.ACTIONS_HANDLERS[R.pressKey]={create:function(e){return new y.Press(E.parseKeySequence(e.keys).combinations,e.options)},ensureCmdArgs:function(e){if(E.parseKeySequence(e.keys).error)throw new dn("keys")}},Es.ACTIONS_HANDLERS[R.click]={create:function(e,t){return/option|optgroup/.test(E.domUtils.getTagName(t[0]))?new y.SelectChildClick(t[0],e.options):new y.Click(t[0],e.options,Gl,y.cursor)}},Es.ACTIONS_HANDLERS[R.rightClick]={create:function(e,t){return new y.RClick(t[0],e.options)}},Es.ACTIONS_HANDLERS[R.doubleClick]={create:function(e,t){return new y.DblClick(t[0],e.options)}},Es.ACTIONS_HANDLERS[R.hover]={create:function(e,t){return new y.Hover(t[0],e.options)}},Es.ACTIONS_HANDLERS[R.drag]={create:function(e,t){return new y.DragToOffset(t[0],e.dragOffsetX,e.dragOffsetY,e.options)}},Es.ACTIONS_HANDLERS[R.dragToElement]={additionalSelectorProps:["destinationSelector"],create:function(e,t){return new y.DragToElement(t[0],t[1],e.options)}},Es.ACTIONS_HANDLERS[R.scroll]={create:function(e,t){var n=e.x,r=e.y,i=e.position,o=e.options;return new y.SetScroll(t[0],{x:n,y:r,position:i},o)}},Es.ACTIONS_HANDLERS[R.scrollBy]={create:function(e,t){var n=e.byX,r=e.byY,i=e.options;return new y.SetScroll(t[0],{byX:n,byY:r},i)}},Es.ACTIONS_HANDLERS[R.scrollIntoView]={create:function(e,t){return new y.ScrollIntoView(t[0],e.options)}},Es.ACTIONS_HANDLERS[R.typeText]={create:function(e,t){return new y.Type(t[0],e.text,e.options)}},Es.ACTIONS_HANDLERS[R.selectText]={create:Ka,ensureElsProps:function(e){if(!E.domUtils.isEditableElement(e[0]))throw new Qt}},Es.ACTIONS_HANDLERS[R.selectTextAreaContent]={create:Ka,ensureElsProps:function(e){if(!E.domUtils.isTextAreaElement(e[0]))throw new tn}},Es.ACTIONS_HANDLERS[R.selectEditableContent]={additionalSelectorProps:["startSelector","endSelector"],create:function(e,t){return e.endSelector=e.endSelector||e.startSelector,new y.SelectEditableContent(t[0],t[1],e.options)},ensureElsProps:function(e){if(!E.domUtils.isContentEditableElement(e[0]))throw new on("startSelector");if(!E.domUtils.isContentEditableElement(e[1]))throw new on("endSelector");if(!E.contentEditable.getNearestCommonAncestor(e[0],e[1]))throw new ln}},Es.ACTIONS_HANDLERS[R.setFilesToUpload]={create:function(e,t){return new y.Upload(t[0],e.filePath,function(e,t){return new pn(e,t)})},ensureElsProps:function(e){return Ja(e[0])}},Es.ACTIONS_HANDLERS[R.clearUpload]={create:function(e,t){return new y.Upload(t[0])},ensureElsProps:function(e){return Ja(e[0])}};var $a,Qa=s.settings,Za=s.transport,el=s.Promise,tl=s.eventSandbox.message,nl=s.storages,rl=s.nativeMethods,il=rl.date,ol=s.eventSandbox.listeners,sl="testcafe|driver|test-done-sent-flag",al="testcafe|driver|pending-status",ll="testcafe|driver|executing-client-function-descriptor",cl="testcafe|driver|selector-execution-start-time",ul="testcafe|driver|pending-page-error",dl="testcafe|driver|active-iframe-selector",hl="testcafe|driver|test-speed",fl="testcafe|driver|assertion-retries-timeout",pl="testcafe|driver|assertion-retries-start-time",ml="testcafe|driver|console-messages",gl="testcafe|driver|pending-child-window-count",wl={NotLoadedError:Nn,NotFoundError:Pt,IsInvisibleError:Lt},vl={NotLoadedError:Dn,NotFoundError:wr,IsInvisibleError:yr},_l=Math.pow(2,31)-1,yl="status-with-command-result-event",El="empty-command-event",Cl="child-window-closed",Il=(a(Sl,$a=E.serviceUtils.EventEmitter),Sl.prototype._isOpenedInIframe=function(){var e=Gl.opener;return e&&e.top&&e.top!==e},Object.defineProperty(Sl.prototype,"speed",{get:function(){return this.contextStorage.getItem(hl)},set:function(e){this.contextStorage.setItem(hl,e)},enumerable:!1,configurable:!0}),Object.defineProperty(Sl.prototype,"consoleMessages",{get:function(){return new Mr(this.contextStorage.getItem(ml))},set:function(e){return this.contextStorage.setItem(ml,e?e.getCopy():null)},enumerable:!1,configurable:!0}),Sl.prototype._getReadyPromise=function(){return l(this,void 0,void 0,function(){return C(this,function(e){switch(e.label){case 0:return[4,E.eventUtils.documentReady(this.pageLoadTimeout)];case 1:return e.sent(),[4,this.pageInitialRequestBarrier.wait(!0)];case 2:return e.sent(),[2]}})})},Sl.prototype._hasPendingActionFlags=function(e){return e.getItem(this.COMMAND_EXECUTING_FLAG)||e.getItem(this.EXECUTING_IN_IFRAME_FLAG)},Sl.prototype._getCurrentWindowId=function(){var e=Gl.location.toString(),t=s.utils.url.parseProxyUrl(e);return t&&t.windowId||null},Sl.prototype._onJsError=function(e){if(this.skipJsErrors||this.contextStorage.getItem(sl))return el.resolve();var t=new Qe(e.stack,e.pageUrl);return this.contextStorage.getItem(ul)||this.contextStorage.setItem(ul,t),null},Sl.prototype._unlockPageAfterTestIsDone=function(){return E.disableRealEventsPreventing(),el.resolve()},Sl.prototype._getActiveElement=function(){return l(this,void 0,void 0,function(){var t;return C(this,function(e){return t=E.domUtils.getActiveElement(),[2,this.replicator.encode(t)]})})},Sl.prototype._failIfClientCodeExecutionIsInterrupted=function(){var e=this.contextStorage.getItem(ll);return!!e&&(this._onReady(new Bo({isCommandResult:!0,executionError:new Le(e.instantiationCallsiteName)})),!0)},Sl.prototype.onCustomClientScriptError=function(e,t){var n=t?new ut(e,t):new at(e);this.contextStorage.getItem(ul)||this.contextStorage.setItem(ul,n)},Sl.prototype._addChildWindowDriverLink=function(e){var t=new Ma(e.window,e.windowId);this.childWindowDriverLinks.push(t),this._ensureClosedChildWindowWatcher()},Sl.prototype._ensureClosedChildWindowWatcher=function(){var t=this;this.checkClosedChildWindowIntervalId||(this.checkClosedChildWindowIntervalId=rl.setInterval.call(Gl,function(){var e=E.arrayUtils.find(t.childWindowDriverLinks,function(e){return e.driverWindow.closed});e&&(t.emit(Cl),E.arrayUtils.remove(t.childWindowDriverLinks,e),e.ignoreMasterSwitching||t._setCurrentWindowAsMaster(),t.childWindowDriverLinks.length||(rl.clearInterval.call(Gl,t.checkClosedChildWindowIntervalId),delete t.checkClosedChildWindowIntervalId))},200))},Sl.prototype._setAsMasterInProgressOrCompleted=function(){return this.setAsMasterInProgress||this.role===La},Sl.prototype._setCurrentWindowAsMaster=function(){var e=this;this._setAsMasterInProgressOrCompleted()||(this.setAsMasterInProgress=!0,this._clearActiveChildIframeInfo(),el.resolve().then(function(){return E.browser.setActiveWindowId(e.browserActiveWindowId,s.createNativeXHR,e.windowId)}).then(function(){e._startInternal({finalizePendingCommand:!0,isFirstRequestAfterWindowSwitching:!0}),e.setAsMasterInProgress=!1}).catch(function(){e._onReady(new Bo({isCommandResult:!0,executionError:new Bn}))}))},Sl.prototype._onChildWindowOpened=function(e){this._addChildWindowDriverLink(e),this._switchToChildWindow(e.windowId)},Sl.prototype._sendStartToRestoreCommand=function(){if(this.contextStorage){this._stopRespondToChildren=!0,this.contextStorage.setItem(gl,this.childWindowDriverLinks.length);for(var e=0,t=this.childWindowDriverLinks;e<t.length;e++)t[e].startToRestore()}},Sl.prototype._onFormSubmit=function(e){this.contextStorage&&this.contextStorage.getItem(sl)&&(e.preventSubmit=!0)},Sl.prototype._onConsoleMessage=function(e){var t=e.meth,n=e.line,r=this.consoleMessages;r.addMessage(t,n,this.windowId),this.consoleMessages=r},Sl.prototype._addPendingErrorToStatus=function(e){var t=this.contextStorage.getItem(ul);t&&(this.contextStorage.setItem(ul,null),e.pageError=t)},Sl.prototype._addUnexpectedDialogErrorToStatus=function(e){var t=this.nativeDialogsTracker.getUnexpectedDialogError();e.pageError=e.pageError||t},Sl.prototype._addConsoleMessagesToStatus=function(e){e.consoleMessages=this.consoleMessages,this.consoleMessages=null},Sl.prototype._addPendingWindowSwitchingStateToStatus=function(e){e.isPendingWindowSwitching=this._isPendingSwitchingWindow()},Sl.prototype._sendStatusRequest=function(e){function t(){return E.getTimeLimitedPromise(Za.asyncServiceMsg(r),5e3)}function n(){return E.delay(300).then(t)}for(var r={cmd:x.ready,status:e,disableResending:!0,allowRejecting:!0},i=t(),o=0;o<N;o++)i=i.catch(n);return i},Sl.prototype._sendStatus=function(e){var t=this;e.resent||(this._addPendingErrorToStatus(e),this._addUnexpectedDialogErrorToStatus(e),this._addConsoleMessagesToStatus(e),this._addPendingWindowSwitchingStateToStatus(e)),this.contextStorage.setItem(al,e);var n=null;return E.pageUnloadBarrier.wait(0).then(function(){return t._sendStatusRequest(e)}).then(function(e){return n=e,E.pageUnloadBarrier.wait(0)}).then(function(){return t.contextStorage.setItem(al,null),n})},Sl.prototype._addChildIframeDriverLink=function(e,t){var n,r=this._getChildIframeDriverLinkByWindow(t);r||(n=this.testRunId+"-"+fi(),r=new jo(t,n),this.childIframeDriverLinks.push(r)),r.sendConfirmationMessage(e)},Sl.prototype._getTargetWindowNotFoundResult=function(e,t){return el.resolve({success:!1,errCode:e,errMsg:t})},Sl.prototype._getChildWindowValidateResult=function(e){var t=e.find(function(e){return e.result.success});if(t)return t.result;var n=e.find(function(e){return e.result.errCode===ve||e.result.errCode===Ie});return(n=n||e.find(function(e){return!!e.result.errCode}))?{errCode:n.result.errCode}:void 0},Sl.prototype._handleWindowValidation=function(n,r,i,o){return l(this,void 0,void 0,function(){var t;return C(this,function(e){switch(e.label){case 0:return[4,this._validateWindow(n,r,i,o)];case 1:return t=e.sent(),zo({requestMsgId:n.id,window:r,result:t}),[2]}})})},Sl.prototype._getWindowInfo=function(){var e=s.utils.url.parseProxyUrl(Gl.location.toString());return{id:this.windowId,title:Vl.title,url:e.destUrl}},Sl.prototype._isTargetWindow=function(e){return e.windowId===this.windowId},Sl.prototype._validateWindow=function(r,e,i,o){return l(this,void 0,void 0,function(){var t,n;return C(this,function(e){switch(e.label){case 0:return this._isTargetWindow(r)?[2,i()]:this.childWindowDriverLinks.length?(t=this.childWindowDriverLinks.map(function(e){return e.findChildWindows(r,o)}),[4,el.all(t)]):[2,this._getTargetWindowNotFoundResult(_e)];case 1:return n=e.sent(),[2,this._getChildWindowValidateResult(n)]}})})},Sl._createWindowValidationError=function(e){var t=e.errCode;return new(t===ve?Xn:t===Ie?Jn:nr)},Sl.prototype._getCloseWindowFoundResult=function(){return this.parentWindowDriverLink?this.childWindowDriverLinks.length?el.resolve({success:!1,errCode:ve}):el.resolve({success:!0}):el.resolve({success:!1,errCode:Ie})},Sl.prototype._handleCloseWindowValidation=function(e,t){var n=this;return this._handleWindowValidation(e,t,function(){return n._getCloseWindowFoundResult()},Li)},Sl.prototype._handleSwitchToWindowValidation=function(e,t){return this._handleWindowValidation(e,t,function(){return el.resolve({success:!0})},Hi)},Sl.prototype._handleCloseWindow=function(t,n){return l(this,void 0,void 0,function(){return C(this,function(e){switch(e.label){case 0:return[4,this._closeWindow(t,n)];case 1:return e.sent(),zo({requestMsgId:t.id,window:n}),[2]}})})},Sl.prototype._closeWindowAndWait=function(n,r){return l(this,void 0,void 0,function(){var t;return C(this,function(e){switch(e.label){case 0:return t=this._createWaitForEventPromise(Cl,2e3),n.ignoreMasterSwitching=!r.isCurrentWindow,this.closing?[3,2]:(this.closing=!0,[4,E.browser.closeWindow(this.browserCloseWindowUrl,s.createNativeXHR,this.windowId)]);case 1:e.sent(),e.label=2;case 2:return n.driverWindow.close(),[2,t]}})})},Sl.prototype._closeWindow=function(t){if(!this.childWindowDriverLinks.length)return el.resolve();var e=this.childWindowDriverLinks.find(function(e){return e.windowId===t.windowId});if(e)return this._closeWindowAndWait(e,t);var n=this.childWindowDriverLinks.map(function(e){return e.findChildWindows(t,ji)});return el.all(n)},Sl.prototype._getWindows=function(){return l(this,void 0,void 0,function(){var t,n,r,i,o,s;return C(this,function(e){switch(e.label){case 0:return this.childWindowDriverLinks.length?(t=this.childWindowDriverLinks.map(function(e){return e.findChildWindows({},Vi)}),[4,el.all(t)]):[2,[this._getWindowInfo()]];case 1:for(n=e.sent(),r=[this._getWindowInfo()],i=0,o=n;i<o.length;i++)s=o[i],Array.isArray(s.result)&&(r=r.concat(s.result));return[2,r]}})})},Sl.prototype._handleGetWindows=function(n,r){return l(this,void 0,void 0,function(){var t;return C(this,function(e){switch(e.label){case 0:return[4,this._getWindows(n,r)];case 1:return t=e.sent(),zo({requestMsgId:n.id,window:r,result:t}),[2]}})})},Sl.prototype._handleSwitchToWindow=function(t,n){return l(this,void 0,void 0,function(){return C(this,function(e){switch(e.label){case 0:return[4,this._switchToWindow(t)];case 1:return e.sent(),zo({requestMsgId:t.id,window:n}),[2]}})})},Sl.prototype._switchToWindow=function(t){var e=this;return this._isTargetWindow(t)?el.resolve().then(function(){e._setCurrentWindowAsMaster()}):this.childWindowDriverLinks.length?el.all(this.childWindowDriverLinks.map(function(e){return e.findChildWindows(t,Ki)})):el.resolve()},Sl.prototype._handleSetAsMasterMessage=function(e,t){var n=this;this._setAsMasterInProgressOrCompleted()||(this.setAsMasterInProgress=!0,zo({requestMsgId:e.id,window:t}),el.resolve().then(function(){return E.browser.setActiveWindowId(n.browserActiveWindowId,s.createNativeXHR,n.windowId)}).then(function(){n._startInternal({finalizePendingCommand:e.finalizePendingCommand,result:{id:n.windowId}}),n.setAsMasterInProgress=!1}).catch(function(){n._onReady(new Bo({isCommandResult:!0,executionError:new Bn}))}))},Sl.prototype._handleCloseAllWindowsMessage=function(e,t){var n=this;this._closeAllChildWindows().then(function(){zo({requestMsgId:e.id,window:t})}).catch(function(){n._onReady(new Bo({isCommandResult:!0,executionError:new qn}))})},Sl.prototype._handleStartToRestoreChildLinkMessage=function(){this.parentWindowDriverLink.restoreChild(this._getCurrentWindowId())},Sl.prototype._handleHasPendingActionFlags=function(e,t){var n=this._hasPendingActionFlags(this.contextStorage);zo({requestMsgId:e.id,window:t,result:n})},Sl.prototype._handleRestoreChildLink=function(e,t){this._stopRespondToChildren||(this._addChildWindowDriverLink({window:t,windowId:e.windowId}),this.childWindowDriverLinks.length===this.contextStorage.getItem(gl)&&this._restoreChildWindowsPromiseResolver&&(this._restoreChildWindowsPromiseResolver(),delete this._restoreChildWindowsPromiseResolver,this.contextStorage.setItem(gl,0)),zo({requestMsgId:e.id,window:t}))},Sl.prototype._handleChildWindowIsOpenedInIFrame=function(){var t=this;this._pendingChildWindowInIFrame=new el(function(e){t._resolvePendingChildWindowInIframe=e})},Sl.prototype._handleChildWindowIsLoadedInIFrame=function(t,e){zo({requestMsgId:t.id,window:e}),this._resolvePendingChildWindowInIframe(),this.childWindowDriverLinks.find(function(e){return e.windowId===t.windowId})||this._onChildWindowOpened({window:e,windowId:t.windowId})},Sl.prototype._handleStopInternalFromFrame=function(e,t){zo({requestMsgId:e.id,window:t}),this.contextStorage.setItem(this.EXECUTING_IN_IFRAME_FLAG,!1),this._stopInternal()},Sl.prototype._initChildDriverListening=function(){var r=this;tl.on(tl.SERVICE_MSG_RECEIVED_EVENT,function(e){var t=e.message,n=e.source;switch(t.type){case gi:r._addChildIframeDriverLink(t.id,n);break;case Ri:r._handleChildWindowIsOpenedInIFrame(t,n);break;case xi:r._handleChildWindowIsLoadedInIFrame(t,n);break;case Di:r._handleStopInternalFromFrame(t,n);break;case bi:r._handleSetAsMasterMessage(t,n);break;case wi:r._handleSwitchToWindow(t,n);break;case vi:r._handleCloseWindow(t,n);break;case yi:r._handleSwitchToWindowValidation(t,n);break;case _i:r._handleCloseWindowValidation(t,n);break;case Ei:r._handleGetWindows(t,n);break;case Ti:r._handleCloseAllWindowsMessage(t,n);break;case Ai:r._handleStartToRestoreChildLinkMessage();break;case Mi:r._handleHasPendingActionFlags(t,n);break;case Ni:r._handleRestoreChildLink(t,n)}})},Sl.prototype._getChildIframeDriverLinkByWindow=function(t){return E.arrayUtils.find(this.childIframeDriverLinks,function(e){return e.driverWindow===t})},Sl.prototype._getChildWindowDriverLinkByWindow=function(t){return E.arrayUtils.find(this.childWindowDriverLinks,function(e){return e.driverWindow===t})},Sl.prototype._runInActiveIframe=function(e){var t=this,n=el.resolve(),r=this.contextStorage.getItem(dl);!this.activeChildIframeDriverLink&&r&&(n=this._switchToIframe(r,vl)),n.then(function(){return t.contextStorage.setItem(t.EXECUTING_IN_IFRAME_FLAG,!0),t.activeChildIframeDriverLink.executeCommand(e,t.speed)}).then(function(e){return t._onCommandExecutedInIframe(e)}).catch(function(e){return t._onCommandExecutedInIframe(new Bo({isCommandResult:!0,executionError:e}))})},Sl.prototype._onCommandExecutedInIframe=function(e){var t=this;this.contextStorage.setItem(this.EXECUTING_IN_IFRAME_FLAG,!1);var n=el.resolve();this._pendingChildWindowInIFrame&&(n=this._pendingChildWindowInIFrame),n.then(function(){t._onReady(e)})},Sl.prototype._ensureChildIframeDriverLink=function(e,t,n){var r=this;return E.waitFor(function(){return r._getChildIframeDriverLinkByWindow(e)},500,n).catch(function(){throw new t})},Sl.prototype._ensureChildWindowDriverLink=function(e,t,n){var r=this;return E.waitFor(function(){return r._getChildWindowDriverLinkByWindow(e)},500,n).catch(function(){throw new t})},Sl.prototype._switchToIframe=function(t,n){var e,r,i,o,s,a,l,c=this,u="number"==typeof t.timeout?t.timeout:this.selectorTimeout;return e=t,r=u,i=null,o=function(e){return new n.NotFoundError(null,e)},s=function(){return new n.IsInvisibleError},a=this.statusBar,l=new Ts(e,r,i,o,s),a.showWaitingElementStatus(l.timeout),l.getResult().then(function(e){return a.hideWaitingElementStatus(!!e).then(function(){return e})}).catch(function(e){return a.hideWaitingElementStatus(!1).then(function(){throw e})}).then(function(e){if(!E.domUtils.isIframeElement(e))throw new bn;return c._ensureChildIframeDriverLink(rl.contentWindowGetter.call(e),n.NotLoadedError,u)}).then(function(e){e.availabilityTimeout=u,c.activeChildIframeDriverLink=e,c.contextStorage.setItem(dl,t)})},Sl.prototype._createWaitForEventPromise=function(t,n){var r=this,i=null,e=new el(function(e){rl.setTimeout.call(Gl,function(){r.off(t,i),e()},n)}),o=new el(function(e){i=function(){this.off(t,i),e()},r.on(t,i)});return el.race([e,o])},Sl.prototype._waitForCurrentCommandCompletion=function(){return this.contextStorage.getItem(this.COMMAND_EXECUTING_FLAG)?this._createWaitForEventPromise(yl,_l):el.resolve()},Sl.prototype._waitForEmptyCommand=function(){return this._createWaitForEventPromise(El,3e4)},Sl.prototype._abortSwitchingToChildWindowIfItClosed=function(){if(this.activeChildWindowDriverLink.driverWindow.closed)throw E.arrayUtils.remove(this.childWindowDriverLinks,this.activeChildWindowDriverLink),this.activeChildWindowDriverLink=null,new dr},Sl.prototype._switchToChildWindow=function(e){var t=this;this.contextStorage.setItem(this.PENDING_WINDOW_SWITCHING_FLAG,!0);var n=this.contextStorage.getItem(this.WINDOW_COMMAND_API_CALL_FLAG);return function(t,e){if("string"!=typeof t)return Da.resolve(null);var n=E.arrayUtils.find(e,function(e){return e.windowId===t});if(n)return Da.resolve(n);var r=new Fn;return Da.reject(r)}(e,this.childWindowDriverLinks).then(function(e){return t._ensureChildWindowDriverLink(e.driverWindow,On,t.childWindowReadyTimeout)}).then(function(e){return t.activeChildWindowDriverLink=e,t._waitForCurrentCommandCompletion()}).then(function(){return n?void 0:t._waitForEmptyCommand()}).then(function(){return t._observeFileDownloadingInNewWindow(),t._abortSwitchingToChildWindowIfItClosed(),t._stopInternal(),t.activeChildWindowDriverLink.setAsMaster(n)}).then(function(){t.contextStorage.setItem(t.PENDING_WINDOW_SWITCHING_FLAG,!1)}).catch(function(e){t.contextStorage.setItem(t.PENDING_WINDOW_SWITCHING_FLAG,!1),e instanceof dr?t._onReady(new Bo):t._onReady(new Bo({isCommandResult:!0,executionError:new Bn}))})},Sl.prototype._switchToTopParentWindow=function(){var e=this.parentWindowDriverLink.setTopOpenedWindowAsMaster.bind(this.parentWindowDriverLink);this._switchToParentWindowInternal(e)},Sl.prototype._switchToParentWindow=function(e){void 0===e&&(e={});var t=this.parentWindowDriverLink.setParentWindowAsMaster.bind(this.parentWindowDriverLink);this._switchToParentWindowInternal(t,e)},Sl.prototype._switchToParentWindowInternal=function(e,t){var n=this;return void 0===t&&(t={}),this.contextStorage.setItem(this.PENDING_WINDOW_SWITCHING_FLAG,!0),el.resolve().then(function(){return n._stopInternal(),e(t)}).then(function(){n.contextStorage.setItem(n.PENDING_WINDOW_SWITCHING_FLAG,!1)}).catch(function(){n.contextStorage.setItem(n.PENDING_WINDOW_SWITCHING_FLAG,!1),n._onReady(new Bo({isCommandResult:!0,executionError:new Bn}))})},Sl.prototype._switchToMainWindow=function(e){this.activeChildIframeDriverLink&&this.activeChildIframeDriverLink.executeCommand(e),this._clearActiveChildIframeInfo()},Sl.prototype._clearActiveChildIframeInfo=function(){this.contextStorage.setItem(dl,null),this.activeChildIframeDriverLink=null},Sl.prototype._setNativeDialogHandlerInIframes=function(e){for(var t=new ao(e),n=0;n<this.childIframeDriverLinks.length;n++)tl.sendServiceMsg(t,this.childIframeDriverLinks[n].driverWindow)},Sl.prototype._onActionCommand=function(e){var o=this,t=new Es(e,this.selectorTimeout,this.speed,function(e,t,n){var r=Ya(t.notFound),i=Ya(t.invisible);return new Ts(e,o.selectorTimeout,n,r,i).getResult()});t.on(Es.EXECUTION_STARTED_EVENT,function(){o.statusBar.hideWaitingElementStatus(!0),o.contextStorage.setItem(o.COMMAND_EXECUTING_FLAG,!0)}),t.on(Es.WAITING_FOR_ELEMENT_EVENT,function(e){o.statusBar.showWaitingElementStatus(e)});var n=new E.ClientRequestEmitter,r=new E.ScriptExecutionEmitter,i=new ja(n,r,E.pageUnloadBarrier);t.execute(i).then(function(e){return new Bo({isCommandResult:!0,result:Or(new Ua).encode(e)})}).catch(function(e){return o.statusBar.hideWaitingElementStatus(!1).then(function(){return new Bo({isCommandResult:!0,executionError:e})})}).then(function(e){return o.contextStorage.setItem(o.COMMAND_EXECUTING_FLAG,!1),o._onReady(e)})},Sl.prototype._onSetNativeDialogHandlerCommand=function(e){this.nativeDialogsTracker.setHandler(e.dialogHandler),this._setNativeDialogHandlerInIframes(e.dialogHandler),this._onReady(new Bo({isCommandResult:!0}))},Sl.prototype._onGetNativeDialogHistoryCommand=function(){this._onReady(new Bo({isCommandResult:!0,result:this.nativeDialogsTracker.appearedDialogs}))},Sl.prototype._onGetBrowserConsoleMessagesCommand=function(){this._onReady(new Bo({isCommandResult:!0}))},Sl.prototype._onNavigateToCommand=function(e){var t=this;this.contextStorage.setItem(this.COMMAND_EXECUTING_FLAG,!0),function(i){return l(this,void 0,void 0,function(){var t,n,r;return C(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),t=new E.ClientRequestEmitter,n=new E.RequestBarrier(t),u.navigateTo(i.url,i.forceReload),[4,u.Promise.all([n.wait(),E.pageUnloadBarrier.wait()])];case 1:return e.sent(),[2,new Bo({isCommandResult:!0})];case 2:return r=e.sent(),[2,new Bo({isCommandResult:!0,executionError:r})];case 3:return[2]}})})}(e).then(function(e){return t.contextStorage.setItem(t.COMMAND_EXECUTING_FLAG,!1),t._onReady(e)})},Sl.prototype._onExecuteClientFunctionCommand=function(e){var t=this;this.contextStorage.setItem(ll,{instantiationCallsiteName:e.instantiationCallsiteName}),Ra(new Zr(e)).then(function(e){t.contextStorage.setItem(ll,null),t._onReady(e)})},Sl.prototype._onExecuteSelectorCommand=function(e){var t,n,r,i,o,s,a,l=this,c=this.contextStorage.getItem(cl)||new il,u=e.needError?function(e){return new Ke(null,e)}:null;t=e,n=this.selectorTimeout,r=c,o=i=u,s=this.statusBar,a=new Ts(t,n,r,i,o),s.showWaitingElementStatus(a.timeout),Ra(a).then(function(e){return s.hideWaitingElementStatus(!!e.result).then(function(){return e})}).then(function(e){l.contextStorage.setItem(cl,null),l._onReady(e)})},Sl.prototype._onSwitchToMainWindowCommand=function(e){this._switchToMainWindow(e),this._onReady(new Bo({isCommandResult:!0}))},Sl.prototype._onSwitchToIframeCommand=function(e){var t=this;this._switchToIframe(e.selector,wl).then(function(){return t._onReady(new Bo({isCommandResult:!0}))}).catch(function(e){return t._onReady(new Bo({isCommandResult:!0,executionError:e}))})},Sl.prototype._onWindowOpenCommand=function(e){this.contextStorage.setItem(this.WINDOW_COMMAND_API_CALL_FLAG,!0),Gl.open(e.url)},Sl.prototype._onWindowCloseCommand=function(a){return l(this,void 0,void 0,function(){var t,n,r,i,o,s;return C(this,function(e){switch(e.label){case 0:t=this._getTopOpenedWindow(),n=a.windowId||this.windowId,r=n===this.windowId,e.label=1;case 1:return e.trys.push([1,4,,5]),[4,this._validateChildWindowCloseCommandExists(n,t)];case 2:if(i=e.sent(),!(o=i.result).success)throw Sl._createWindowValidationError(o);return[4,Vo(new ji({windowId:n,isCurrentWindow:r}),t,qo,Bn)];case 3:return e.sent(),r||this._onReady(new Bo({isCommandResult:!0})),[3,5];case 4:return s=e.sent(),this._onReady(new Bo({isCommandResult:!0,executionError:s})),[3,5];case 5:return[2]}})})},Sl.prototype._onGetCurrentWindowCommand=function(){this._onReady(new Bo({isCommandResult:!0,result:{id:this.windowId}}))},Sl.prototype._onGetWindowsCommand=function(){return l(this,void 0,void 0,function(){var t,n;return C(this,function(e){switch(e.label){case 0:return t=this._getTopOpenedWindow(),[4,Vo(new Vi,t,qo,Bn)];case 1:return n=e.sent(),this._onReady(new Bo({isCommandResult:!0,result:n.result})),[2]}})})},Sl.prototype._validateChildWindowCloseCommandExists=function(e,t){return Vo(new Li({windowId:e}),t,qo,Bn)},Sl.prototype._validateChildWindowSwitchToWindowCommandExists=function(e,t){var n=e.windowId,r=e.fn;return Vo(new Hi({windowId:n,fn:r}),t,qo,Bn)},Sl.prototype._getTopOpenedWindow=function(){var e;return((null===(e=this.parentWindowDriverLink)||void 0===e?void 0:e.getTopOpenedWindow())||Gl).top},Sl.prototype._onSwitchToWindow=function(i,o){return l(this,void 0,void 0,function(){var t,n,r;return C(this,function(e){switch(e.label){case 0:return t=this._getTopOpenedWindow(),[4,this._validateChildWindowSwitchToWindowCommandExists({windowId:i.windowId,fn:i.checkWindow},t)];case 1:return n=e.sent(),(r=n.result).success?(this._stopInternal(),Vo(new Ki({windowId:i.windowId,fn:i.checkWindow}),t,qo,Bn)):this._onReady(new Bo({isCommandResult:!0,executionError:o||Sl._createWindowValidationError(r)})),[2]}})})},Sl.prototype._restoreChildWindowLinks=function(){return l(this,void 0,void 0,function(){var t,n=this;return C(this,function(e){switch(e.label){case 0:if(!this.contextStorage.getItem(gl))return[2];t=new el(function(e){n._restoreChildWindowsPromiseResolver=e}),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,E.getTimeLimitedPromise(t,3e4)];case 2:return e.sent(),[3,4];case 3:return e.sent(),this._onReady(new Bo({isCommandResult:!0,executionError:new pr})),[3,4];case 4:return[2]}})})},Sl.prototype._onSwitchToPreviousWindow=function(e){this._onSwitchToWindow(e,new lr)},Sl.prototype._onSwitchToParentWindow=function(){this.parentWindowDriverLink?this._switchToParentWindow({finalizePendingCommand:!0}):this._onReady(new Bo({isCommandResult:!0,executionError:new or}))},Sl.prototype._onBrowserManipulationCommand=function(e){var t,n,r,i=this;this.contextStorage.setItem(this.COMMAND_EXECUTING_FLAG,!0),t=e,n=this.selectorTimeout,r=this.statusBar,new Na(t,n,r).execute().then(function(e){return i.contextStorage.setItem(i.COMMAND_EXECUTING_FLAG,!1),i._onReady(e)})},Sl.prototype._onSetBreakpointCommand=function(e){var n=this,t=e.isTestError,r=e.inCompilerService,i=this.statusBar.showDebuggingStatus(t);r?(i.then(function(e){n.debug=e}),this._onReady(new Bo({isCommandResult:!0,result:!0}))):i.then(function(e){var t=e===Me;n._onReady(new Bo({isCommandResult:!0,result:t}))})},Sl.prototype._onDisableDebugCommand=function(){this.statusBar._resetState(),this._onReady(new Bo({isCommandResult:!0}))},Sl.prototype._onSetTestSpeedCommand=function(e){this.speed=e.speed,this._onReady(new Bo({isCommandResult:!0}))},Sl.prototype._onShowAssertionRetriesStatusCommand=function(e){this.contextStorage.setItem(fl,e.timeout),this.contextStorage.setItem(pl,rl.dateNow()),this.statusBar.showWaitingAssertionRetriesStatus(e.timeout),this._onReady(new Bo({isCommandResult:!0}))},Sl.prototype._onHideAssertionRetriesStatusCommand=function(e){var t=this;this.contextStorage.setItem(fl,null),this.contextStorage.setItem(pl,null),this.statusBar.hideWaitingAssertionRetriesStatus(e.success).then(function(){return t._onReady(new Bo({isCommandResult:!0}))})},Sl.prototype._checkStatus=function(){var r=this;return E.browser.checkStatus(this.browserStatusDoneUrl,s.createNativeXHR,{manualRedirect:!0}).then(function(e){var t=e.command,n=e.redirecting;n&&t.url.indexOf(r.testRunId)<0?(nl.clear(),nl.lock()):r.contextStorage.setItem(sl,!1),n?E.browser.redirect(t):r._onReady({isCommandResult:!1})}).catch(function(){return E.delay(1e3)})},Sl.prototype._onCustomCommand=function(e){var t=this;(0,this.customCommandHandlers[e.type].handler)(e).then(function(e){t._onReady(new Bo({isCommandResult:!0,result:e}))})},Sl.prototype._closeAllChildWindows=function(){var e=this;return this.childWindowDriverLinks.length?el.all(this.childWindowDriverLinks.map(function(e){return e.closeAllChildWindows()})).then(function(){rl.arrayForEach.call(e.childWindowDriverLinks,function(e){e.driverWindow.close()})}):el.resolve()},Sl.prototype._onTestDone=function(e){var t=this;this.contextStorage.setItem(sl,!0),this.parentWindowDriverLink?this._switchToTopParentWindow():this._closeAllChildWindows().then(function(){return t._sendStatus(e)}).then(function(){t._checkStatus()}).catch(function(){t._onReady(new Bo({isCommandResult:!0,executionError:qn}))})},Sl.prototype._onBackupStoragesCommand=function(){this._onReady(new Bo({isCommandResult:!0,result:nl.backup()}))},Sl.prototype._isPendingSwitchingWindow=function(){return!!this.contextStorage.getItem(this.PENDING_WINDOW_SWITCHING_FLAG)},Sl.prototype._onPrepareClientEnvironmentInDebugMode=function(e){rl.objectDefineProperty(Gl,e.esmRuntime,{value:{g:Gl,c:Gl.eval},configurable:!0}),this._onReady(new Bo({isCommandResult:!0,result:!0}))},Sl.prototype._isStatusWithCommandResultInPendingWindowSwitchingMode=function(e){return e.isCommandResult&&this._isPendingSwitchingWindow()},Sl.prototype._isEmptyCommandInPendingWindowSwitchingMode=function(e){return!e&&this._isPendingSwitchingWindow()},Sl.prototype._observeFileDownloadingInNewWindow=function(){var t=this,e=new Bo({isObservingFileDownloadingInNewWindow:!0});this._isPendingSwitchingWindow()&&this._sendStatus(e).then(function(e){e?t._onCommand(e):t._observeFileDownloadingInNewWindow()})},Sl.prototype._onReady=function(e){var t=this;this.debug&&(e.debug=this.debug,this.debug=null),this._isStatusWithCommandResultInPendingWindowSwitchingMode(e)&&this.emit(yl),this._sendStatus(e).then(function(e){if(e)t._onCommand(e);else{if(t._isEmptyCommandInPendingWindowSwitchingMode(e))return void t.emit(El);t._onReady(new Bo)}})},Sl.prototype._executeCommand=function(e){this.contextStorage.setItem(this.WINDOW_COMMAND_API_CALL_FLAG,!1),this.customCommandHandlers[e.type]?this._onCustomCommand(e):e.type===R.testDone?this._onTestDone(new Bo({isCommandResult:!0})):e.type===R.setBreakpoint?this._onSetBreakpointCommand(e):e.type===R.disableDebug?this._onDisableDebugCommand():e.type===R.switchToMainWindow?this._onSwitchToMainWindowCommand(e):e.type===R.switchToIframe?this._onSwitchToIframeCommand(e):e.type===R.openWindow?this._onWindowOpenCommand(e):e.type===R.closeWindow?this._onWindowCloseCommand(e):e.type===R.getCurrentWindow?this._onGetCurrentWindowCommand(e):e.type===R.getCurrentWindows?this._onGetWindowsCommand():e.type===R.switchToWindow?this._onSwitchToWindow(e):e.type===R.switchToPreviousWindow?this._onSwitchToPreviousWindow(e):e.type===R.switchToParentWindow?this._onSwitchToParentWindow():xe(e)?this._onBrowserManipulationCommand(e):e.type===R.executeClientFunction?this._onExecuteClientFunctionCommand(e):e.type===R.executeSelector?this._onExecuteSelectorCommand(e):e.type===R.navigateTo?this._onNavigateToCommand(e):e.type===R.setNativeDialogHandler?this._onSetNativeDialogHandlerCommand(e):e.type===R.getNativeDialogHistory?this._onGetNativeDialogHistoryCommand(e):e.type===R.getBrowserConsoleMessages?this._onGetBrowserConsoleMessagesCommand(e):e.type===R.setTestSpeed?this._onSetTestSpeedCommand(e):e.type===R.showAssertionRetriesStatus?this._onShowAssertionRetriesStatusCommand(e):e.type===R.hideAssertionRetriesStatus?this._onHideAssertionRetriesStatusCommand(e):e.type===R.backupStorages?this._onBackupStoragesCommand():e.type===R.closeChildWindowOnFileDownloading?this._closeChildWindowOnFileDownloading():e.type===R.prepareClientEnvironmentInDebugMode?this._onPrepareClientEnvironmentInDebugMode(e):this._onActionCommand(e)},Sl.prototype._closeChildWindowOnFileDownloading=function(){this.activeChildWindowDriverLink.closeFileDownloadingWindow(),E.arrayUtils.remove(this.childWindowDriverLinks,this.activeChildWindowDriverLink),y.cursor.show(),this._startInternal()},Sl.prototype._isExecutableInTopWindowOnly=function(e){if((t=e).type===R.testDone||t.type===R.switchToMainWindow||t.type===R.setNativeDialogHandler||t.type===R.getNativeDialogHistory||t.type===R.setTestSpeed||t.type===R.showAssertionRetriesStatus||t.type===R.hideAssertionRetriesStatus||t.type===R.setBreakpoint||xe(t)&&t.type!==R.takeElementScreenshot)return!0;var t,n=this.customCommandHandlers[e.type];return e.forceExecutionInTopWindowOnly||n&&n.isExecutableInTopWindowOnly},Sl.prototype._onCommand=function(n){var r=this;this.readyPromise.then(function(){var e,t=Ae(n);r.contextStorage.getItem(ul)&&t?r._onReady(new Bo({isCommandResult:!0})):(e=r.activeChildIframeDriverLink||r.contextStorage.getItem(dl),r._isExecutableInTopWindowOnly(n)||!e?r._executeCommand(n):r._runInActiveIframe(n))})},Sl.prototype.setCustomCommandHandlers=function(e,t,n){this.customCommandHandlers[e]={isExecutableInTopWindowOnly:n,handler:t}},Sl.prototype._startInternal=function(e){this.role=La,E.browser.startHeartbeat(this.heartbeatUrl,s.createNativeXHR),this._setupAssertionRetryIndication(),this._startCommandsProcessing(e)},Sl.prototype._stopInternal=function(){this.role=Oa,E.browser.stopHeartbeat(),y.cursor.hide()},Sl.prototype._setupAssertionRetryIndication=function(){var n=this;this.readyPromise.then(function(){n.statusBar.hidePageLoadingStatus();var e,t=n.contextStorage.getItem(fl);t&&(e=n.contextStorage.getItem(pl),0<t-(new il-e)&&n.statusBar.showWaitingAssertionRetriesStatus(t,e))})},Sl.prototype._startCommandsProcessing=function(e){void 0===e&&(e={finalizePendingCommand:!1,isFirstRequestAfterWindowSwitching:!1,result:void 0});var t,n,r=this.contextStorage.getItem(al);r&&(r.resent=!0),this.contextStorage.getItem(sl)?r?this._onTestDone(r):this._checkStatus():this._failIfClientCodeExecutionIsInterrupted()||(t=e.finalizePendingCommand||this._hasPendingActionFlags(this.contextStorage),n=r||new Bo({isCommandResult:t,isFirstRequestAfterWindowSwitching:e.isFirstRequestAfterWindowSwitching,result:e.result}),this.contextStorage.setItem(this.COMMAND_EXECUTING_FLAG,!1),this.contextStorage.setItem(this.EXECUTING_IN_IFRAME_FLAG,!1),this.contextStorage.setItem(this.PENDING_WINDOW_SWITCHING_FLAG,!1),this._onReady(n))},Sl.prototype._initParentWindowLink=function(){Gl.opener&&Gl.opener!==Gl&&this.windowId&&(this.parentWindowDriverLink=new Fa(Gl))},Sl.prototype._initConsoleMessages=function(){var e=this.consoleMessages;e.ensureMessageContainer(this.windowId),this.consoleMessages=e},Sl.prototype._getDriverRole=function(){return l(this,void 0,void 0,function(){return C(this,function(e){switch(e.label){case 0:return this.windowId?[4,E.browser.getActiveWindowId(this.browserActiveWindowId,s.createNativeXHR)]:[2,La];case 1:return[2,e.sent().activeWindowId===this.windowId?La:Oa]}})})},Sl.prototype._init=function(){this.contextStorage=new ko(Gl,this.testRunId,this.windowId),this.nativeDialogsTracker=new di(this.contextStorage,this.dialogHandler),this.statusBar=new t.StatusBar(this.userAgent,this.fixtureName,this.testName,this.contextStorage),this.statusBar.on(this.statusBar.UNLOCK_PAGE_BTN_CLICK,E.disableRealEventsPreventing),this.speed=this.initialSpeed,this._initConsoleMessages(),this._initParentWindowLink(),this._isOpenedInIframe()&&Vo(new Io(this.windowId),Gl.opener.top,qo,nr)},Sl.prototype._doFirstPageLoadSetup=function(){return l(this,void 0,void 0,function(){return C(this,function(e){return this.isFirstPageLoad&&this.canUseDefaultWindowActions,[2]})})},Sl.prototype.start=function(){return l(this,void 0,void 0,function(){var t;return C(this,function(e){switch(e.label){case 0:return this._init(),[4,this._doFirstPageLoadSetup()];case 1:return e.sent(),[4,this._restoreChildWindowLinks()];case 2:return e.sent(),[4,this._getDriverRole()];case 3:return t=e.sent(),this.role===La||t===La&&this._startInternal(),[2]}})})},Sl);function Sl(e,t,n,r){var i=$a.call(this)||this;i.COMMAND_EXECUTING_FLAG="testcafe|driver|command-executing-flag",i.EXECUTING_IN_IFRAME_FLAG="testcafe|driver|executing-in-iframe-flag",i.PENDING_WINDOW_SWITCHING_FLAG="testcafe|driver|pending-window-switching-flag",i.WINDOW_COMMAND_API_CALL_FLAG="testcafe|driver|window-command-api-flag",i.testRunId=e,i.heartbeatUrl=t.heartbeat,i.browserStatusUrl=t.status,i.browserStatusDoneUrl=t.statusDone,i.browserActiveWindowId=t.activeWindowId,i.browserCloseWindowUrl=t.closeWindow,i.userAgent=n.userAgent,i.fixtureName=n.fixtureName,i.testName=n.testName,i.selectorTimeout=r.selectorTimeout,i.pageLoadTimeout=r.pageLoadTimeout,i.childWindowReadyTimeout=r.childWindowReadyTimeout,i.initialSpeed=r.speed,i.skipJsErrors=r.skipJsErrors,i.dialogHandler=r.dialogHandler,i.canUseDefaultWindowActions=r.canUseDefaultWindowActions,i.isFirstPageLoad=Qa.get().isFirstPageLoad,i.customCommandHandlers={},i.contextStorage=null,i.nativeDialogsTracker=null,i.childIframeDriverLinks=[],i.activeChildIframeDriverLink=null,i.childWindowDriverLinks=[],i.parentWindowDriverLink=null,i.statusBar=null,i.windowId=i._getCurrentWindowId(),i.role=Oa,i.setAsMasterInProgress=!1,i.checkClosedChildWindowIntervalId=null;var o=new E.ClientRequestEmitter;return i.pageInitialRequestBarrier=new E.RequestBarrier(o),i.readyPromise=i._getReadyPromise(),i._initChildDriverListening(),E.pageUnloadBarrier.init(),E.preventRealEvents(),s.on(s.EVENTS.uncaughtJsError,function(e){return i._onJsError(e)}),s.on(s.EVENTS.unhandledRejection,function(e){return i._onJsError(e)}),s.on(s.EVENTS.consoleMethCalled,function(e){return i._onConsoleMessage(e)}),s.on(s.EVENTS.beforeFormSubmit,function(e){return i._onFormSubmit(e)}),s.on(s.EVENTS.windowOpened,function(e){return i._onChildWindowOpened(e)}),i.setCustomCommandHandlers(R.unlockPage,function(){return i._unlockPageAfterTestIsDone()}),i.setCustomCommandHandlers(R.getActiveElement,function(){return i._getActiveElement()}),ol.addInternalEventBeforeListener(Gl,["beforeunload"],function(){i._sendStartToRestoreCommand()}),i.replicator=Or([new us]),i}var Wl=(bl.prototype.establishConnection=function(){return Vo(new Pi,this.driverWindow,5e3,Dn).then(function(e){return e.result.id})},bl.prototype.sendConfirmationMessage=function(e){zo({requestMsgId:e,window:this.driverWindow})},bl.prototype.onCommandExecuted=function(e){var t=new Qi(e);u.eventSandbox.message.sendServiceMsg(t,this.driverWindow)},bl.prototype.hasPendingActionFlags=function(){return l(this,void 0,void 0,function(){return C(this,function(e){switch(e.label){case 0:return[4,Vo(new Do,this.driverWindow,5e3,Dn)];case 1:return[2,e.sent().result]}})})},bl);function bl(e){this.driverWindow=e}var Tl,Al=s.eventSandbox.message,Nl=(a(xl,Tl=di),xl.prototype._defaultDialogHandler=function(e){Al.sendServiceMsg({type:ni,dialogType:e,url:di._getPageUrl()},Gl.top)},xl.prototype._addAppearedDialogs=function(e,t){Al.sendServiceMsg({type:ti,dialogType:e,text:t,url:di._getPageUrl()},Gl.top)},xl.prototype._onHandlerError=function(e,t){Al.sendServiceMsg({type:ri,dialogType:e,message:t,url:di._getPageUrl()},Gl.top)},xl);function xl(e){return Tl.call(this,null,e)||this}var Rl,Dl=u.eventSandbox.message,Ml=(a(Pl,Rl=Il),Pl.prototype._onJsError=function(){},Pl.prototype._onConsoleMessage=function(){},Pl.prototype._onChildWindowOpened=function(){Dl.sendServiceMsg(new bo,Gl.top)},Pl.prototype._stopInternal=function(){Dl.sendServiceMsg(new No,Gl.top)},Pl.prototype._initParentDriverListening=function(){var n=this;u.eventSandbox.message.on(u.eventSandbox.message.SERVICE_MSG_RECEIVED_EVENT,function(e){var t=e.message;E.pageUnloadBarrier.wait(0).then(function(){if(t.type===Ii){if(n.lastParentDriverMessageId===t.id)return;n.lastParentDriverMessageId=t.id,n.readyPromise.then(function(){n.speed=t.testSpeed,n.parentDriverLink.sendConfirmationMessage(t.id),n._onCommand(t.command)})}t.type===Wi&&(n.nativeDialogsTracker.setHandler(t.dialogHandler),n._setNativeDialogHandlerInIframes(t.dialogHandler))})})},Pl.prototype._onSwitchToMainWindowCommand=function(e){this._switchToMainWindow(e)},Pl.prototype._onReady=function(e){this.parentDriverLink.onCommandExecuted(e)},Pl.prototype._isInCommandExecution=function(){return l(this,void 0,void 0,function(){return C(this,function(e){switch(e.label){case 0:return u.utils.dom.isCrossDomainWindows(Gl,Gl.parent)?[4,this.parentDriverLink.hasPendingActionFlags()]:[3,2];case 1:return[2,e.sent()];case 2:return[2,this._hasPendingActionFlags(this.contextStorage)]}})})},Pl.prototype._init=function(){return l(this,void 0,void 0,function(){var t;return C(this,function(e){switch(e.label){case 0:return[4,this.parentDriverLink.establishConnection()];case 1:return t=e.sent(),this.contextStorage=new ko(Gl,t,this.windowId),this._failIfClientCodeExecutionIsInterrupted()?[2]:[4,this._isInCommandExecution()];case 2:return e.sent()&&(this.contextStorage.setItem(this.COMMAND_EXECUTING_FLAG,!1),this.contextStorage.setItem(this.EXECUTING_IN_IFRAME_FLAG,!1),this._onReady(new Bo({isCommandResult:!0}))),[2]}})})},Pl.prototype.start=function(){this.nativeDialogsTracker=new Nl(this.dialogHandler),this.statusBar=new t.IframeStatusBar;var e=this._init();this.readyPromise=u.Promise.all([this.readyPromise,e])},Pl);function Pl(e,t){var n=Rl.call(this,e,{},{},t)||this;return n.lastParentDriverMessageId=null,n.parentDriverLink=new Wl(Gl.parent),n._initParentDriverListening(),n}var Fl={NodeSnapshot:ts,ElementSnapshot:ls,SelectorExecutor:Ts},kl="%testCafeDriver%",Ll="%testCafeIframeDriver%",Ol="%testCafeEmbeddingUtils%";!function(e){if(e.nativeMethods.objectAssign)e.nativeMethods.objectAssign(Hr,e);else for(var t=0,n=e.nativeMethods.objectKeys(e);t<n.length;t++){var r=n[t];Hr[r]=e[r]}}({isProxyless:!1,nativeMethods:u.nativeMethods,PromiseCtor:u.Promise,delay:E.delay,isShadowRoot:E.domUtils.isShadowRoot,isDomElement:E.domUtils.isDomElement,isTextNode:E.domUtils.isTextNode,isOptionElement:E.domUtils.isOptionElement,getTagName:E.domUtils.getTagName,isOptionElementVisible:t.selectElement.isOptionElementVisible,isElementVisible:E.positionUtils.isElementVisible,getActiveElement:E.domUtils.getActiveElement});var Ul=s.nativeMethods,Hl=s.EVENTS.evalIframeScript;Ul.objectDefineProperty(Gl,kl,{configurable:!0,value:Il}),Ul.objectDefineProperty(Gl,Ll,{configurable:!0,value:Ml}),Ul.objectDefineProperty(Gl,Ol,{configurable:!0,value:Fl}),s.on(Hl,function(e){return Bl(Ul.contentWindowGetter.call(e.iframe))})}(Gl["%hammerhead%"],Gl["%testCafeAutomation%"],Gl["%testCafeCore%"],Gl["%hammerhead%"].Promise,Gl["%testCafeUI%"])}(window);