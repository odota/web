"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const fs_1 = __importDefault(require("fs"));
const isomorphic_fetch_1 = __importDefault(require("isomorphic-fetch"));
const util_1 = require("util");
const reporter_object_factory_1 = __importDefault(require("./reporter-object-factory"));
const logger_1 = __importDefault(require("./logger"));
const get_reporter_settings_1 = __importDefault(require("./get-reporter-settings"));
const path_1 = __importDefault(require("path"));
const TESTCAFE_PACKAGE_PATH = 'testcafe/package';
function getTestCafeVersion() {
    let packageName = '';
    try {
        packageName = require(path_1.default.resolve('package')).name;
        if (packageName !== 'testcafe')
            packageName = TESTCAFE_PACKAGE_PATH;
    }
    catch (err) {
        packageName = TESTCAFE_PACKAGE_PATH;
    }
    return require(packageName).version;
}
module.exports = function pluginFactory(options = {}) {
    const settings = get_reporter_settings_1.default(options);
    const tcVersion = getTestCafeVersion();
    return reporter_object_factory_1.default(util_1.promisify(fs_1.default.readFile), isomorphic_fetch_1.default, settings, logger_1.default, tcVersion);
};
